<html><head><style type='text/css'>
*.st1 { background-color: #ffaaaa }
*.st3 { background-color: #aaffaa }
*.st2 { background-color: #44dd44 }
*.stsource { background-color: #eeeeee; }
*.key { margin: 20px; width: 88ex }
*.source { width: 120ex; background-color: #eeeeee; padding-left: 5px;
             /* border-style: solid none none none; border-width: 1px;
             border-color: #dddddd */
             white-space: pre; }

*.acode { border-left: 1px dashed #c0c0c0;
         margin-top: 1ex;
         margin-left: 6ex;
         margin-bottom: 2ex;
         white-space: pre;
         display: none; }

*.line { color: #666666; float: left; width: 6ex; text-align: right; margin-right: 1ex; }

*.toggle { font-size: small; }

table.summary tr.head-row { background-color: #aaaaff }
table.summary tr td.text-cell { text-align: left }
table.summary tr td.main-head { text-align: center }
table.summary tr td { text-align: right }
table.summary tr.even { background-color: #eeeeff }
table.summary tr.subheading { background-color: #aaaaff}
table.summary tr.subheading td { text-align: left; font-weight: bold; padding-left: 5ex; }

</style>

<script type='text/javascript'>
function swap (id) {
  var acode = document.getElementById('a' + id);
  var prompt = document.getElementById('p' + id);
  if (acode.style.display == 'block') {
      acode.style.display = 'none';
      prompt.innerHTML = 'Show expansion';
  } else {
    acode.style.display = 'block';
    prompt.innerHTML = 'Hide expansion';
  }
}
</script>
<script src='src_typechecker_typecheck_lisp.js'></script>
</head><body onload='init_file()'><h3><a id='backlink' href="index.html">Coverage report:</a> home:Documents;Work;Repo;alu;src;typechecker;typecheck.lisp.newest <br />
</h3>
<table class='summary'><table class='summary'><tr class='head-row'><td class='main-head' colspan='5'>Expressions</td><td class='main-head' colspan='1'>Branches</td><td class='main-head' colspan='3'>Code Forms</td><td class='main-head' colspan='7'>Functions</td></tr><tr class='head-row'><td width='60px'>Total</td><td width='60px'>Entered</td><td width='60px'>% entered</td><td width='60px'>Fully covered</td><td width='60px'>% fully covered</td><td width='60px'>total unreached</td><td width='60px'>Total</td><td width='60px'>Covered</td><td width='60px'>% covered</td><td width='60px'>Total</td><td width='60px'>Fully covered</td><td width='60px'>% fully covered</td><td width='60px'>Partly covered</td><td width='60px'>% partly covered</td><td width='60px'>Not entered</td><td width='60px'>% not entered</td></tr><tr class='odd'><td id='srcTotal'></td><td id='srcEntered'></td><td id='srcEnteredPct'></td><td id='srcCovered'></td><td id='srcCoveredPct'></td><td id='branchUnreached'></td><td id='acodeTotal'></td><td id='acodeCovered'></td><td id='acodeCoveredPct'></td><td id='fnTotal'></td><td id='fnCovered'></td><td id='fnCoveredPct'></td><td id='fnPartly'></td><td id='fnPartlyPct'></td><td id='fnUnentered'></td><td id='fnUnenteredPct'></td></table></table><div class='key'><b>Key</b><br />
<div class='st2'>Fully covered - every single instruction executed</div><div class='st3'>Partly covered - entered but some subforms not executed</div><div class='st1'>Never entered - not a single instruction executed</div><div class='stsource'>Uninstrumented - a form whose coverage was not measured</div></div><p></p>
<div class='source'><code><span class='line'>1</span> (in-package :alu&#46;typechecker&#46;check)
<span class='line'>2</span> 
<span class='line'>3</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>4</span> &#59;&#59;&#59; Annotating the Typing context
<span class='line'>5</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>6</span> 
<span class='line'>7</span> (-&#62; check (ir:type-aware-list ir:circuit) (values ir:expanded-list typing-context))
<span id='f0s0'><span class='line'>8</span> (defun check (body circuit)
<span class='line'>9</span>   <span id='f0s1'>(values
<span class='line'>10</span>    body
<span class='line'>11</span>    <span id='f0s2'>(annotate-circuit circuit body)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t0')><span class='toggle' id='pf0t0'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(0)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t0'><code><span id='f0c707'> (lambda (body circuit)
   <span id='f0c706'>(values body
           <span id='f0c704'>(funcall &#39;annotate-circuit
                    <span id='f0c703'>(ccl::typed-form &#39;alu&#46;spec:circuit circuit)</span>
                    <span id='f0c701'>(ccl::typed-form &#39;(satisfies alu&#46;ir&#46;spec:expanded-list) body)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>12</span> 
<span class='line'>13</span> (-&#62; annotate-circuit (ir:circuit ir:expanded-list) typing-context)
<span id='f0s3'><span class='line'>14</span> (defun annotate-circuit (circuit body)
<span class='line'>15</span>   <span id='f0s4'>(annotate-list body <span id='f0s5'>(starting-context <span id='f0s6'>(ir:arguments circuit)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t3')><span class='toggle' id='pf0t3'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(3)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t3'><code><span id='f0c699'> (lambda (circuit body)
   <span id='f0c698'>(funcall &#39;annotate-list
            <span id='f0c692'>(ccl::typed-form &#39;(satisfies alu&#46;ir&#46;spec:type-aware-list) body)</span>
            <span id='f0c697'>(ccl::typed-form &#39;typing-context
             <span id='f0c696'>(funcall &#39;starting-context <span id='f0c695'>(ccl::typed-form &#39;list <span id='f0c694'>(funcall &#39;alu&#46;spec:arguments circuit)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>16</span> 
<span class='line'>17</span> (-&#62; starting-context (list) typing-context)
<span id='f0s7'><span class='line'>18</span> (defun starting-context (constraint-list)
<span class='line'>19</span>   <span id='f0s8'>(mvfold
<span class='line'>20</span>    <span id='f0s9'>(lambda (ctx constraint)
<span class='line'>21</span>      &#59;&#59; update when we get no types for circuit arguments
<span class='line'>22</span>      <span id='f0s10'>(util:copy-instance
<span class='line'>23</span>       ctx
<span class='line'>24</span>       :typing-closure <span id='f0s11'>(closure:insert <span id='f0s12'>(typing-closure ctx)</span>
<span class='line'>25</span>                                       <span id='f0s13'>(ir:name constraint)</span>
<span class='line'>26</span>                                       <span id='f0s14'>(make-type-info
<span class='line'>27</span>                                        :size <span id='f0s15'>(size:reference <span id='f0s16'>(ir:typ constraint)</span>)</span>
<span class='line'>28</span>                                        :type <span id='f0s17'>(ir:typ constraint)</span>)</span>)</span>)</span>)</span>
<span class='line'>29</span>    constraint-list
<span class='line'>30</span>    <span id='f0s18'>(make-instance &#39;typing-context)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t7')><span class='toggle' id='pf0t7'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(7)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t7'><code><span id='f0c244'> (lambda (constraint-list)
   <span id='f0c243'>(funcall &#39;reduce
            <span id='f0c234'>(function <span id='f0c233'>(lambda (ctx constraint)
                        <span id='f0c232'>(funcall &#39;util:copy-instance
                                 <span id='f0c214'>(ccl::typed-form &#39;standard-object ctx)</span>
                                 <span id='f0c231'>&#39;:typing-closure</span>
                                 <span id='f0c230'>(funcall &#39;closure:insert
                                          <span id='f0c226'>(ccl::typed-form &#39;closure:typ <span id='f0c225'>(funcall &#39;typing-closure ctx)</span>)</span>
                                          <span id='f0c229'>(ccl::typed-form &#39;keyword <span id='f0c228'>(funcall &#39;alu&#46;spec:name constraint)</span>)</span>
                                          <span id='f0c223'>(funcall &#39;make-type-info
                                                   <span id='f0c218'>&#39;:size</span>
                                                   <span id='f0c222'>(funcall &#39;size:reference
                                                            <span id='f0c221'>(ccl::typed-form
                                                             &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                             <span id='f0c220'>(funcall &#39;alu&#46;spec:typ constraint)</span>)</span>)</span>
                                                   <span id='f0c217'>&#39;:type</span>
                                                   <span id='f0c216'>(funcall &#39;alu&#46;spec:typ constraint)</span>)</span>)</span>)</span>)</span>)</span>
            constraint-list
            <span id='f0c236'>&#39;:from-end</span>
            nil
            <span id='f0c242'>&#39;:initial-value</span>
            <span id='f0c241'>(let* ()
              <span id='f0c240'>(funcall <span id='f0c238'>(ccl::&#37;svref <span id='f0c237'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200391882F&#62;))</span> 3)</span>
                       <span id='f0c239'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200391882F&#62;))</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>31</span> 
<span class='line'>32</span> (-&#62; annotate-list (ir:type-aware-list typing-context) typing-context)
<span id='f0s19'><span class='line'>33</span> (defun annotate-list (body context)
<span class='line'>34</span>   <span id='f0s20'>(mvfold <span id='f0s21'>(flip <span id='f0s22'>&#35;&#39;annotate-term</span>)</span> body context)</span>)</span>
</code></div>
<a href=javascript:swap('f0t19')><span class='toggle' id='pf0t19'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(19)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t19'><code><span id='f0c57'> (lambda (body context)
   <span id='f0c56'>(funcall &#39;reduce
            <span id='f0c53'>(let* ((&#35;:f55856 <span id='f0c47'>(funcall &#39;alexandria:ensure-function <span id='f0c46'>(function annotate-term)</span>)</span>))
              <span id='f0c52'>(function <span id='f0c51'>(lambda (serapeum::x serapeum::y) <span id='f0c50'>(funcall &#35;:f55856 serapeum::y serapeum::x)</span>)</span>)</span>)</span>
            body
            <span id='f0c45'>&#39;:from-end</span>
            nil
            <span id='f0c44'>&#39;:initial-value</span>
            context)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>35</span> 
<span class='line'>36</span> (-&#62; annotate-term (ir:type-aware-term typing-context) typing-context)
<span id='f0s23'><span class='line'>37</span> (defun annotate-term (term context)
<span class='line'>38</span>   <span id='f0s24'>(assure typing-context
<span class='line'>39</span>     <span id='f0s25'>(match-of ir:type-aware-term term
<span class='line'>40</span>       ((ir:standalone-ret)
<span class='line'>41</span>        context)
<span class='line'>42</span>       ((ir:bind :variable v :value val)
<span class='line'>43</span>        <span id='f0s26'>(multiple-value-bind (result ctx) <span id='f0s27'>(annotate-term-no-binder val context)</span>
<span class='line'>44</span>          <span id='f0s28'>(with-accessors ((holes holes) (info hole-info)
<span class='line'>45</span>                           (dep dependency) (closure typing-closure))
<span class='line'>46</span>              ctx
<span class='line'>47</span>            <span id='f0s29'>(etypecase-of typing-result result
<span class='line'>48</span>              (type-info
<span class='line'>49</span>               <span id='f0s30'>(util:copy-instance
<span class='line'>50</span>                ctx
<span class='line'>51</span>                :typing-closure <span id='f0s31'>(closure:insert closure v result)</span>)</span>)
<span class='line'>52</span>              (same-as
<span class='line'>53</span>               <span id='f0s32'>(all-mutual <span id='f0s33'>(list <span id='f0s34'>(ir:copy-meta term <span id='f0s35'>(ir:make-reference :name v)</span>)</span>
<span class='line'>54</span>                                 <span id='f0s36'>(ir:copy-meta val <span id='f0s37'>(ir:make-reference
<span class='line'>55</span>                                                    :name (same-as-value result))</span>)</span>)</span>
<span class='line'>56</span>                           <span id='f0s38'>(util:copy-instance ctx :holes <span id='f0s39'>(cons v holes)</span>)</span>)</span>)
<span class='line'>57</span>              &#59;&#59; here we have an integer type&#44; but what size of
<span class='line'>58</span>              &#59;&#59; integer&#44; we need to refine on this&#33;
<span class='line'>59</span>              ((eql :refine-integer)
<span class='line'>60</span>               <span id='f0s40'>(util:copy-instance
<span class='line'>61</span>                ctx
<span class='line'>62</span>                :holes     <span id='f0s41'>(cons v holes)</span>
<span class='line'>63</span>                :hole-info <span id='f0s42'>(closure:insert info v
<span class='line'>64</span>                                           <span id='f0s43'>(make-hole-information :unrefined :int
<span class='line'>65</span>                                                                  :term <span id='f0s44'>(list val)</span>)</span>)</span>)</span>)
<span class='line'>66</span>              ((eql :refine-array)
<span class='line'>67</span>               <span id='f0s45'>(util:copy-instance
<span class='line'>68</span>                ctx
<span class='line'>69</span>                :holes     <span id='f0s46'>(cons v holes)</span>
<span class='line'>70</span>                :hole-info <span id='f0s47'>(closure:insert info v
<span class='line'>71</span>                                           <span id='f0s48'>(make-hole-information :term <span id='f0s49'>(list val)</span>)</span>)</span>)</span>)
<span class='line'>72</span>              &#59;&#59; Here we keep the original expression&#44; and just
<span class='line'>73</span>              &#59;&#59; note what holes need to be solved first before we
<span class='line'>74</span>              &#59;&#59; can continue&#46;
<span class='line'>75</span>              (depends-on
<span class='line'>76</span>               <span id='f0s50'>(util:copy-instance
<span class='line'>77</span>                ctx
<span class='line'>78</span>                :holes     <span id='f0s51'>(cons v holes)</span>
<span class='line'>79</span>                :hole-info <span id='f0s52'>(closure:insert info
<span class='line'>80</span>                                           v
<span class='line'>81</span>                                           <span id='f0s53'>(make-hole-information :term <span id='f0s54'>(list val)</span>)</span>)</span>
<span class='line'>82</span>                :dependency
<span class='line'>83</span>                <span id='f0s55'>(dependency:determined-by dep v (depends-on-value result))</span>)</span>))</span>)</span>)</span>)
<span class='line'>84</span>       &#59;&#59; The hole will be filed in via the recursive body calls&#46;
<span class='line'>85</span>       ((ir:bind-constraint :variable introductions :value body)
<span class='line'>86</span>        <span id='f0s56'>(mvfold <span id='f0s57'>(flip <span id='f0s58'>&#35;&#39;annotate-term</span>)</span>
<span class='line'>87</span>                body
<span class='line'>88</span>                <span id='f0s59'>(make-starting-hole introductions context)</span>)</span>))</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t23')><span class='toggle' id='pf0t23'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(23)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t23'><code><span id='f0c2273'> (lambda (term context)
   <span id='f0c2272'>(ccl::typed-form &#39;typing-context
    <span id='f0c2271'>(let* ((&#35;:datum55893
            <span id='f0c2261'>(let* ((&#35;:what155894 term))
              <span id='f0c2260'>(block trivia&#46;level1&#46;impl::whole
                (progn <span id='f0c2208'>(block trivia&#46;level1&#46;impl::clause
                         <span id='f0c2207'>(let* ((&#35;:it55883 &#35;:what155894))
                           <span id='f0c2206'>(if <span id='f0c2205'>(funcall &#39;ccl::std-instance-class-cell-typep
                                        &#35;:it55883
                                        <span id='f0c2203'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200397BB7F&#62;))</span>)</span>
                               <span id='f0c2202'>(ccl::&#37;decls-body
                                <span id='f0c2201'>(return-from trivia&#46;level1&#46;impl::whole
                                  <span id='f0c2200'>(let* ()
                                    <span id='f0c2199'>(block trivia&#46;level1&#46;impl::whole
                                      (progn <span id='f0c2195'>(let* ((&#35;:it55886 nil)) <span id='f0c2194'>(return-from trivia&#46;level1&#46;impl::whole context)</span>)</span>
                                             <span id='f0c2198'>(let* ((&#35;:it55887 nil))
                                               <span id='f0c2197'>(return-from trivia&#46;level1&#46;impl::whole
                                                 <span id='f0c2196'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>
                               nil)</span>)</span>)</span>
                       <span id='f0c2192'>(block trivia&#46;level1&#46;impl::clause
                         <span id='f0c2191'>(let* ((&#35;:it55884 &#35;:what155894))
                           <span id='f0c2190'>(if <span id='f0c2189'>(funcall &#39;ccl::std-instance-class-cell-typep
                                        &#35;:it55884
                                        <span id='f0c2188'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003975C5F&#62;))</span>)</span>
                               <span id='f0c2186'>(ccl::&#37;decls-body
                                <span id='f0c2185'>(let* ((v
                                        <span id='f0c2018'>(funcall &#39;ccl::slot-id-value
                                                 &#35;:it55884
                                                 <span id='f0c2016'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003972C6F&#62;))</span>)</span>))
                                  <span id='f0c2184'>(let* ((val
                                          <span id='f0c2183'>(funcall &#39;ccl::slot-id-value
                                                   &#35;:it55884
                                                   <span id='f0c2181'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200396FD1F&#62;))</span>)</span>))
                                    <span id='f0c2180'>(return-from trivia&#46;level1&#46;impl::whole
                                      <span id='f0c2179'>(let* ()
                                        <span id='f0c2178'>(block trivia&#46;level1&#46;impl::whole
                                          (progn <span id='f0c2177'>(let* ((&#35;:it55888 nil))
                                                   <span id='f0c2176'>(return-from trivia&#46;level1&#46;impl::whole
                                                     <span id='f0c2175'>(multiple-value-bind (result ctx)
                                                         <span id='f0c2174'>(funcall &#39;annotate-term-no-binder
                                                                  <span id='f0c2171'>(ccl::typed-form
                                                                   &#39;(or number
                                                                        alu&#46;spec:reference
                                                                        alu&#46;spec:application
                                                                        alu&#46;spec:record
                                                                        alu&#46;spec:record-lookup
                                                                        alu&#46;spec:array-lookup
                                                                        alu&#46;spec:array-allocate
                                                                        alu&#46;spec:from-data
                                                                        alu&#46;spec:array-set
                                                                        alu&#46;spec:type-coerce
                                                                        alu&#46;spec:type-check)
                                                                   val)</span>
                                                                  <span id='f0c2173'>(ccl::typed-form &#39;typing-context context)</span>)</span>
                                                       <span id='f0c2169'>(let* ((&#35;:g55913 ctx))
                                                         <span id='f0c2168'>(let* ((&#35;:x55914 result))
                                                           <span id='f0c2167'>(let* ((&#35;:g55915 &#35;:x55914))
                                                             <span id='f0c2166'>(if <span id='f0c2036'>(funcall &#39;ccl:structure-typep
                                                                          &#35;:g55915
                                                                          <span id='f0c2034'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                 <span id='f0c2033'>(progn nil
                                                                        <span id='f0c2032'>(funcall &#39;util:copy-instance
                                                                                 <span id='f0c2031'>(ccl::typed-form &#39;standard-object ctx)</span>
                                                                                 <span id='f0c2022'>&#39;:typing-closure</span>
                                                                                 <span id='f0c2029'>(funcall &#39;closure:insert
                                                                                          <span id='f0c2028'>(ccl::typed-form &#39;closure:typ
                                                                                           <span id='f0c2027'>(funcall &#39;typing-closure
                                                                                                    &#35;:g55913)</span>)</span>
                                                                                          <span id='f0c2024'>(ccl::typed-form &#39;keyword v)</span>
                                                                                          result)</span>)</span>)</span>
                                                                 <span id='f0c2165'>(if <span id='f0c2136'>(funcall &#39;ccl:structure-typep
                                                                              &#35;:g55915
                                                                              <span id='f0c2134'>&#39;&#35;&#60;class-cell for same-as &#35;x302001E2417D&#62;</span>)</span>
                                                                     <span id='f0c2164'>(progn nil
                                                                            <span id='f0c2163'>(funcall &#39;all-mutual
                                                                                     <span id='f0c2153'>(ccl::typed-form &#39;list
                                                                                      <span id='f0c2152'>(list <span id='f0c2151'>(funcall &#39;alu&#46;spec:copy-meta
                                                                                                     term
                                                                                                     <span id='f0c2149'>(funcall &#39;alu&#46;spec:make-reference
                                                                                                              <span id='f0c2146'>&#39;:name</span>
                                                                                                              <span id='f0c2148'>(ccl::typed-form
                                                                                                               &#39;keyword
                                                                                                               v)</span>)</span>)</span>
                                                                                            <span id='f0c2145'>(funcall &#39;alu&#46;spec:copy-meta
                                                                                                     val
                                                                                                     <span id='f0c2143'>(funcall &#39;alu&#46;spec:make-reference
                                                                                                              <span id='f0c2142'>&#39;:name</span>
                                                                                                              <span id='f0c2141'>(ccl::typed-form
                                                                                                               &#39;keyword
                                                                                                               <span id='f0c2140'>(ccl::struct-ref <span id='f0c2138'>(ccl::typed-form
                                                                                                                                 &#39;same-as
                                                                                                                                 result)</span>
                                                                                                                                1)</span>)</span>)</span>)</span>)</span>)</span>
                                                                                     <span id='f0c2162'>(ccl::typed-form &#39;typing-context
                                                                                      <span id='f0c2161'>(funcall &#39;util:copy-instance
                                                                                               <span id='f0c2156'>(ccl::typed-form
                                                                                                &#39;standard-object ctx)</span>
                                                                                               <span id='f0c2154'>&#39;:holes</span>
                                                                                               <span id='f0c2160'>(cons v
                                                                                                     <span id='f0c2159'>(funcall &#39;holes
                                                                                                              &#35;:g55913)</span>)</span>)</span>)</span>)</span>)</span>
                                                                     <span id='f0c2133'>(if <span id='f0c2041'>(not &#39;:ne
                                                                              <span id='f0c2040'>(if <span id='f0c2039'>(eq &#35;:g55915 &#39;:refine-integer)</span>
                                                                                  <span id='f0c2037'>&#39;(:refine-integer)</span>
                                                                                  nil)</span>)</span>
                                                                         <span id='f0c2062'>(progn nil
                                                                                <span id='f0c2061'>(funcall &#39;util:copy-instance
                                                                                         (ccl::typed-form
                                                                                          &#39;standard-object ctx)
                                                                                         <span id='f0c2042'>&#39;:holes</span>
                                                                                         <span id='f0c2059'>(cons v
                                                                                               <span id='f0c2058'>(funcall &#39;holes
                                                                                                        &#35;:g55913)</span>)</span>
                                                                                         <span id='f0c2060'>&#39;:hole-info</span>
                                                                                         <span id='f0c2054'>(funcall &#39;closure:insert
                                                                                                  <span id='f0c2053'>(ccl::typed-form
                                                                                                   &#39;closure:typ
                                                                                                   <span id='f0c2052'>(funcall &#39;hole-info
                                                                                                            &#35;:g55913)</span>)</span>
                                                                                                  <span id='f0c2044'>(ccl::typed-form
                                                                                                   &#39;keyword v)</span>
                                                                                                  <span id='f0c2050'>(funcall &#39;make-hole-information
                                                                                                           <span id='f0c2045'>&#39;:unrefined</span>
                                                                                                           <span id='f0c2049'>&#39;:int</span>
                                                                                                           <span id='f0c2046'>&#39;:term</span>
                                                                                                           <span id='f0c2048'>(cons val
                                                                                                                 nil)</span>)</span>)</span>)</span>)</span>
                                                                         <span id='f0c2132'>(if <span id='f0c2131'>(not &#39;:ne
                                                                                  <span id='f0c2130'>(if <span id='f0c2129'>(eq &#35;:g55915 &#39;:refine-array)</span>
                                                                                      <span id='f0c2127'>&#39;(:refine-array)</span>
                                                                                      nil)</span>)</span>
                                                                             <span id='f0c2126'>(progn nil
                                                                                    <span id='f0c2125'>(funcall &#39;util:copy-instance
                                                                                             (ccl::typed-form
                                                                                              &#39;standard-object ctx)
                                                                                             <span id='f0c2108'>&#39;:holes</span>
                                                                                             <span id='f0c2124'>(cons v
                                                                                                   <span id='f0c2123'>(funcall &#39;holes
                                                                                                            &#35;:g55913)</span>)</span>
                                                                                             <span id='f0c2120'>&#39;:hole-info</span>
                                                                                             <span id='f0c2119'>(funcall &#39;closure:insert
                                                                                                      <span id='f0c2116'>(ccl::typed-form
                                                                                                       &#39;closure:typ
                                                                                                       <span id='f0c2115'>(funcall &#39;hole-info
                                                                                                                &#35;:g55913)</span>)</span>
                                                                                                      <span id='f0c2118'>(ccl::typed-form
                                                                                                       &#39;keyword v)</span>
                                                                                                      <span id='f0c2113'>(funcall &#39;make-hole-information
                                                                                                               <span id='f0c2110'>&#39;:term</span>
                                                                                                               <span id='f0c2112'>(cons val
                                                                                                                     nil)</span>)</span>)</span>)</span>)</span>
                                                                             <span id='f0c2107'>(if <span id='f0c2065'>(funcall &#39;ccl:structure-typep
                                                                                          &#35;:g55915
                                                                                          <span id='f0c2063'>&#39;&#35;&#60;class-cell for depends-on &#35;x302001E2445D&#62;</span>)</span>
                                                                                 <span id='f0c2106'>(progn nil
                                                                                        <span id='f0c2105'>(funcall &#39;util:copy-instance
                                                                                                 (ccl::typed-form
                                                                                                  &#39;standard-object ctx)
                                                                                                 <span id='f0c2104'>&#39;:holes</span>
                                                                                                 <span id='f0c2081'>(cons v
                                                                                                       <span id='f0c2080'>(funcall &#39;holes
                                                                                                                &#35;:g55913)</span>)</span>
                                                                                                 <span id='f0c2103'>&#39;:hole-info</span>
                                                                                                 <span id='f0c2091'>(funcall &#39;closure:insert
                                                                                                          <span id='f0c2084'>(ccl::typed-form
                                                                                                           &#39;closure:typ
                                                                                                           <span id='f0c2083'>(funcall &#39;hole-info
                                                                                                                    &#35;:g55913)</span>)</span>
                                                                                                          <span id='f0c2086'>(ccl::typed-form
                                                                                                           &#39;keyword v)</span>
                                                                                                          <span id='f0c2090'>(funcall &#39;make-hole-information
                                                                                                                   <span id='f0c2087'>&#39;:term</span>
                                                                                                                   <span id='f0c2089'>(cons val
                                                                                                                         nil)</span>)</span>)</span>
                                                                                                 <span id='f0c2076'>&#39;:dependency</span>
                                                                                                 <span id='f0c2102'>(funcall &#39;dependency:determined-by
                                                                                                          <span id='f0c2099'>(ccl::typed-form
                                                                                                           &#39;dependency:typ
                                                                                                           <span id='f0c2098'>(funcall &#39;dependency
                                                                                                                    &#35;:g55913)</span>)</span>
                                                                                                          <span id='f0c2101'>(ccl::typed-form
                                                                                                           &#39;keyword v)</span>
                                                                                                          <span id='f0c2096'>(ccl::typed-form
                                                                                                           &#39;list
                                                                                                           <span id='f0c2095'>(ccl::struct-ref <span id='f0c2094'>(ccl::typed-form
                                                                                                                             &#39;depends-on
                                                                                                                             result)</span>
                                                                                                                            1)</span>)</span>)</span>)</span>)</span>
                                                                                 <span id='f0c2075'>(if <span id='f0c2074'>(progn &#35;:g55915 t)</span>
                                                                                     <span id='f0c2072'>(progn nil
                                                                                            <span id='f0c2071'>(values (funcall &#39;error
                                                                                                             <span id='f0c2067'>&#39;type-error</span>
                                                                                                             <span id='f0c2069'>&#39;:datum</span>
                                                                                                             &#35;:x55914
                                                                                                             <span id='f0c2066'>&#39;:expected-type</span>
                                                                                                             <span id='f0c2068'>&#39;typing-result</span>))</span>)</span>
                                                                                     nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>
                                                 <span id='f0c2021'>(let* ((&#35;:it55889 nil))
                                                   <span id='f0c2020'>(return-from trivia&#46;level1&#46;impl::whole
                                                     <span id='f0c2019'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>)</span>
                               nil)</span>)</span>)</span>
                       <span id='f0c2246'>(block trivia&#46;level1&#46;impl::clause
                         <span id='f0c2245'>(let* ((&#35;:it55885 &#35;:what155894))
                           <span id='f0c2244'>(if <span id='f0c2211'>(funcall &#39;ccl::std-instance-class-cell-typep
                                        &#35;:it55885
                                        <span id='f0c2209'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200398FACF&#62;))</span>)</span>
                               <span id='f0c2243'>(ccl::&#37;decls-body
                                <span id='f0c2242'>(let* ((introductions
                                        <span id='f0c2241'>(funcall &#39;ccl::slot-id-value
                                                 &#35;:it55885
                                                 <span id='f0c2240'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200398CAFF&#62;))</span>)</span>))
                                  <span id='f0c2238'>(let* ((body
                                          <span id='f0c2237'>(funcall &#39;ccl::slot-id-value
                                                   &#35;:it55885
                                                   <span id='f0c2235'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003989BAF&#62;))</span>)</span>))
                                    <span id='f0c2234'>(return-from trivia&#46;level1&#46;impl::whole
                                      <span id='f0c2233'>(let* ()
                                        <span id='f0c2232'>(block trivia&#46;level1&#46;impl::whole
                                          (progn <span id='f0c2228'>(let* ((&#35;:it55890 nil))
                                                   <span id='f0c2227'>(return-from trivia&#46;level1&#46;impl::whole
                                                     <span id='f0c2226'>(funcall &#39;reduce
                                                              <span id='f0c2219'>(let* ((&#35;:f55928
                                                                      <span id='f0c2213'>(funcall &#39;alexandria:ensure-function
                                                                               <span id='f0c2212'>(function annotate-term)</span>)</span>))
                                                                <span id='f0c2218'>(function <span id='f0c2217'>(lambda (serapeum::x serapeum::y)
                                                                            <span id='f0c2216'>(funcall &#35;:f55928
                                                                                     serapeum::y
                                                                                     serapeum::x)</span>)</span>)</span>)</span>
                                                              body
                                                              <span id='f0c2221'>&#39;:from-end</span>
                                                              nil
                                                              <span id='f0c2222'>&#39;:initial-value</span>
                                                              <span id='f0c2225'>(funcall &#39;make-starting-hole introductions context)</span>)</span>)</span>)</span>
                                                 <span id='f0c2231'>(let* ((&#35;:it55891 nil))
                                                   <span id='f0c2230'>(return-from trivia&#46;level1&#46;impl::whole
                                                     <span id='f0c2229'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>)</span>
                               nil)</span>)</span>)</span>
                       <span id='f0c2259'>(let* ((&#35;:otherwise55881 &#35;:what155894))
                         <span id='f0c2258'>(return-from trivia&#46;level1&#46;impl::whole
                           <span id='f0c2257'>(let* ()
                             <span id='f0c2256'>(block trivia&#46;level1&#46;impl::whole
                               <span id='f0c2255'>(let* ((&#35;:it55892 nil))
                                 <span id='f0c2254'>(return-from trivia&#46;level1&#46;impl::whole
                                   <span id='f0c2253'>(values (funcall &#39;error
                                                    <span id='f0c2250'>&#39;trivia&#46;level2:match-error</span>
                                                    <span id='f0c2247'>&#39;:pattern</span>
                                                    <span id='f0c2252'>&#39;(((alu&#46;ir&#46;new-terms:standalone-ret) context)
                                                      ((alu&#46;ir&#46;new-terms:bind :variable v :value val)
                                                       (multiple-value-bind (result ctx)
                                                           (annotate-term-no-binder val context)
                                                         (with-accessors
                                                           ((holes holes) (info hole-info) (dep dependency)
                                                            (closure typing-closure))
                                                           ctx
                                                           (etypecase-of typing-result
                                                                         result
                                                                         (type-info
                                                                          (util:copy-instance
                                                                            ctx
                                                                            :typing-closure
                                                                            (closure:insert closure v result)))
                                                                         (same-as
                                                                          (all-mutual (list (alu&#46;spec:copy-meta term
                                                                                                                (alu&#46;spec:make-reference
                                                                                                                  :name
                                                                                                                  v))
                                                                                            (alu&#46;spec:copy-meta val
                                                                                                                (alu&#46;spec:make-reference
                                                                                                                  :name
                                                                                                                  (same-as-value
                                                                                                                    result))))
                                                                                      (util:copy-instance
                                                                                        ctx
                                                                                        :holes
                                                                                        (cons v holes))))
                                                                         ((eql :refine-integer)
                                                                          (util:copy-instance
                                                                            ctx
                                                                            :holes
                                                                            (cons v holes)
                                                                            :hole-info
                                                                            (closure:insert info
                                                                                            v
                                                                                            (make-hole-information
                                                                                              :unrefined
                                                                                              :int
                                                                                              :term
                                                                                              (list val)))))
                                                                         ((eql :refine-array)
                                                                          (util:copy-instance
                                                                            ctx
                                                                            :holes
                                                                            (cons v holes)
                                                                            :hole-info
                                                                            (closure:insert info
                                                                                            v
                                                                                            (make-hole-information
                                                                                              :term
                                                                                              (list val)))))
                                                                         (depends-on
                                                                          (util:copy-instance
                                                                            ctx
                                                                            :holes
                                                                            (cons v holes)
                                                                            :hole-info
                                                                            (closure:insert info
                                                                                            v
                                                                                            (make-hole-information
                                                                                              :term
                                                                                              (list val)))
                                                                            :dependency
                                                                            (dependency:determined-by
                                                                              dep
                                                                              v
                                                                              (depends-on-value result))))))))
                                                      ((alu&#46;spec:bind-constraint :variable introductions :value body)
                                                       (mvfold (flip (function annotate-term))
                                                               body
                                                               (make-starting-hole introductions context))))</span>
                                                    <span id='f0c2251'>&#39;:values</span>
                                                    <span id='f0c2249'>(cons &#35;:otherwise55881 nil)</span>))</span>)</span>)</span>)</span>)</span>)</span>)</span>))</span>)</span>))
      <span id='f0c2270'>(if <span id='f0c2265'>(funcall &#39;ccl::std-instance-class-cell-typep
                   &#35;:datum55893
                   <span id='f0c2264'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200398094F&#62;))</span>)</span>
          &#35;:datum55893
          <span id='f0c2269'>(ccl::typed-form &#39;typing-context <span id='f0c2268'>(funcall &#39;serapeum::&#37;require-type &#35;:datum55893 <span id='f0c2266'>&#39;typing-context</span>)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>89</span> 
<span class='line'>90</span> (-&#62; annotate-term-no-binder
<span class='line'>91</span>     (ir:term-type-manipulation typing-context)
<span class='line'>92</span>     (values typing-result typing-context))
<span id='f0s60'><span class='line'>93</span> (defun annotate-term-no-binder (term context)
<span class='line'>94</span>   &#34;Annotating a term can either end up with the following results:
<span class='line'>95</span> 
<span class='line'>96</span> 1&#46; Error
<span class='line'>97</span>   - If the system is in an invalid state with the binder&#44; an error is
<span class='line'>98</span>     thrown&#46;
<span class='line'>99</span> 
<span class='line'>100</span> 2&#46; &#96;hole-conditions&#39;
<span class='line'>101</span>   - If the system needs more information to fully determine the type a
<span class='line'>102</span>     &#96;hole-conditions&#39; is returned&#46;
<span class='line'>103</span> 
<span class='line'>104</span> 3&#46; &#96;type-info&#39;
<span class='line'>105</span>   - If unification is completely successful&#44; then we get back a
<span class='line'>106</span>     &#96;type-info&#39;&#34;
<span class='line'>107</span>   <span id='f0s61'>(with-accessors ((holes holes) (info hole-info)
<span class='line'>108</span>                    (dep dependency) (closure typing-closure))
<span class='line'>109</span>       context
<span class='line'>110</span>     <span id='f0s62'>(match-of ir:term-type-manipulation term
<span class='line'>111</span>       ((number &#95;)
<span class='line'>112</span>        <span id='f0s63'>(values :refine-integer
<span class='line'>113</span>                context)</span>)
<span class='line'>114</span>       ((ir:reference :name name)
<span class='line'>115</span>        <span id='f0s64'>(let ((lookup <span id='f0s65'>(closure:lookup closure name)</span>))
<span class='line'>116</span>          <span id='f0s66'>(values <span id='f0s67'>(cond (lookup
<span class='line'>117</span>                         lookup)
<span class='line'>118</span>                        (<span id='f0s68'>(term-op:void-reference&#63; term)</span>
<span class='line'>119</span>                         <span id='f0s69'>(make-type-info :size 0
<span class='line'>120</span>                                         :type <span id='f0s70'>(ir:make-type-reference :name :void)</span>)</span>)
<span class='line'>121</span>                        (t
<span class='line'>122</span>                         <span id='f0s71'>(make-same-as :value name)</span>))</span>
<span class='line'>123</span>                  context)</span>)</span>)
<span class='line'>124</span>       &#59;&#59; Here we have a chance for unification&#44; as we know the type of
<span class='line'>125</span>       &#59;&#59; the fields
<span class='line'>126</span>       &#59;&#59;
<span class='line'>127</span>       &#59;&#59; TODO :: update the code to do unification of the arguments to
<span class='line'>128</span>       &#59;&#59;         the record&#44; and thus do CSP on values we now know&#46;
<span class='line'>129</span>       ((ir:record :name name)
<span class='line'>130</span>        <span id='f0s72'>(let* ((lookup <span id='f0s73'>(storage:lookup-type name)</span>))
<span class='line'>131</span>          <span id='f0s74'>(if lookup
<span class='line'>132</span>              <span id='f0s75'>(values <span id='f0s76'>(make-type-info
<span class='line'>133</span>                       :size <span id='f0s77'>(size:storage lookup)</span>
<span class='line'>134</span>                       :type <span id='f0s78'>(ir:make-type-reference :name name)</span>)</span>
<span class='line'>135</span>                      context)</span>
<span class='line'>136</span>              <span id='f0s79'>(log:error term <span id='f0s80'>&#39;(:type :not-defined)</span>
<span class='line'>137</span>                          <span id='f0s81'>&#34;the record type &#126;A: is not defined&#34;</span> name)</span>)</span>)</span>)
<span class='line'>138</span>       &#59;&#59; This case isn&#39;t hard&#44; just mostly tedious&#46; All we have to do
<span class='line'>139</span>       &#59;&#59; is get the field of the record&#46; Which can be done
<span class='line'>140</span>       &#59;&#59; mechanically&#46;&#46;&#46;
<span class='line'>141</span>       &#59;&#59;
<span class='line'>142</span>       &#59;&#59; TODO :: Abstract out the mechanical lookup from record-lookup
<span class='line'>143</span>       &#59;&#59;         to field type&#46;
<span class='line'>144</span>       &#59;&#59;
<span class='line'>145</span>       &#59;&#59; Further if the record isn&#39;t known yet&#44; that&#39;s fine&#44; add the
<span class='line'>146</span>       &#59;&#59; record reference as a dependency and solve again after we
<span class='line'>147</span>       &#59;&#59; unify&#46;
<span class='line'>148</span>       ((ir:record-lookup :record rec :field field)
<span class='line'>149</span>        <span id='f0s82'>(let* ((rec <span id='f0s83'>(etypecase-of ir:term-normal-form rec
<span class='line'>150</span>                      (number <span id='f0s84'>(log:error term
<span class='line'>151</span>                                         <span id='f0s85'>&#39;(:type)</span>
<span class='line'>152</span>                                         <span id='f0s86'>&#34;can&#39;t index into a numerical literal: &#126;A&#34;</span>
<span class='line'>153</span>                                         rec)</span>)
<span class='line'>154</span>                      (ir:reference <span id='f0s87'>(ir:name rec)</span>))</span>)
<span class='line'>155</span>               (lookup <span id='f0s88'>(closure:lookup closure rec)</span>))
<span class='line'>156</span>          &#59;&#59; replace with typecase-of&#46;&#46;&#46; what are you doing&#44; me
<span class='line'>157</span>          <span id='f0s89'>(cond (<span id='f0s90'>(and lookup <span id='f0s91'>(typep <span id='f0s92'>(type-info-type lookup)</span> &#39;ir:reference-type)</span>)</span>
<span class='line'>158</span>                 <span id='f0s93'>(let* ((field-name <span id='f0s94'>(ir:name <span id='f0s95'>(type-info-type lookup)</span>)</span>)
<span class='line'>159</span>                        (lookup     <span id='f0s96'>(storage:lookup-type field-name)</span>))
<span class='line'>160</span>                   <span id='f0s97'>(typecase-of ir:type-storage lookup
<span class='line'>161</span>                     (ir:primitive
<span class='line'>162</span>                      <span id='f0s98'>(log:error term :type
<span class='line'>163</span>                                 <span id='f0s99'>&#34;&#126;A is a primitive type not a record type&#34;</span> field-name)</span>)
<span class='line'>164</span>                     (otherwise
<span class='line'>165</span>                      <span id='f0s100'>(error <span id='f0s101'>&#34;type &#126;A does not exist&#34;</span> field-name)</span>)
<span class='line'>166</span>                     (ir:type-declaration
<span class='line'>167</span>                      <span id='f0s102'>(etypecase-of ir:type-format <span id='f0s103'>(ir:decl lookup)</span>
<span class='line'>168</span>                        (ir:sum-decl
<span class='line'>169</span>                         <span id='f0s104'>(log:error term :type
<span class='line'>170</span>                                    <span id='f0s105'>&#34;Trying to index into the sum type &#126;A&#34;</span> field-name)</span>)
<span class='line'>171</span>                        (ir:record-decl
<span class='line'>172</span>                         <span id='f0s106'>(let ((field-type <span id='f0s107'>(sycamore:tree-map-find
<span class='line'>173</span>                                            <span id='f0s108'>(ir:contents <span id='f0s109'>(ir:decl lookup)</span>)</span>
<span class='line'>174</span>                                            field)</span>))
<span class='line'>175</span>                           <span id='f0s110'>(if field-type
<span class='line'>176</span>                               <span id='f0s111'>(values <span id='f0s112'>(make-type-info
<span class='line'>177</span>                                        :type field-type
<span class='line'>178</span>                                        :size <span id='f0s113'>(size:reference field-type)</span>)</span>
<span class='line'>179</span>                                       context)</span>
<span class='line'>180</span>                               <span id='f0s114'>(log:error term :type
<span class='line'>181</span>                                          <span id='f0s115'>&#34;the field &#126;A does not exist in record type: &#126;A&#34;</span>
<span class='line'>182</span>                                          field-name <span id='f0s116'>(ir:name lookup)</span>)</span>)</span>)</span>))</span>))</span>)</span>)
<span class='line'>183</span>                (lookup
<span class='line'>184</span>                 <span id='f0s117'>(log:error term :type <span id='f0s118'>&#34;Record types currently cannot be applied&#34;</span>)</span>)
<span class='line'>185</span>                (t
<span class='line'>186</span>                 <span id='f0s119'>(values
<span class='line'>187</span>                  <span id='f0s120'>(make-depends-on :value <span id='f0s121'>(list rec)</span>)</span>
<span class='line'>188</span>                  context)</span>))</span>)</span>)
<span class='line'>189</span>       &#59;&#59; This is an interesting case&#46; We know the types of functions&#44;
<span class='line'>190</span>       &#59;&#59; in fact we even know the type of primitives&#33; This opens up
<span class='line'>191</span>       &#59;&#59; the can of worms of unification and type checking&#46;
<span class='line'>192</span>       &#59;&#59;
<span class='line'>193</span>       &#59;&#59; If the function is a known user gate&#44; then we can unify the
<span class='line'>194</span>       &#59;&#59; arguments type wise and even report proper error messages for
<span class='line'>195</span>       &#59;&#59; typing errors&#46;
<span class='line'>196</span>       &#59;&#59;
<span class='line'>197</span>       &#59;&#59; If the function is a primitive&#44; then our job gets a bit more
<span class='line'>198</span>       &#59;&#59; complex&#46; Functions like &#96;+&#39; and &#96;*&#39; can be applied to many
<span class='line'>199</span>       &#59;&#59; different integer types&#44; however since we want explicit
<span class='line'>200</span>       &#59;&#59; casting (thus and int8 can only be added to another int8 and
<span class='line'>201</span>       &#59;&#59; not an int16)&#44; all arguments must be of the same
<span class='line'>202</span>       &#59;&#59; type&#46; Further if we add only constants&#46; (+ 12 35)&#44; we don&#39;t
<span class='line'>203</span>       &#59;&#59; know the type of the addition until it is used
<span class='line'>204</span>       &#59;&#59; elsewhere&#46; Thus we build up more constraints to be solved&#46;
<span class='line'>205</span>       ((ir:application :name (ir:reference :name func) :arguments args)
<span class='line'>206</span>        <span id='f0s122'>(match-of (or ir:function-type null) <span id='f0s123'>(storage:lookup-function func)</span>
<span class='line'>207</span>          ((ir:circuit :arguments circ-args :return-type ret)
<span class='line'>208</span>           <span id='f0s124'>(let ((types <span id='f0s125'>(mapcar <span id='f0s126'>&#35;&#39;ir:typ </span>circ-args)</span>))
<span class='line'>209</span>             <span id='f0s127'>(values <span id='f0s128'>(make-type-info
<span class='line'>210</span>                      :type ret
<span class='line'>211</span>                      :size <span id='f0s129'>(size:reference ret)</span>)</span>
<span class='line'>212</span>                     &#59;&#59; this may fail but it&#39;ll throw an error
<span class='line'>213</span>                     <span id='f0s130'>(mvfold <span id='f0s131'>(lambda (context pair)
<span class='line'>214</span>                               <span id='f0s132'>(unify <span id='f0s133'>(car pair)</span> <span id='f0s134'>(cdr pair)</span> context)</span>)</span>
<span class='line'>215</span>                             <span id='f0s135'>(mapcar <span id='f0s136'>&#35;&#39;cons </span>args types)</span>
<span class='line'>216</span>                             context)</span>)</span>)</span>)
<span class='line'>217</span>          ((ir:primitive :name name)
<span class='line'>218</span>           <span id='f0s137'>(flet (<span id='f0s138'>(handle-all-int-case ()
<span class='line'>219</span>                    <span id='f0s139'>(arguments-have-same-type args
<span class='line'>220</span>                                              context
<span class='line'>221</span>                                              <span id='f0s140'>&#35;&#39;find-integer-type-from-args</span>)</span>)</span>)
<span class='line'>222</span>             <span id='f0s141'>(typecase-of known-primitve-functions name
<span class='line'>223</span>               ((or (eql :*) (eql :+))
<span class='line'>224</span>                <span id='f0s142'>(handle-all-int-case)</span>)
<span class='line'>225</span>               &#59;&#59; TODO :: Should &#61; be to integer&#47;bool types only&#63; it is a
<span class='line'>226</span>               &#59;&#59;         constraint satisfaction&#44; so we could extend it&#46;
<span class='line'>227</span>               ((eql :&#61;)
<span class='line'>228</span>                <span id='f0s143'>(handle-all-int-case)</span>)
<span class='line'>229</span>               &#59;&#59; TODO :: We should actually allow different integer
<span class='line'>230</span>               &#59;&#59;         types here
<span class='line'>231</span>               ((eql :exp)
<span class='line'>232</span>                <span id='f0s144'>(handle-all-int-case)</span>)
<span class='line'>233</span>               &#59;&#59; TODO :: Find a way to type custom user primitives for
<span class='line'>234</span>               &#59;&#59;         better interopt&#46;
<span class='line'>235</span>               (otherwise <span id='f0s145'>(log:error
<span class='line'>236</span>                           term :type
<span class='line'>237</span>                           <span id='f0s146'>&#34;unknown primitive &#126;A&#46; Don&#39;t know how to type it&#46;&#34;</span>
<span class='line'>238</span>                           name)</span>))</span>)</span>)
<span class='line'>239</span>          (null
<span class='line'>240</span>           <span id='f0s147'>(log:error term :type <span id='f0s148'>&#34;Function &#126;A: is not defined&#34;</span> func)</span>))</span>)
<span class='line'>241</span>       ((ir:application :name func)
<span class='line'>242</span>        <span id='f0s149'>(log:error term :type
<span class='line'>243</span>                   <span id='f0s150'>&#34;Can not apply &#126;A&#46; Expecting a reference to a function not a number&#34;</span>
<span class='line'>244</span>                   func)</span>)
<span class='line'>245</span>       &#59;&#59; we actually ignore the value for type checking as we just
<span class='line'>246</span>       &#59;&#59; care about type information&#46;
<span class='line'>247</span>       ((ir:type-coerce :typ typ)
<span class='line'>248</span>        <span id='f0s151'>(values <span id='f0s152'>(make-type-info :size <span id='f0s153'>(size:reference typ)</span>
<span class='line'>249</span>                                :type typ)</span>
<span class='line'>250</span>                context)</span>)
<span class='line'>251</span>       &#59;&#59; In this case we just unify the value against the type&#44; and
<span class='line'>252</span>       &#59;&#59; return the type&#46;
<span class='line'>253</span>       ((ir:type-check :value value :typ typ)
<span class='line'>254</span>        <span id='f0s154'>(values
<span class='line'>255</span>         <span id='f0s155'>(make-type-info :size <span id='f0s156'>(size:reference typ)</span>
<span class='line'>256</span>                         :type typ)</span>
<span class='line'>257</span>         <span id='f0s157'>(unify value typ context)</span>)</span>)
<span class='line'>258</span>       ((ir:array-lookup :arr arr)
<span class='line'>259</span>        <span id='f0s158'>(let* ((lookup
<span class='line'>260</span>                 <span id='f0s159'>(etypecase-of ir:term-normal-form arr
<span class='line'>261</span>                   (number <span id='f0s160'>(log:error term :type <span id='f0s161'>&#34;Array lookup on the number &#126;A&#34;</span> arr)</span>)
<span class='line'>262</span>                   (ir:reference <span id='f0s162'>(closure:lookup closure <span id='f0s163'>(ir:name arr)</span>)</span>))</span>)
<span class='line'>263</span>               (value-type
<span class='line'>264</span>                 <span id='f0s164'>(cond (<span id='f0s165'>(and lookup <span id='f0s166'>(type-op:array-reference&#63; (type-info-type lookup))</span>)</span>
<span class='line'>265</span>                        <span id='f0s167'>(let ((type
<span class='line'>266</span>                                <span id='f0s168'>(ir:array-type-content (type-info-type lookup))</span>))
<span class='line'>267</span>                          <span id='f0s169'>(make-type-info :type type
<span class='line'>268</span>                                          :size <span id='f0s170'>(size:reference type)</span>)</span>)</span>)
<span class='line'>269</span>                       (lookup
<span class='line'>270</span>                        <span id='f0s171'>(log:error term :type
<span class='line'>271</span>                                   <span id='f0s172'>&#34;Type &#126;A is not of type Array&#34;</span> <span id='f0s173'>(type-info-type lookup)</span>)</span>)
<span class='line'>272</span>                       (t nil))</span>))
<span class='line'>273</span>          <span id='f0s174'>(values
<span class='line'>274</span>           <span id='f0s175'>(if lookup
<span class='line'>275</span>               value-type
<span class='line'>276</span>               <span id='f0s176'>(make-depends-on :value <span id='f0s177'>(list <span id='f0s178'>(ir:name arr)</span>)</span>)</span>)</span>
<span class='line'>277</span>           context)</span>)</span>)
<span class='line'>278</span>       ((ir:array-set :arr arr :value value)
<span class='line'>279</span>        <span id='f0s179'>(let* ((lookup-val <span id='f0s180'>(normal-form-to-type-info value context)</span>)
<span class='line'>280</span>               (lookup-arr <span id='f0s181'>(normal-form-to-type-info-not-number-err term arr context)</span>)
<span class='line'>281</span>               (context
<span class='line'>282</span>                 <span id='f0s182'>(dispatch-case ((lookup-arr lookup-type)
<span class='line'>283</span>                                 (lookup-val lookup-type))
<span class='line'>284</span>                   &#59;&#59; We will leave some holes&#44; as currently we force the
<span class='line'>285</span>                   &#59;&#59; submission of the type with an array&#46; This should
<span class='line'>286</span>                   &#59;&#59; change&#44; and we should be able to understand the length
<span class='line'>287</span>                   &#59;&#59; of a hole
<span class='line'>288</span>                   ((hole type-info)
<span class='line'>289</span>                    &#59;&#59; can&#39;t actually hit here&#33;
<span class='line'>290</span>                    <span id='f0s183'>(log:error term :type
<span class='line'>291</span>                               <span id='f0s184'>&#34;No Type Inference for the type of the array yet&#33;&#34;</span>)</span>)
<span class='line'>292</span>                   ((hole hole)
<span class='line'>293</span>                    &#59;&#59; can&#39;t actually hit here&#33;
<span class='line'>294</span>                    <span id='f0s185'>(log:error term :type
<span class='line'>295</span>                               <span id='f0s186'>&#34;No Type Inference for the type of the array yet&#33;&#34;</span>)</span>)
<span class='line'>296</span>                   ((type-info type-info)
<span class='line'>297</span>                    <span id='f0s187'>(if <span id='f0s188'>(type-equality <span id='f0s189'>(ir:array-type-content
<span class='line'>298</span>                                        (type-info-type lookup-arr))</span>
<span class='line'>299</span>                                       (type-info-type lookup-val))</span>
<span class='line'>300</span>                        context
<span class='line'>301</span>                        <span id='f0s190'>(log:error term :type
<span class='line'>302</span>                                   <span id='f0s191'>&#34;Array &#126;A does not have element type of &#126;A&#34;</span>
<span class='line'>303</span>                                   arr lookup-val)</span>)</span>)
<span class='line'>304</span>                   ((type-info hole)
<span class='line'>305</span>                    <span id='f0s192'>(unify value
<span class='line'>306</span>                           <span id='f0s193'>(ir:array-type-content (type-info-type lookup-arr))</span>
<span class='line'>307</span>                           context)</span>))</span>))
<span class='line'>308</span>          <span id='f0s194'>(values <span id='f0s195'>(make-type-info :size 0
<span class='line'>309</span>                                  :type <span id='f0s196'>(ir:make-type-reference :name :void)</span>)</span>
<span class='line'>310</span>                  context)</span>)</span>)
<span class='line'>311</span>       ((ir:array-allocate :size s :typ ty)
<span class='line'>312</span>        &#59;&#59; abstract out this make array
<span class='line'>313</span>        <span id='f0s197'>(values <span id='f0s198'>(make-type-info
<span class='line'>314</span>                 :size <span id='f0s199'>(* s <span id='f0s200'>(size:reference ty)</span>)</span>
<span class='line'>315</span>                 :type <span id='f0s201'>(ir:array-type :length s :type ty)</span>)</span>
<span class='line'>316</span>                context)</span>)
<span class='line'>317</span>       ((ir:from-data :contents contents)
<span class='line'>318</span>        <span id='f0s202'>(multiple-value-bind (arg context) <span id='f0s203'>(arguments-have-same-type contents context)</span>
<span class='line'>319</span>          <span id='f0s204'>(etypecase-of typing-result arg
<span class='line'>320</span>            (type-info
<span class='line'>321</span>             <span id='f0s205'>(values <span id='f0s206'>(make-type-info
<span class='line'>322</span>                      :size <span id='f0s207'>(* <span id='f0s208'>(length contents)</span>
<span class='line'>323</span>                               <span id='f0s209'>(type-info-size arg)</span>)</span>
<span class='line'>324</span>                      :type <span id='f0s210'>(ir:array-type :length <span id='f0s211'>(length contents)</span>
<span class='line'>325</span>                                           :type (type-info-type arg))</span>)</span>
<span class='line'>326</span>                     context)</span>)
<span class='line'>327</span>            (depends-on            <span id='f0s212'>(values arg context)</span>)
<span class='line'>328</span>            ((eql :refine-array)   <span id='f0s213'>(values arg context)</span>)
<span class='line'>329</span>            (same-as               <span id='f0s214'>(values <span id='f0s215'>(make-depends-on
<span class='line'>330</span>                                            :value <span id='f0s216'>(list <span id='f0s217'>(same-as-value arg)</span>)</span>)</span>
<span class='line'>331</span>                                           context)</span>)
<span class='line'>332</span>            ((eql :refine-integer) <span id='f0s218'>(values :refine-integer context)</span>))</span>)</span>))</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t60')><span class='toggle' id='pf0t60'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(60)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t60'><code><span id='f0c2006'> (lambda (term context)
   <span id='f0c2005'>(let* ((&#35;:g55945 context))
     <span id='f0c2004'>(let* ((&#35;:what155987 term))
       <span id='f0c2003'>(block trivia&#46;level1&#46;impl::whole
         (progn <span id='f0c1727'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1726'>(let* ((&#35;:it55948 &#35;:what155987))
                    <span id='f0c1725'>(if <span id='f0c1724'>(funcall &#39;numberp &#35;:it55948)</span>
                        <span id='f0c1722'>(ccl::&#37;decls-body
                         <span id='f0c1721'>(return-from trivia&#46;level1&#46;impl::whole
                           <span id='f0c1720'>(let* ()
                             <span id='f0c1719'>(block trivia&#46;level1&#46;impl::whole
                               (progn <span id='f0c1715'>(let* ((&#35;:it55964 nil))
                                        <span id='f0c1714'>(return-from trivia&#46;level1&#46;impl::whole <span id='f0c1713'>(values <span id='f0c1711'>&#39;:refine-integer</span> context)</span>)</span>)</span>
                                      <span id='f0c1718'>(let* ((&#35;:it55965 nil))
                                        <span id='f0c1717'>(return-from trivia&#46;level1&#46;impl::whole
                                          <span id='f0c1716'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c992'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c991'>(let* ((&#35;:it55949 &#35;:what155987))
                    <span id='f0c990'>(if <span id='f0c989'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55949
                                 <span id='f0c988'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200399625F&#62;))</span>)</span>
                        <span id='f0c986'>(ccl::&#37;decls-body
                         <span id='f0c985'>(let* ((name
                                 <span id='f0c984'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55949
                                          <span id='f0c983'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200399326F&#62;))</span>)</span>))
                           <span id='f0c981'>(return-from trivia&#46;level1&#46;impl::whole
                             <span id='f0c980'>(let* ()
                               <span id='f0c979'>(block trivia&#46;level1&#46;impl::whole
                                 (progn <span id='f0c975'>(let* ((&#35;:it55966 nil))
                                          <span id='f0c974'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c973'>(let* ((lookup
                                                    <span id='f0c953'>(funcall &#39;closure:lookup
                                                             <span id='f0c952'>(ccl::typed-form &#39;closure:typ
                                                              <span id='f0c951'>(funcall &#39;typing-closure &#35;:g55945)</span>)</span>
                                                             <span id='f0c949'>(ccl::typed-form &#39;keyword name)</span>)</span>))
                                              <span id='f0c972'>(values <span id='f0c970'>(if lookup
                                                          lookup
                                                          <span id='f0c967'>(if <span id='f0c956'>(funcall &#39;term-op:void-reference&#63;
                                                                       <span id='f0c955'>(ccl::typed-form &#39;alu&#46;spec:reference term)</span>)</span>
                                                              <span id='f0c963'>(funcall &#39;make-type-info
                                                                       <span id='f0c961'>&#39;:size</span>
                                                                       0
                                                                       <span id='f0c960'>&#39;:type</span>
                                                                       <span id='f0c959'>(funcall &#39;alu&#46;spec:make-type-reference
                                                                                <span id='f0c958'>&#39;:name</span>
                                                                                <span id='f0c957'>&#39;:void</span>)</span>)</span>
                                                              <span id='f0c966'>(funcall &#39;make-same-as <span id='f0c965'>&#39;:value</span> name)</span>)</span>)</span>
                                                      context)</span>)</span>)</span>)</span>
                                        <span id='f0c978'>(let* ((&#35;:it55967 nil))
                                          <span id='f0c977'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c976'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c2002'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c2001'>(let* ((&#35;:it55950 &#35;:what155987))
                    <span id='f0c2000'>(if <span id='f0c1964'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55950
                                 <span id='f0c1963'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200398B41F&#62;))</span>)</span>
                        <span id='f0c1999'>(ccl::&#37;decls-body
                         <span id='f0c1998'>(let* ((name
                                 <span id='f0c1997'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55950
                                          <span id='f0c1995'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x30200398844F&#62;))</span>)</span>))
                           <span id='f0c1994'>(return-from trivia&#46;level1&#46;impl::whole
                             <span id='f0c1993'>(let* ()
                               <span id='f0c1992'>(block trivia&#46;level1&#46;impl::whole
                                 (progn <span id='f0c1991'>(let* ((&#35;:it55968 nil))
                                          <span id='f0c1990'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c1989'>(let* ((lookup
                                                    <span id='f0c1970'>(funcall &#39;storage:lookup-type <span id='f0c1969'>(ccl::typed-form &#39;keyword name)</span>)</span>))
                                              <span id='f0c1988'>(if lookup
                                                  <span id='f0c1981'>(values <span id='f0c1980'>(funcall &#39;make-type-info
                                                                   <span id='f0c1979'>&#39;:size</span>
                                                                   <span id='f0c1975'>(funcall &#39;size:storage
                                                                            <span id='f0c1974'>(ccl::typed-form
                                                                             &#39;(or alu&#46;spec:primitive
                                                                                  alu&#46;spec:type-declaration)
                                                                             lookup)</span>)</span>
                                                                   <span id='f0c1972'>&#39;:type</span>
                                                                   <span id='f0c1978'>(funcall &#39;alu&#46;spec:make-type-reference <span id='f0c1977'>&#39;:name</span> name)</span>)</span>
                                                          context)</span>
                                                  <span id='f0c1987'>(funcall &#39;log:error
                                                           term
                                                           <span id='f0c1985'>&#39;(:type :not-defined)</span>
                                                           <span id='f0c1986'>&#39;&#34;the record type &#126;A: is not defined&#34;</span>
                                                           name)</span>)</span>)</span>)</span>)</span>
                                        <span id='f0c1967'>(let* ((&#35;:it55969 nil))
                                          <span id='f0c1966'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c1965'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1457'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1456'>(let* ((&#35;:it55951 &#35;:what155987))
                    <span id='f0c1455'>(if <span id='f0c1454'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55951
                                 <span id='f0c1452'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039D79FF&#62;))</span>)</span>
                        <span id='f0c1451'>(ccl::&#37;decls-body
                         <span id='f0c1450'>(let* ((rec
                                 <span id='f0c1294'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55951
                                          <span id='f0c1292'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039D4A2F&#62;))</span>)</span>))
                           <span id='f0c1449'>(let* ((field
                                   <span id='f0c1297'>(funcall &#39;ccl::slot-id-value
                                            &#35;:it55951
                                            <span id='f0c1295'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039D1ADF&#62;))</span>)</span>))
                             <span id='f0c1448'>(return-from trivia&#46;level1&#46;impl::whole
                               <span id='f0c1447'>(let* ()
                                 <span id='f0c1446'>(block trivia&#46;level1&#46;impl::whole
                                   (progn <span id='f0c1442'>(let* ((&#35;:it55970 nil))
                                            <span id='f0c1441'>(return-from trivia&#46;level1&#46;impl::whole
                                              <span id='f0c1440'>(let* ((rec
                                                      <span id='f0c1433'>(let* ((&#35;:x56021 rec))
                                                        <span id='f0c1432'>(let* ((&#35;:g56022 &#35;:x56021))
                                                          <span id='f0c1431'>(if <span id='f0c1430'>(funcall &#39;numberp &#35;:g56022)</span>
                                                              <span id='f0c1428'>(progn nil
                                                                     <span id='f0c1427'>(funcall &#39;log:error
                                                                              term
                                                                              <span id='f0c1423'>&#39;(:type)</span>
                                                                              <span id='f0c1426'>&#39;&#34;can&#39;t index into a numerical literal: &#126;A&#34;</span>
                                                                              rec)</span>)</span>
                                                              <span id='f0c1422'>(if <span id='f0c1411'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                           &#35;:g56022
                                                                           <span id='f0c1409'>&#39;(&#35;:load-time-eval
                                                                              (funcall &#35;&#60;Anonymous Function &#35;x3020039CB1AF&#62;))</span>)</span>
                                                                  <span id='f0c1408'>(progn nil <span id='f0c1407'>(funcall &#39;alu&#46;spec:name rec)</span>)</span>
                                                                  <span id='f0c1421'>(if <span id='f0c1420'>(progn &#35;:g56022 t)</span>
                                                                      <span id='f0c1418'>(progn nil
                                                                             <span id='f0c1417'>(values (funcall &#39;error
                                                                                              <span id='f0c1412'>&#39;type-error</span>
                                                                                              <span id='f0c1415'>&#39;:datum</span>
                                                                                              &#35;:x56021
                                                                                              <span id='f0c1416'>&#39;:expected-type</span>
                                                                                              <span id='f0c1414'>&#39;alu&#46;spec:term-normal-form</span>))</span>)</span>
                                                                      nil)</span>)</span>)</span>)</span>)</span>)
                                                     (lookup
                                                      <span id='f0c1439'>(funcall &#39;closure:lookup
                                                               <span id='f0c1436'>(ccl::typed-form &#39;closure:typ
                                                                <span id='f0c1435'>(funcall &#39;typing-closure &#35;:g55945)</span>)</span>
                                                               <span id='f0c1438'>(ccl::typed-form &#39;keyword rec)</span>)</span>))
                                                <span id='f0c1405'>(if <span id='f0c1306'>(if lookup
                                                        <span id='f0c1305'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                 <span id='f0c1304'>(ccl::typed-form
                                                                  &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                                  <span id='f0c1303'>(ccl::struct-ref <span id='f0c1302'>(ccl::typed-form &#39;type-info lookup)</span>
                                                                                   2)</span>)</span>
                                                                 <span id='f0c1299'>&#39;(&#35;:load-time-eval
                                                                    (funcall &#35;&#60;Anonymous Function &#35;x3020039C556F&#62;))</span>)</span>
                                                        nil)</span>
                                                    <span id='f0c1392'>(let* ((field-name
                                                            <span id='f0c1388'>(funcall &#39;alu&#46;spec:name
                                                                     <span id='f0c1387'>(ccl::typed-form
                                                                      &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                                      <span id='f0c1386'>(ccl::struct-ref <span id='f0c1384'>(ccl::typed-form &#39;type-info
                                                                                        lookup)</span>
                                                                                       2)</span>)</span>)</span>)
                                                           (lookup
                                                            <span id='f0c1391'>(funcall &#39;storage:lookup-type
                                                                     <span id='f0c1390'>(ccl::typed-form &#39;keyword field-name)</span>)</span>))
                                                      <span id='f0c1382'>(let* ((&#35;:g56029 lookup))
                                                        <span id='f0c1381'>(if <span id='f0c1309'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                     &#35;:g56029
                                                                     <span id='f0c1307'>&#39;(&#35;:load-time-eval
                                                                        (funcall &#35;&#60;Anonymous Function &#35;x3020039FEEBF&#62;))</span>)</span>
                                                            <span id='f0c1315'>(progn nil
                                                                   <span id='f0c1314'>(funcall &#39;log:error
                                                                            term
                                                                            <span id='f0c1311'>&#39;:type</span>
                                                                            <span id='f0c1312'>&#39;&#34;&#126;A is a primitive type not a record type&#34;</span>
                                                                            field-name)</span>)</span>
                                                            <span id='f0c1380'>(if <span id='f0c1325'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                         &#35;:g56029
                                                                         <span id='f0c1323'>&#39;(&#35;:load-time-eval
                                                                            (funcall &#35;&#60;Anonymous Function &#35;x3020039FB8DF&#62;))</span>)</span>
                                                                <span id='f0c1379'>(progn nil
                                                                       <span id='f0c1378'>(let* ((&#35;:x56036
                                                                               <span id='f0c1327'>(funcall &#39;alu&#46;spec:decl lookup)</span>))
                                                                         <span id='f0c1377'>(let* ((&#35;:g56037 &#35;:x56036))
                                                                           <span id='f0c1376'>(if <span id='f0c1375'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                                        &#35;:g56037
                                                                                        <span id='f0c1373'>&#39;(&#35;:load-time-eval
                                                                                           (funcall &#35;&#60;Anonymous Function &#35;x3020039F70AF&#62;))</span>)</span>
                                                                               <span id='f0c1333'>(progn nil
                                                                                      <span id='f0c1332'>(funcall &#39;log:error
                                                                                               term
                                                                                               <span id='f0c1331'>&#39;:type</span>
                                                                                               <span id='f0c1329'>&#39;&#34;Trying to index into the sum type &#126;A&#34;</span>
                                                                                               field-name)</span>)</span>
                                                                               <span id='f0c1372'>(if <span id='f0c1336'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                                            &#35;:g56037
                                                                                            <span id='f0c1335'>&#39;(&#35;:load-time-eval
                                                                                               (funcall &#35;&#60;Anonymous Function &#35;x3020039F3ACF&#62;))</span>)</span>
                                                                                   <span id='f0c1361'>(progn nil
                                                                                          <span id='f0c1360'>(let* ((field-type
                                                                                                  <span id='f0c1341'>(funcall &#39;sycamore:tree-map-find
                                                                                                           <span id='f0c1340'>(funcall &#39;alu&#46;spec:contents
                                                                                                                    <span id='f0c1339'>(funcall &#39;alu&#46;spec:decl
                                                                                                                             lookup)</span>)</span>
                                                                                                           field)</span>))
                                                                                            <span id='f0c1359'>(if field-type
                                                                                                <span id='f0c1351'>(values <span id='f0c1349'>(funcall &#39;make-type-info
                                                                                                                 <span id='f0c1348'>&#39;:type</span>
                                                                                                                 field-type
                                                                                                                 <span id='f0c1344'>&#39;:size</span>
                                                                                                                 <span id='f0c1347'>(funcall &#39;size:reference
                                                                                                                          <span id='f0c1346'>(ccl::typed-form
                                                                                                                           &#39;(or alu&#46;spec:reference-type
                                                                                                                                alu&#46;spec:application)
                                                                                                                           field-type)</span>)</span>)</span>
                                                                                                        context)</span>
                                                                                                <span id='f0c1358'>(funcall &#39;log:error
                                                                                                         term
                                                                                                         <span id='f0c1356'>&#39;:type</span>
                                                                                                         <span id='f0c1357'>&#39;&#34;the field &#126;A does not exist in record type: &#126;A&#34;</span>
                                                                                                         field-name
                                                                                                         <span id='f0c1354'>(funcall &#39;alu&#46;spec:name
                                                                                                                  lookup)</span>)</span>)</span>)</span>)</span>
                                                                                   <span id='f0c1371'>(if <span id='f0c1363'>(progn &#35;:g56037 t)</span>
                                                                                       <span id='f0c1370'>(progn nil
                                                                                              <span id='f0c1369'>(values (funcall &#39;error
                                                                                                               <span id='f0c1366'>&#39;type-error</span>
                                                                                                               <span id='f0c1368'>&#39;:datum</span>
                                                                                                               &#35;:x56036
                                                                                                               <span id='f0c1365'>&#39;:expected-type</span>
                                                                                                               <span id='f0c1364'>&#39;alu&#46;spec:type-format</span>))</span>)</span>
                                                                                       nil)</span>)</span>)</span>)</span>)</span>)</span>
                                                                <span id='f0c1322'>(if <span id='f0c1321'>(progn &#35;:g56029 t)</span>
                                                                    <span id='f0c1319'>(progn nil
                                                                           <span id='f0c1318'>(values (funcall &#39;error
                                                                                            <span id='f0c1316'>&#39;&#34;type &#126;A does not exist&#34;</span>
                                                                                            field-name))</span>)</span>
                                                                    nil)</span>)</span>)</span>)</span>)</span>
                                                    <span id='f0c1404'>(if lookup
                                                        <span id='f0c1403'>(funcall &#39;log:error
                                                                 term
                                                                 <span id='f0c1402'>&#39;:type</span>
                                                                 <span id='f0c1401'>&#39;&#34;Record types currently cannot be applied&#34;</span>)</span>
                                                        <span id='f0c1398'>(values <span id='f0c1396'>(funcall &#39;make-depends-on <span id='f0c1395'>&#39;:value</span> <span id='f0c1394'>(cons rec nil)</span>)</span>
                                                                context)</span>)</span>)</span>)</span>)</span>)</span>
                                          <span id='f0c1445'>(let* ((&#35;:it55971 nil))
                                            <span id='f0c1444'>(return-from trivia&#46;level1&#46;impl::whole
                                              <span id='f0c1443'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1278'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1277'>(let* ((&#35;:fusion55961 &#35;:what155987))
                    <span id='f0c1276'>(if <span id='f0c1275'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:fusion55961
                                 <span id='f0c1273'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039EABAF&#62;))</span>)</span>
                        <span id='f0c1272'>(ccl::&#37;decls-body
                         <span id='f0c1271'>(let* ((&#35;:it55952 &#35;:fusion55961))
                           <span id='f0c1270'>(ccl::&#37;decls-body
                            <span id='f0c1269'>(let* ((&#35;:it55954 &#35;:fusion55961))
                              <span id='f0c1268'>(ccl::&#37;decls-body
                               <span id='f0c1267'>(let* ((&#35;:gen55962
                                       <span id='f0c1266'>(funcall &#39;ccl::slot-id-value
                                                &#35;:fusion55961
                                                <span id='f0c1265'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039E729F&#62;))</span>)</span>))
                                 <span id='f0c1263'>(let* ((&#35;:gen55963
                                         <span id='f0c1262'>(funcall &#39;ccl::slot-id-value
                                                  &#35;:fusion55961
                                                  <span id='f0c1260'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039E42EF&#62;))</span>)</span>))
                                   <span id='f0c1259'>(return-from trivia&#46;level1&#46;impl::whole
                                     <span id='f0c1258'>(let* ()
                                       <span id='f0c1257'>(block trivia&#46;level1&#46;impl::whole
                                         (progn <span id='f0c1256'>(block trivia&#46;level1&#46;impl::clause
                                                  <span id='f0c1255'>(let* ((&#35;:it55972 nil))
                                                    <span id='f0c1254'>(return-from trivia&#46;level1&#46;impl::whole
                                                      <span id='f0c1253'>(let* ((&#35;:what156070 &#35;:gen55962))
                                                        <span id='f0c1252'>(block trivia&#46;level1&#46;impl::whole
                                                          (progn <span id='f0c1217'>(block trivia&#46;level1&#46;impl::clause
                                                                   <span id='f0c1216'>(let* ((args &#35;:what156070))
                                                                     <span id='f0c1214'>(return-from trivia&#46;level1&#46;impl::whole
                                                                       <span id='f0c1213'>(let* ((&#35;:what156071 &#35;:gen55963))
                                                                         <span id='f0c1212'>(block trivia&#46;level1&#46;impl::whole
                                                                           (progn <span id='f0c1211'>(block trivia&#46;level1&#46;impl::clause
                                                                                    <span id='f0c1210'>(let* ((&#35;:it55953 &#35;:what156071))
                                                                                      <span id='f0c1209'>(if <span id='f0c1208'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                                                   &#35;:it55953
                                                                                                   <span id='f0c1207'>&#39;(&#35;:load-time-eval
                                                                                                      (funcall &#35;&#60;Anonymous Function &#35;x302003A0E9BF&#62;))</span>)</span>
                                                                                          <span id='f0c1205'>(ccl::&#37;decls-body
                                                                                           <span id='f0c1204'>(let* ((func
                                                                                                   <span id='f0c1001'>(funcall &#39;ccl::slot-id-value
                                                                                                            &#35;:it55953
                                                                                                            <span id='f0c1000'>&#39;(&#35;:load-time-eval
                                                                                                               (funcall &#35;&#60;Anonymous Function &#35;x302003A0B9EF&#62;))</span>)</span>))
                                                                                             <span id='f0c1203'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                               <span id='f0c1202'>(let* ()
                                                                                                 <span id='f0c1201'>(block trivia&#46;level1&#46;impl::whole
                                                                                                   (progn <span id='f0c1200'>(let* ((&#35;:it56063
                                                                                                                  nil))
                                                                                                            <span id='f0c1199'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                              <span id='f0c1198'>(let* ((&#35;:what156097
                                                                                                                      <span id='f0c1007'>(funcall &#39;storage:lookup-function
                                                                                                                               <span id='f0c1006'>(ccl::typed-form
                                                                                                                                &#39;keyword
                                                                                                                                func)</span>)</span>))
                                                                                                                <span id='f0c1197'>(block trivia&#46;level1&#46;impl::whole
                                                                                                                  (progn <span id='f0c1183'>(block trivia&#46;level1&#46;impl::clause
                                                                                                                           <span id='f0c1182'>(let* ((&#35;:it56083
                                                                                                                                   &#35;:what156097))
                                                                                                                             <span id='f0c1181'>(if <span id='f0c1180'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                                                                                          &#35;:it56083
                                                                                                                                          <span id='f0c1179'>&#39;(&#35;:load-time-eval
                                                                                                                                             (funcall &#35;&#60;Anonymous Function &#35;x302003A30ABF&#62;))</span>)</span>
                                                                                                                                 <span id='f0c1177'>(ccl::&#37;decls-body
                                                                                                                                  <span id='f0c1176'>(let* ((circ-args
                                                                                                                                          <span id='f0c1175'>(funcall &#39;ccl::slot-id-value
                                                                                                                                                   &#35;:it56083
                                                                                                                                                   <span id='f0c1174'>&#39;(&#35;:load-time-eval
                                                                                                                                                      (funcall &#35;&#60;Anonymous Function &#35;x302003A2DAEF&#62;))</span>)</span>))
                                                                                                                                    <span id='f0c1172'>(let* ((ret
                                                                                                                                            <span id='f0c1171'>(funcall &#39;ccl::slot-id-value
                                                                                                                                                     &#35;:it56083
                                                                                                                                                     <span id='f0c1170'>&#39;(&#35;:load-time-eval
                                                                                                                                                        (funcall &#35;&#60;Anonymous Function &#35;x302003A2AB9F&#62;))</span>)</span>))
                                                                                                                                      <span id='f0c1168'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                        <span id='f0c1167'>(let* ()
                                                                                                                                          <span id='f0c1166'>(block trivia&#46;level1&#46;impl::whole
                                                                                                                                            (progn <span id='f0c1162'>(let* ((&#35;:it56090
                                                                                                                                                           nil))
                                                                                                                                                     <span id='f0c1161'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                                       <span id='f0c1160'>(let* ((types
                                                                                                                                                               <span id='f0c1132'>(let* ((&#35;:g56110
                                                                                                                                                                       <span id='f0c1131'>(cons nil
                                                                                                                                                                             nil)</span>)
                                                                                                                                                                      (&#35;:g56111
                                                                                                                                                                       &#35;:g56110)
                                                                                                                                                                      (&#35;:g56113
                                                                                                                                                                       <span id='f0c1130'>(function alu&#46;spec:typ)</span>))
                                                                                                                                                                 <span id='f0c1129'>(let* ((&#35;:g56114
                                                                                                                                                                         circ-args))
                                                                                                                                                                   (progn <span id='f0c1128'>(tagbody <span id='f0c1114'>(go &#35;:g56116)</span>
                                                                                                                                                                                   (&#35;:g56115
                                                                                                                                                                                    nil
                                                                                                                                                                                    (0)
                                                                                                                                                                                    &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003A2731D&#62;
                                                                                                                                                                                    t
                                                                                                                                                                                    t)
                                                                                                                                                                                   <span id='f0c1127'>(tagbody <span id='f0c1126'>(let* ((&#35;:g56112
                                                                                                                                                                                                    <span id='f0c1125'>(car &#35;:g56114)</span>))
                                                                                                                                                                                              <span id='f0c1123'>(tagbody <span id='f0c1122'>(setq &#35;:g56110
                                                                                                                                                                                                             <span id='f0c1121'>(ccl::&#37;cdr (ccl::&#37;rplacd &#35;:g56110
                                                                                                                                                                                                                                      <span id='f0c1119'>(cons <span id='f0c1118'>(funcall &#35;:g56113
                                                                                                                                                                                                                                                     &#35;:g56112)</span>
                                                                                                                                                                                                                                            nil)</span>))</span>)</span>)</span>)</span>)</span>
                                                                                                                                                                                   <span id='f0c1113'>(setq &#35;:g56114
                                                                                                                                                                                         <span id='f0c1112'>(ccl::&#37;cdr <span id='f0c1111'>(ccl::typed-form
                                                                                                                                                                                                     &#39;list
                                                                                                                                                                                                     &#35;:g56114)</span>)</span>)</span>
                                                                                                                                                                                   (&#35;:g56116
                                                                                                                                                                                    nil
                                                                                                                                                                                    (0)
                                                                                                                                                                                    &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003A2731D&#62;
                                                                                                                                                                                    t
                                                                                                                                                                                    nil)
                                                                                                                                                                                   <span id='f0c1116'>(if <span id='f0c1115'>(not &#39;:ne
                                                                                                                                                                                            &#35;:g56114)</span>
                                                                                                                                                                                       (go &#35;:g56115)
                                                                                                                                                                                       nil)</span>)</span>
                                                                                                                                                                          <span id='f0c1109'>(let* ()
                                                                                                                                                                            <span id='f0c1108'>(ccl::&#37;cdr &#35;:g56111)</span>)</span>))</span>)</span>))
                                                                                                                                                         <span id='f0c1159'>(values <span id='f0c1139'>(funcall &#39;make-type-info
                                                                                                                                                                          <span id='f0c1134'>&#39;:type</span>
                                                                                                                                                                          ret
                                                                                                                                                                          <span id='f0c1133'>&#39;:size</span>
                                                                                                                                                                          <span id='f0c1138'>(funcall &#39;size:reference
                                                                                                                                                                                   <span id='f0c1137'>(ccl::typed-form
                                                                                                                                                                                    &#39;(or alu&#46;spec:reference-type
                                                                                                                                                                                         alu&#46;spec:application)
                                                                                                                                                                                    ret)</span>)</span>)</span>
                                                                                                                                                                 <span id='f0c1158'>(funcall &#39;reduce
                                                                                                                                                                          <span id='f0c1150'>(function <span id='f0c1149'>(lambda (context
                                                                                                                                                                                             pair)
                                                                                                                                                                                      <span id='f0c1148'>(funcall &#39;unify
                                                                                                                                                                                               <span id='f0c1144'>(ccl::typed-form
                                                                                                                                                                                                &#39;(or number
                                                                                                                                                                                                     alu&#46;spec:reference)
                                                                                                                                                                                                <span id='f0c1143'>(car pair)</span>)</span>
                                                                                                                                                                                               <span id='f0c1147'>(ccl::typed-form
                                                                                                                                                                                                &#39;(or null
                                                                                                                                                                                                     keyword
                                                                                                                                                                                                     alu&#46;spec:reference-type
                                                                                                                                                                                                     alu&#46;spec:application)
                                                                                                                                                                                                <span id='f0c1146'>(cdr pair)</span>)</span>
                                                                                                                                                                                               <span id='f0c1141'>(ccl::typed-form
                                                                                                                                                                                                &#39;typing-context
                                                                                                                                                                                                context)</span>)</span>)</span>)</span>
                                                                                                                                                                          <span id='f0c1155'>(funcall &#39;mapcar
                                                                                                                                                                                   <span id='f0c1153'>(function cons)</span>
                                                                                                                                                                                   args
                                                                                                                                                                                   types)</span>
                                                                                                                                                                          <span id='f0c1157'>&#39;:from-end</span>
                                                                                                                                                                          nil
                                                                                                                                                                          <span id='f0c1156'>&#39;:initial-value</span>
                                                                                                                                                                          context)</span>)</span>)</span>)</span>)</span>
                                                                                                                                                   <span id='f0c1165'>(let* ((&#35;:it56091
                                                                                                                                                           nil))
                                                                                                                                                     <span id='f0c1164'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                                       <span id='f0c1163'>(return-from trivia&#46;level1&#46;impl::clause
                                                                                                                                                         nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>)</span>
                                                                                                                                 nil)</span>)</span>)</span>
                                                                                                                         <span id='f0c1104'>(block trivia&#46;level1&#46;impl::clause
                                                                                                                           <span id='f0c1103'>(let* ((&#35;:it56084
                                                                                                                                   &#35;:what156097))
                                                                                                                             <span id='f0c1102'>(if <span id='f0c1101'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                                                                                          &#35;:it56084
                                                                                                                                          <span id='f0c1099'>&#39;(&#35;:load-time-eval
                                                                                                                                             (funcall &#35;&#60;Anonymous Function &#35;x302003A5A2EF&#62;))</span>)</span>
                                                                                                                                 <span id='f0c1098'>(ccl::&#37;decls-body
                                                                                                                                  <span id='f0c1097'>(let* ((name
                                                                                                                                          <span id='f0c1096'>(funcall &#39;ccl::slot-id-value
                                                                                                                                                   &#35;:it56084
                                                                                                                                                   <span id='f0c1094'>&#39;(&#35;:load-time-eval
                                                                                                                                                      (funcall &#35;&#60;Anonymous Function &#35;x302003A5731F&#62;))</span>)</span>))
                                                                                                                                    <span id='f0c1093'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                      <span id='f0c1092'>(let* ()
                                                                                                                                        <span id='f0c1091'>(block trivia&#46;level1&#46;impl::whole
                                                                                                                                          (progn <span id='f0c1090'>(let* ((&#35;:it56092
                                                                                                                                                         nil))
                                                                                                                                                   <span id='f0c1089'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                                     <span id='f0c1088'>(flet ((&#35;:handle-all-int-case &#35;1&#61;<span id='f0c1087'>(lambda nil
                                                                                                                                                                                        <span id='f0c1086'>(funcall &#39;arguments-have-same-type
                                                                                                                                                                                                 <span id='f0c1085'>(ccl::typed-form
                                                                                                                                                                                                  &#39;list
                                                                                                                                                                                                  args)</span>
                                                                                                                                                                                                 <span id='f0c1083'>(ccl::typed-form
                                                                                                                                                                                                  &#39;typing-context
                                                                                                                                                                                                  context)</span>
                                                                                                                                                                                                 <span id='f0c1081'>(ccl::typed-form
                                                                                                                                                                                                  &#39;function
                                                                                                                                                                                                  <span id='f0c1080'>(function find-integer-type-from-args)</span>)</span>)</span>)</span>))
                                                                                                                                                       <span id='f0c1079'>(let* ((&#35;:g56126
                                                                                                                                                               name))
                                                                                                                                                         <span id='f0c1078'>(if <span id='f0c1050'>(not &#39;:ne
                                                                                                                                                                  <span id='f0c1049'>(block nil
                                                                                                                                                                    <span id='f0c1048'>(let* ((&#35;:g56131
                                                                                                                                                                            &#35;:g56126)
                                                                                                                                                                           (&#35;:g56132
                                                                                                                                                                            <span id='f0c1031'>&#39;(:*
                                                                                                                                                                              :+)</span>))
                                                                                                                                                                      <span id='f0c1047'>(tagbody <span id='f0c1042'>(go &#35;:g56134)</span>
                                                                                                                                                                               (&#35;:g56133
                                                                                                                                                                                nil
                                                                                                                                                                                (0)
                                                                                                                                                                                &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003A4F5DD&#62;
                                                                                                                                                                                t
                                                                                                                                                                                t)
                                                                                                                                                                               <span id='f0c1039'>(tagbody <span id='f0c1038'>(if <span id='f0c1035'>(eq <span id='f0c1033'>(car &#35;:g56132)</span>
                                                                                                                                                                                                &#35;:g56131)</span>
                                                                                                                                                                                            <span id='f0c1037'>(return-from nil
                                                                                                                                                                                              &#35;:g56132)</span>
                                                                                                                                                                                            nil)</span>)</span>
                                                                                                                                                                               <span id='f0c1046'>(setq &#35;:g56132
                                                                                                                                                                                     <span id='f0c1045'>(ccl::&#37;cdr <span id='f0c1044'>(ccl::typed-form
                                                                                                                                                                                                 &#39;list
                                                                                                                                                                                                 &#35;:g56132)</span>)</span>)</span>
                                                                                                                                                                               (&#35;:g56134
                                                                                                                                                                                nil
                                                                                                                                                                                (0)
                                                                                                                                                                                &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003A4F5DD&#62;
                                                                                                                                                                                t
                                                                                                                                                                                nil)
                                                                                                                                                                               <span id='f0c1041'>(if <span id='f0c1040'>(not &#39;:ne
                                                                                                                                                                                        &#35;:g56132)</span>
                                                                                                                                                                                   (go &#35;:g56133)
                                                                                                                                                                                   nil)</span>)</span>)</span>)</span>)</span>
                                                                                                                                                             <span id='f0c1052'>(progn nil
                                                                                                                                                                    <span id='f0c1051'>(funcall &#35;1&#35;)</span>)</span>
                                                                                                                                                             <span id='f0c1077'>(if <span id='f0c1074'>(not &#39;:ne
                                                                                                                                                                      <span id='f0c1073'>(if <span id='f0c1072'>(eq &#35;:g56126
                                                                                                                                                                              &#39;:&#61;)</span>
                                                                                                                                                                          <span id='f0c1070'>&#39;(:&#61;)</span>
                                                                                                                                                                          nil)</span>)</span>
                                                                                                                                                                 <span id='f0c1076'>(progn nil
                                                                                                                                                                        <span id='f0c1075'>(funcall &#35;1&#35;)</span>)</span>
                                                                                                                                                                 <span id='f0c1069'>(if <span id='f0c1068'>(not &#39;:ne
                                                                                                                                                                          <span id='f0c1067'>(if <span id='f0c1065'>(eq &#35;:g56126
                                                                                                                                                                                  &#39;:exp)</span>
                                                                                                                                                                              <span id='f0c1066'>&#39;(:exp)</span>
                                                                                                                                                                              nil)</span>)</span>
                                                                                                                                                                     <span id='f0c1063'>(progn nil
                                                                                                                                                                            <span id='f0c1062'>(funcall &#35;1&#35;)</span>)</span>
                                                                                                                                                                     <span id='f0c1061'>(if <span id='f0c1060'>(progn &#35;:g56126
                                                                                                                                                                                t)</span>
                                                                                                                                                                         <span id='f0c1058'>(progn nil
                                                                                                                                                                                <span id='f0c1057'>(funcall &#39;log:error
                                                                                                                                                                                         term
                                                                                                                                                                                         <span id='f0c1053'>&#39;:type</span>
                                                                                                                                                                                         <span id='f0c1055'>&#39;&#34;unknown primitive &#126;A&#46; Don&#39;t know how to type it&#46;&#34;</span>
                                                                                                                                                                                         name)</span>)</span>
                                                                                                                                                                         nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>
                                                                                                                                                 <span id='f0c1030'>(let* ((&#35;:it56093
                                                                                                                                                         nil))
                                                                                                                                                   <span id='f0c1029'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                                     <span id='f0c1028'>(return-from trivia&#46;level1&#46;impl::clause
                                                                                                                                                       nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                                                                                                                                 nil)</span>)</span>)</span>
                                                                                                                         <span id='f0c1027'>(block trivia&#46;level1&#46;impl::clause
                                                                                                                           <span id='f0c1026'>(let* ((&#35;:intersection56087
                                                                                                                                   &#35;:what156097))
                                                                                                                             <span id='f0c1025'>(let* ((&#35;:it56085
                                                                                                                                     &#35;:intersection56087))
                                                                                                                               <span id='f0c1024'>(let* ((&#35;:it56086
                                                                                                                                       &#35;:intersection56087))
                                                                                                                                 <span id='f0c1023'>(if <span id='f0c1022'>(not &#35;:it56086)</span>
                                                                                                                                     <span id='f0c1021'>(ccl::&#37;decls-body
                                                                                                                                      <span id='f0c1020'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                        <span id='f0c1019'>(let* ()
                                                                                                                                          <span id='f0c1018'>(block trivia&#46;level1&#46;impl::whole
                                                                                                                                            (progn <span id='f0c1014'>(let* ((&#35;:it56094
                                                                                                                                                           nil))
                                                                                                                                                     <span id='f0c1013'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                                       <span id='f0c1012'>(funcall &#39;log:error
                                                                                                                                                                term
                                                                                                                                                                <span id='f0c1008'>&#39;:type</span>
                                                                                                                                                                <span id='f0c1010'>&#39;&#34;Function &#126;A: is not defined&#34;</span>
                                                                                                                                                                func)</span>)</span>)</span>
                                                                                                                                                   <span id='f0c1017'>(let* ((&#35;:it56095
                                                                                                                                                           nil))
                                                                                                                                                     <span id='f0c1016'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                                       <span id='f0c1015'>(return-from trivia&#46;level1&#46;impl::clause
                                                                                                                                                         nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>
                                                                                                                                     nil)</span>)</span>)</span>)</span>)</span>
                                                                                                                         <span id='f0c1196'>(let* ((&#35;:otherwise56081
                                                                                                                                 &#35;:what156097))
                                                                                                                           <span id='f0c1195'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                             <span id='f0c1194'>(let* ()
                                                                                                                               <span id='f0c1193'>(block trivia&#46;level1&#46;impl::whole
                                                                                                                                 <span id='f0c1192'>(let* ((&#35;:it56096
                                                                                                                                         nil))
                                                                                                                                   <span id='f0c1191'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                                                     <span id='f0c1190'>(values (funcall &#39;error
                                                                                                                                                      <span id='f0c1187'>&#39;trivia&#46;level2:match-error</span>
                                                                                                                                                      <span id='f0c1189'>&#39;:pattern</span>
                                                                                                                                                      <span id='f0c1188'>&#39;(((alu&#46;spec:circuit
                                                                                                                                                          :arguments
                                                                                                                                                          circ-args
                                                                                                                                                          :return-type
                                                                                                                                                          ret)
                                                                                                                                                         (let ((types
                                                                                                                                                                (mapcar (function alu&#46;spec:typ)
                                                                                                                                                                        circ-args)))
                                                                                                                                                           (values (make-type-info
                                                                                                                                                                     :type
                                                                                                                                                                     ret
                                                                                                                                                                     :size
                                                                                                                                                                     (size:reference ret))
                                                                                                                                                                   (mvfold (lambda (context
                                                                                                                                                                                    pair)
                                                                                                                                                                             (unify (car pair)
                                                                                                                                                                                    (cdr pair)
                                                                                                                                                                                    context))
                                                                                                                                                                           (mapcar (function cons)
                                                                                                                                                                                   args
                                                                                                                                                                                   types)
                                                                                                                                                                           context))))
                                                                                                                                                        ((alu&#46;spec:primitive
                                                                                                                                                          :name
                                                                                                                                                          name)
                                                                                                                                                         (flet ((handle-all-int-case nil
                                                                                                                                                                  (arguments-have-same-type
                                                                                                                                                                    args
                                                                                                                                                                    context
                                                                                                                                                                    (function find-integer-type-from-args))))
                                                                                                                                                           (typecase-of known-primitve-functions
                                                                                                                                                                        name
                                                                                                                                                                        ((or (eql :*)
                                                                                                                                                                             (eql :+))
                                                                                                                                                                         (handle-all-int-case))
                                                                                                                                                                        ((eql :&#61;)
                                                                                                                                                                         (handle-all-int-case))
                                                                                                                                                                        ((eql :exp)
                                                                                                                                                                         (handle-all-int-case))
                                                                                                                                                                        (otherwise
                                                                                                                                                                         (log:error term
                                                                                                                                                                                    :type
                                                                                                                                                                                    &#34;unknown primitive &#126;A&#46; Don&#39;t know how to type it&#46;&#34;
                                                                                                                                                                                    name)))))
                                                                                                                                                        ((and serapeum::&#95;
                                                                                                                                                              (type
                                                                                                                                                               null))
                                                                                                                                                         (log:error term
                                                                                                                                                                    :type
                                                                                                                                                                    &#34;Function &#126;A: is not defined&#34;
                                                                                                                                                                    func)))</span>
                                                                                                                                                      <span id='f0c1186'>&#39;:values</span>
                                                                                                                                                      <span id='f0c1185'>(cons &#35;:otherwise56081
                                                                                                                                                            nil)</span>))</span>)</span>)</span>)</span>)</span>)</span>)</span>))</span>)</span>)</span>)</span>
                                                                                                          <span id='f0c1004'>(let* ((&#35;:it56064
                                                                                                                  nil))
                                                                                                            <span id='f0c1003'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                              <span id='f0c1002'>(return-from trivia&#46;level1&#46;impl::clause
                                                                                                                nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                                                                                          nil)</span>)</span>)</span>
                                                                                  <span id='f0c998'>(let* ((&#35;:it56065 &#35;:what156071))
                                                                                    <span id='f0c997'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                      <span id='f0c996'>(return-from trivia&#46;level1&#46;impl::clause
                                                                                        nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                                                                 <span id='f0c1240'>(block trivia&#46;level1&#46;impl::clause
                                                                   <span id='f0c1239'>(let* ((&#35;:it56058 &#35;:what156070))
                                                                     <span id='f0c1238'>(return-from trivia&#46;level1&#46;impl::whole
                                                                       <span id='f0c1237'>(let* ((&#35;:what156139 &#35;:gen55963))
                                                                         <span id='f0c1236'>(block trivia&#46;level1&#46;impl::whole
                                                                           (progn <span id='f0c1232'>(block trivia&#46;level1&#46;impl::clause
                                                                                    <span id='f0c1231'>(let* ((func &#35;:what156139))
                                                                                      <span id='f0c1230'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                        <span id='f0c1229'>(let* ()
                                                                                          <span id='f0c1228'>(block trivia&#46;level1&#46;impl::whole
                                                                                            (progn <span id='f0c1227'>(let* ((&#35;:it56066
                                                                                                           nil))
                                                                                                     <span id='f0c1226'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                       <span id='f0c1225'>(funcall &#39;log:error
                                                                                                                term
                                                                                                                <span id='f0c1221'>&#39;:type</span>
                                                                                                                <span id='f0c1222'>&#39;&#34;Can not apply &#126;A&#46; Expecting a reference to a function not a number&#34;</span>
                                                                                                                func)</span>)</span>)</span>
                                                                                                   <span id='f0c1220'>(let* ((&#35;:it56067
                                                                                                           nil))
                                                                                                     <span id='f0c1219'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                                       <span id='f0c1218'>(return-from trivia&#46;level1&#46;impl::clause
                                                                                                         nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                                                                                  <span id='f0c1235'>(let* ((&#35;:it56068 &#35;:what156139))
                                                                                    <span id='f0c1234'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                      <span id='f0c1233'>(return-from trivia&#46;level1&#46;impl::clause
                                                                                        nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                                                                 <span id='f0c1251'>(let* ((&#35;:it56059 &#35;:what156070))
                                                                   <span id='f0c1250'>(return-from trivia&#46;level1&#46;impl::whole
                                                                     <span id='f0c1249'>(let* ((&#35;:what156141 &#35;:gen55963))
                                                                       <span id='f0c1248'>(block trivia&#46;level1&#46;impl::whole
                                                                         <span id='f0c1247'>(let* ((&#35;:it56060 &#35;:what156141))
                                                                           <span id='f0c1246'>(return-from trivia&#46;level1&#46;impl::whole
                                                                             <span id='f0c1245'>(let* ()
                                                                               <span id='f0c1244'>(block trivia&#46;level1&#46;impl::whole
                                                                                 <span id='f0c1243'>(let* ((&#35;:it56069 nil))
                                                                                   <span id='f0c1242'>(return-from trivia&#46;level1&#46;impl::whole
                                                                                     <span id='f0c1241'>(return-from trivia&#46;level1&#46;impl::clause
                                                                                       nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                                                <span id='f0c995'>(let* ((&#35;:it55973 nil))
                                                  <span id='f0c994'>(return-from trivia&#46;level1&#46;impl::whole
                                                    <span id='f0c993'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1864'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1863'>(let* ((&#35;:it55955 &#35;:what155987))
                    <span id='f0c1862'>(if <span id='f0c1861'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55955
                                 <span id='f0c1859'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003A6F30F&#62;))</span>)</span>
                        <span id='f0c1858'>(ccl::&#37;decls-body
                         <span id='f0c1857'>(let* ((typ
                                 <span id='f0c1856'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55955
                                          <span id='f0c1855'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003A6C33F&#62;))</span>)</span>))
                           <span id='f0c1853'>(return-from trivia&#46;level1&#46;impl::whole
                             <span id='f0c1852'>(let* ()
                               <span id='f0c1851'>(block trivia&#46;level1&#46;impl::whole
                                 (progn <span id='f0c1847'>(let* ((&#35;:it55974 nil))
                                          <span id='f0c1846'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c1845'>(values <span id='f0c1844'>(funcall &#39;make-type-info
                                                             <span id='f0c1839'>&#39;:size</span>
                                                             <span id='f0c1843'>(funcall &#39;size:reference
                                                                      <span id='f0c1842'>(ccl::typed-form
                                                                       &#39;(or alu&#46;spec:reference-type
                                                                            alu&#46;spec:application)
                                                                       typ)</span>)</span>
                                                             <span id='f0c1838'>&#39;:type</span>
                                                             typ)</span>
                                                    context)</span>)</span>)</span>
                                        <span id='f0c1850'>(let* ((&#35;:it55975 nil))
                                          <span id='f0c1849'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c1848'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1495'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1494'>(let* ((&#35;:it55956 &#35;:what155987))
                    <span id='f0c1493'>(if <span id='f0c1460'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55956
                                 <span id='f0c1458'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003A64B8F&#62;))</span>)</span>
                        <span id='f0c1492'>(ccl::&#37;decls-body
                         <span id='f0c1491'>(let* ((value
                                 <span id='f0c1490'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55956
                                          <span id='f0c1488'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003A61BBF&#62;))</span>)</span>))
                           <span id='f0c1487'>(let* ((typ
                                   <span id='f0c1463'>(funcall &#39;ccl::slot-id-value
                                            &#35;:it55956
                                            <span id='f0c1461'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003A9EC6F&#62;))</span>)</span>))
                             <span id='f0c1486'>(return-from trivia&#46;level1&#46;impl::whole
                               <span id='f0c1485'>(let* ()
                                 <span id='f0c1484'>(block trivia&#46;level1&#46;impl::whole
                                   (progn <span id='f0c1483'>(let* ((&#35;:it55976 nil))
                                            <span id='f0c1482'>(return-from trivia&#46;level1&#46;impl::whole
                                              <span id='f0c1481'>(values <span id='f0c1480'>(funcall &#39;make-type-info
                                                               <span id='f0c1474'>&#39;:size</span>
                                                               <span id='f0c1478'>(funcall &#39;size:reference
                                                                        <span id='f0c1477'>(ccl::typed-form
                                                                         &#39;(or alu&#46;spec:reference-type
                                                                              alu&#46;spec:application)
                                                                         typ)</span>)</span>
                                                               <span id='f0c1479'>&#39;:type</span>
                                                               typ)</span>
                                                      <span id='f0c1473'>(funcall &#39;unify
                                                               <span id='f0c1472'>(ccl::typed-form &#39;(or number alu&#46;spec:reference) value)</span>
                                                               <span id='f0c1468'>(ccl::typed-form
                                                                &#39;(or null
                                                                     keyword
                                                                     alu&#46;spec:reference-type
                                                                     alu&#46;spec:application)
                                                                typ)</span>
                                                               <span id='f0c1470'>(ccl::typed-form &#39;typing-context context)</span>)</span>)</span>)</span>)</span>
                                          <span id='f0c1466'>(let* ((&#35;:it55977 nil))
                                            <span id='f0c1465'>(return-from trivia&#46;level1&#46;impl::whole
                                              <span id='f0c1464'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1961'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1960'>(let* ((&#35;:it55957 &#35;:what155987))
                    <span id='f0c1959'>(if <span id='f0c1867'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55957
                                 <span id='f0c1865'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039DEF0F&#62;))</span>)</span>
                        <span id='f0c1958'>(ccl::&#37;decls-body
                         <span id='f0c1957'>(let* ((arr
                                 <span id='f0c1956'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55957
                                          <span id='f0c1954'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039DD96F&#62;))</span>)</span>))
                           <span id='f0c1953'>(return-from trivia&#46;level1&#46;impl::whole
                             <span id='f0c1952'>(let* ()
                               <span id='f0c1951'>(block trivia&#46;level1&#46;impl::whole
                                 (progn <span id='f0c1950'>(let* ((&#35;:it55978 nil))
                                          <span id='f0c1949'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c1948'>(let* ((lookup
                                                    <span id='f0c1937'>(let* ((&#35;:x56173 arr))
                                                      <span id='f0c1936'>(let* ((&#35;:g56174 &#35;:x56173))
                                                        <span id='f0c1935'>(if <span id='f0c1906'>(funcall &#39;numberp &#35;:g56174)</span>
                                                            <span id='f0c1934'>(progn nil
                                                                   <span id='f0c1933'>(funcall &#39;log:error
                                                                            term
                                                                            <span id='f0c1930'>&#39;:type</span>
                                                                            <span id='f0c1929'>&#39;&#34;Array lookup on the number &#126;A&#34;</span>
                                                                            arr)</span>)</span>
                                                            <span id='f0c1928'>(if <span id='f0c1909'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                                         &#35;:g56174
                                                                         <span id='f0c1908'>&#39;(&#35;:load-time-eval
                                                                            (funcall &#35;&#60;Anonymous Function &#35;x3020039DB1DF&#62;))</span>)</span>
                                                                <span id='f0c1917'>(progn nil
                                                                       <span id='f0c1916'>(funcall &#39;closure:lookup
                                                                                <span id='f0c1915'>(ccl::typed-form &#39;closure:typ
                                                                                 <span id='f0c1914'>(funcall &#39;typing-closure &#35;:g55945)</span>)</span>
                                                                                <span id='f0c1912'>(ccl::typed-form &#39;keyword
                                                                                 <span id='f0c1911'>(funcall &#39;alu&#46;spec:name arr)</span>)</span>)</span>)</span>
                                                                <span id='f0c1927'>(if <span id='f0c1919'>(progn &#35;:g56174 t)</span>
                                                                    <span id='f0c1926'>(progn nil
                                                                           <span id='f0c1925'>(values (funcall &#39;error
                                                                                            <span id='f0c1922'>&#39;type-error</span>
                                                                                            <span id='f0c1920'>&#39;:datum</span>
                                                                                            &#35;:x56173
                                                                                            <span id='f0c1921'>&#39;:expected-type</span>
                                                                                            <span id='f0c1923'>&#39;alu&#46;spec:term-normal-form</span>))</span>)</span>
                                                                    nil)</span>)</span>)</span>)</span>)</span>)
                                                   (value-type
                                                    <span id='f0c1904'>(if <span id='f0c1903'>(if lookup
                                                            <span id='f0c1902'>(funcall &#39;type-op:array-reference&#63;
                                                                     <span id='f0c1901'>(ccl::typed-form
                                                                      &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                                      <span id='f0c1900'>(ccl::struct-ref <span id='f0c1899'>(ccl::typed-form &#39;type-info
                                                                                        lookup)</span>
                                                                                       2)</span>)</span>)</span>
                                                            nil)</span>
                                                        <span id='f0c1884'>(let* ((type
                                                                <span id='f0c1876'>(funcall &#39;alu&#46;spec:array-type-content
                                                                         <span id='f0c1875'>(ccl::typed-form &#39;alu&#46;spec:application
                                                                          <span id='f0c1874'>(ccl::struct-ref <span id='f0c1872'>(ccl::typed-form &#39;type-info
                                                                                            lookup)</span>
                                                                                           2)</span>)</span>)</span>))
                                                          <span id='f0c1883'>(funcall &#39;make-type-info
                                                                   <span id='f0c1880'>&#39;:type</span>
                                                                   type
                                                                   <span id='f0c1882'>&#39;:size</span>
                                                                   <span id='f0c1879'>(funcall &#39;size:reference
                                                                            <span id='f0c1878'>(ccl::typed-form
                                                                             &#39;(or alu&#46;spec:reference-type
                                                                                  alu&#46;spec:application)
                                                                             type)</span>)</span>)</span>)</span>
                                                        <span id='f0c1895'>(if lookup
                                                            <span id='f0c1894'>(funcall &#39;log:error
                                                                     term
                                                                     <span id='f0c1891'>&#39;:type</span>
                                                                     <span id='f0c1892'>&#39;&#34;Type &#126;A is not of type Array&#34;</span>
                                                                     <span id='f0c1890'>(ccl::typed-form
                                                                      &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                                      <span id='f0c1889'>(ccl::struct-ref <span id='f0c1888'>(ccl::typed-form &#39;type-info
                                                                                        lookup)</span>
                                                                                       2)</span>)</span>)</span>
                                                            nil)</span>)</span>))
                                              <span id='f0c1947'>(values <span id='f0c1945'>(if lookup
                                                          value-type
                                                          <span id='f0c1943'>(funcall &#39;make-depends-on
                                                                   <span id='f0c1939'>&#39;:value</span>
                                                                   <span id='f0c1942'>(cons <span id='f0c1941'>(funcall &#39;alu&#46;spec:name arr)</span> nil)</span>)</span>)</span>
                                                      context)</span>)</span>)</span>)</span>
                                        <span id='f0c1870'>(let* ((&#35;:it55979 nil))
                                          <span id='f0c1869'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c1868'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1710'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1709'>(let* ((&#35;:it55958 &#35;:what155987))
                    <span id='f0c1708'>(if <span id='f0c1538'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55958
                                 <span id='f0c1537'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039EA7EF&#62;))</span>)</span>
                        <span id='f0c1707'>(ccl::&#37;decls-body
                         <span id='f0c1706'>(let* ((arr
                                 <span id='f0c1541'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55958
                                          <span id='f0c1540'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039E924F&#62;))</span>)</span>))
                           <span id='f0c1705'>(let* ((value
                                   <span id='f0c1704'>(funcall &#39;ccl::slot-id-value
                                            &#35;:it55958
                                            <span id='f0c1702'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039E7C3F&#62;))</span>)</span>))
                             <span id='f0c1701'>(return-from trivia&#46;level1&#46;impl::whole
                               <span id='f0c1700'>(let* ()
                                 <span id='f0c1699'>(block trivia&#46;level1&#46;impl::whole
                                   (progn <span id='f0c1695'>(let* ((&#35;:it55980 nil))
                                            <span id='f0c1694'>(return-from trivia&#46;level1&#46;impl::whole
                                              <span id='f0c1693'>(let* ((lookup-val
                                                      <span id='f0c1692'>(funcall &#39;normal-form-to-type-info
                                                               <span id='f0c1689'>(ccl::typed-form &#39;(or number alu&#46;spec:reference) value)</span>
                                                               <span id='f0c1691'>(ccl::typed-form &#39;typing-context context)</span>)</span>)
                                                     (lookup-arr
                                                      <span id='f0c1557'>(funcall &#39;normal-form-to-type-info-not-number-err
                                                               <span id='f0c1552'>(ccl::typed-form
                                                                &#39;(or number
                                                                     alu&#46;spec:reference
                                                                     alu&#46;spec:application
                                                                     alu&#46;spec:record
                                                                     alu&#46;spec:record-lookup
                                                                     alu&#46;spec:array-lookup
                                                                     alu&#46;spec:array-allocate
                                                                     alu&#46;spec:from-data
                                                                     alu&#46;spec:array-set
                                                                     alu&#46;spec:type-coerce
                                                                     alu&#46;spec:type-check)
                                                                term)</span>
                                                               <span id='f0c1556'>(ccl::typed-form &#39;(or number alu&#46;spec:reference) arr)</span>
                                                               <span id='f0c1554'>(ccl::typed-form &#39;typing-context context)</span>)</span>)
                                                     (context
                                                      <span id='f0c1687'>(let ((&#35;:arg0 lookup-arr) (&#35;:arg1 lookup-val))
                                                        <span id='f0c1686'>(let ((&#35;:arg056195 &#35;:arg0) (&#35;:arg156196 &#35;:arg1))
                                                          <span id='f0c1685'>(block &#35;:block56190
                                                            <span id='f0c1684'>(tagbody <span id='f0c1678'>(let* ((&#35;:expr56197 &#35;:arg056195))
                                                                       <span id='f0c1677'>(let* ((&#35;:g56198 &#35;:expr56197))
                                                                         <span id='f0c1676'>(if <span id='f0c1675'>(let* ((&#35;:g56200 &#35;:g56198))
                                                                               <span id='f0c1674'>(or <span id='f0c1671'>(not &#35;:g56200)</span>
                                                                                   <span id='f0c1673'>(funcall &#39;keywordp &#35;:g56200)</span>)</span>)</span>
                                                                             <span id='f0c1670'>(progn nil
                                                                                    <span id='f0c1669'>(let* ((&#35;:expr56201 &#35;:arg156196))
                                                                                      <span id='f0c1668'>(let* ((&#35;:g56202 &#35;:expr56201))
                                                                                        <span id='f0c1667'>(if <span id='f0c1666'>(funcall &#39;ccl:structure-typep
                                                                                                     &#35;:g56202
                                                                                                     <span id='f0c1665'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                                            <span id='f0c1643'>(progn nil <span id='f0c1642'>(go &#35;:tag56191)</span>)</span>
                                                                                            <span id='f0c1663'>(if <span id='f0c1648'>(let* ((&#35;:g56204
                                                                                                        &#35;:g56202))
                                                                                                  <span id='f0c1647'>(or <span id='f0c1646'>(not &#35;:g56204)</span>
                                                                                                      <span id='f0c1645'>(funcall &#39;keywordp
                                                                                                               &#35;:g56204)</span>)</span>)</span>
                                                                                                <span id='f0c1650'>(progn nil
                                                                                                       <span id='f0c1649'>(go &#35;:tag56192)</span>)</span>
                                                                                                <span id='f0c1662'>(if <span id='f0c1652'>(progn &#35;:g56202 t)</span>
                                                                                                    <span id='f0c1661'>(progn nil
                                                                                                           <span id='f0c1660'>(values (funcall &#39;error
                                                                                                                            <span id='f0c1657'>&#39;dispatch-case-error</span>
                                                                                                                            <span id='f0c1654'>&#39;:expected-type</span>
                                                                                                                            <span id='f0c1656'>&#39;lookup-type</span>
                                                                                                                            <span id='f0c1658'>&#39;:datum</span>
                                                                                                                            &#35;:expr56201
                                                                                                                            <span id='f0c1659'>&#39;:matched-types</span>
                                                                                                                            <span id='f0c1653'>&#39;(lookup-type)</span>))</span>)</span>
                                                                                                    nil)</span>)</span>)</span>)</span>)</span>)</span>
                                                                             <span id='f0c1641'>(if <span id='f0c1640'>(funcall &#39;ccl:structure-typep
                                                                                          &#35;:g56198
                                                                                          <span id='f0c1639'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                                 <span id='f0c1626'>(progn nil
                                                                                        <span id='f0c1625'>(let* ((&#35;:expr56205
                                                                                                &#35;:arg156196))
                                                                                          <span id='f0c1624'>(let* ((&#35;:g56206 &#35;:expr56205))
                                                                                            <span id='f0c1623'>(if <span id='f0c1600'>(funcall &#39;ccl:structure-typep
                                                                                                         &#35;:g56206
                                                                                                         <span id='f0c1598'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                                                <span id='f0c1602'>(progn nil
                                                                                                       <span id='f0c1601'>(go &#35;:tag56193)</span>)</span>
                                                                                                <span id='f0c1622'>(if <span id='f0c1621'>(let* ((&#35;:g56208
                                                                                                            &#35;:g56206))
                                                                                                      <span id='f0c1620'>(or <span id='f0c1619'>(not &#35;:g56208)</span>
                                                                                                          <span id='f0c1618'>(funcall &#39;keywordp
                                                                                                                   &#35;:g56208)</span>)</span>)</span>
                                                                                                    <span id='f0c1616'>(progn nil
                                                                                                           <span id='f0c1615'>(go &#35;:tag56194)</span>)</span>
                                                                                                    <span id='f0c1614'>(if <span id='f0c1604'>(progn &#35;:g56206
                                                                                                               t)</span>
                                                                                                        <span id='f0c1613'>(progn nil
                                                                                                               <span id='f0c1612'>(values (funcall &#39;error
                                                                                                                                <span id='f0c1608'>&#39;dispatch-case-error</span>
                                                                                                                                <span id='f0c1610'>&#39;:expected-type</span>
                                                                                                                                <span id='f0c1606'>&#39;lookup-type</span>
                                                                                                                                <span id='f0c1605'>&#39;:datum</span>
                                                                                                                                &#35;:expr56205
                                                                                                                                <span id='f0c1607'>&#39;:matched-types</span>
                                                                                                                                <span id='f0c1611'>&#39;(lookup-type)</span>))</span>)</span>
                                                                                                        nil)</span>)</span>)</span>)</span>)</span>)</span>
                                                                                 <span id='f0c1637'>(if <span id='f0c1636'>(progn &#35;:g56198 t)</span>
                                                                                     <span id='f0c1634'>(progn nil
                                                                                            <span id='f0c1633'>(values (funcall &#39;error
                                                                                                             <span id='f0c1631'>&#39;dispatch-case-error</span>
                                                                                                             <span id='f0c1627'>&#39;:expected-type</span>
                                                                                                             <span id='f0c1632'>&#39;lookup-type</span>
                                                                                                             <span id='f0c1628'>&#39;:datum</span>
                                                                                                             &#35;:expr56197
                                                                                                             <span id='f0c1630'>&#39;:matched-types</span>
                                                                                                             nil))</span>)</span>
                                                                                     nil)</span>)</span>)</span>)</span>)</span>
                                                                     (&#35;:tag56191 nil (0)
                                                                      &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x3020039E526D&#62; t nil)
                                                                     <span id='f0c1683'>(return-from &#35;:block56190
                                                                       <span id='f0c1682'>(funcall &#39;log:error
                                                                                term
                                                                                <span id='f0c1680'>&#39;:type</span>
                                                                                <span id='f0c1681'>&#39;&#34;No Type Inference for the type of the array yet&#33;&#34;</span>)</span>)</span>
                                                                     (&#35;:tag56192 nil (0)
                                                                      &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x3020039E526D&#62; t nil)
                                                                     <span id='f0c1584'>(return-from &#35;:block56190
                                                                       <span id='f0c1583'>(funcall &#39;log:error
                                                                                term
                                                                                <span id='f0c1580'>&#39;:type</span>
                                                                                <span id='f0c1582'>&#39;&#34;No Type Inference for the type of the array yet&#33;&#34;</span>)</span>)</span>
                                                                     (&#35;:tag56193 nil (0)
                                                                      &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x3020039E526D&#62; t nil)
                                                                     <span id='f0c1579'>(return-from &#35;:block56190
                                                                       <span id='f0c1578'>(if <span id='f0c1570'>(funcall &#39;type-equality
                                                                                    <span id='f0c1564'>(ccl::typed-form
                                                                                     &#39;(or alu&#46;spec:reference-type
                                                                                          alu&#46;spec:application)
                                                                                     <span id='f0c1563'>(funcall &#39;alu&#46;spec:array-type-content
                                                                                              <span id='f0c1562'>(ccl::typed-form
                                                                                               &#39;alu&#46;spec:application
                                                                                               <span id='f0c1561'>(ccl::struct-ref <span id='f0c1560'>(ccl::typed-form
                                                                                                                 &#39;type-info
                                                                                                                 lookup-arr)</span>
                                                                                                                2)</span>)</span>)</span>)</span>
                                                                                    <span id='f0c1569'>(ccl::typed-form
                                                                                     &#39;(or alu&#46;spec:reference-type
                                                                                          alu&#46;spec:application)
                                                                                     <span id='f0c1568'>(ccl::struct-ref <span id='f0c1566'>(ccl::typed-form
                                                                                                       &#39;type-info
                                                                                                       lookup-val)</span>
                                                                                                      2)</span>)</span>)</span>
                                                                           context
                                                                           <span id='f0c1577'>(funcall &#39;log:error
                                                                                    term
                                                                                    <span id='f0c1575'>&#39;:type</span>
                                                                                    <span id='f0c1572'>&#39;&#34;Array &#126;A does not have element type of &#126;A&#34;</span>
                                                                                    arr
                                                                                    lookup-val)</span>)</span>)</span>
                                                                     (&#35;:tag56194 nil (0)
                                                                      &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x3020039E526D&#62; t nil)
                                                                     <span id='f0c1597'>(return-from &#35;:block56190
                                                                       <span id='f0c1596'>(funcall &#39;unify
                                                                                <span id='f0c1595'>(ccl::typed-form
                                                                                 &#39;(or number alu&#46;spec:reference) value)</span>
                                                                                <span id='f0c1593'>(ccl::typed-form
                                                                                 &#39;(or alu&#46;spec:reference-type
                                                                                      alu&#46;spec:application)
                                                                                 <span id='f0c1592'>(funcall &#39;alu&#46;spec:array-type-content
                                                                                          <span id='f0c1591'>(ccl::typed-form
                                                                                           &#39;alu&#46;spec:application
                                                                                           <span id='f0c1590'>(ccl::struct-ref <span id='f0c1588'>(ccl::typed-form
                                                                                                             &#39;type-info
                                                                                                             lookup-arr)</span>
                                                                                                            2)</span>)</span>)</span>)</span>
                                                                                <span id='f0c1586'>(ccl::typed-form &#39;typing-context
                                                                                 context)</span>)</span>)</span>)</span>)</span>)</span>)</span>))
                                                <span id='f0c1550'>(values <span id='f0c1549'>(funcall &#39;make-type-info
                                                                 <span id='f0c1546'>&#39;:size</span>
                                                                 0
                                                                 <span id='f0c1548'>&#39;:type</span>
                                                                 <span id='f0c1545'>(funcall &#39;alu&#46;spec:make-type-reference <span id='f0c1544'>&#39;:name</span> <span id='f0c1543'>&#39;:void</span>)</span>)</span>
                                                        context)</span>)</span>)</span>)</span>
                                          <span id='f0c1698'>(let* ((&#35;:it55981 nil))
                                            <span id='f0c1697'>(return-from trivia&#46;level1&#46;impl::whole
                                              <span id='f0c1696'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1535'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1534'>(let* ((&#35;:it55959 &#35;:what155987))
                    <span id='f0c1533'>(if <span id='f0c1498'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55959
                                 <span id='f0c1497'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039ECD5F&#62;))</span>)</span>
                        <span id='f0c1532'>(ccl::&#37;decls-body
                         <span id='f0c1531'>(let* ((s
                                 <span id='f0c1501'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55959
                                          <span id='f0c1499'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003A0300F&#62;))</span>)</span>))
                           <span id='f0c1530'>(let* ((ty
                                   <span id='f0c1529'>(funcall &#39;ccl::slot-id-value
                                            &#35;:it55959
                                            <span id='f0c1528'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003A019FF&#62;))</span>)</span>))
                             <span id='f0c1526'>(return-from trivia&#46;level1&#46;impl::whole
                               <span id='f0c1525'>(let* ()
                                 <span id='f0c1524'>(block trivia&#46;level1&#46;impl::whole
                                   (progn <span id='f0c1520'>(let* ((&#35;:it55982 nil))
                                            <span id='f0c1519'>(return-from trivia&#46;level1&#46;impl::whole
                                              <span id='f0c1518'>(values <span id='f0c1516'>(funcall &#39;make-type-info
                                                               <span id='f0c1515'>&#39;:size</span>
                                                               <span id='f0c1506'>(ccl::mul2 s
                                                                <span id='f0c1504'>(funcall &#39;size:reference
                                                                         <span id='f0c1503'>(ccl::typed-form
                                                                          &#39;(or alu&#46;spec:reference-type
                                                                               alu&#46;spec:application)
                                                                          ty)</span>)</span>)</span>
                                                               <span id='f0c1514'>&#39;:type</span>
                                                               <span id='f0c1513'>(funcall &#39;alu&#46;spec:array-type
                                                                        <span id='f0c1509'>&#39;:length</span>
                                                                        <span id='f0c1512'>(ccl::typed-form &#39;fixnum s)</span>
                                                                        <span id='f0c1510'>&#39;:type</span>
                                                                        <span id='f0c1508'>(ccl::typed-form
                                                                         &#39;(or alu&#46;spec:reference-type
                                                                              alu&#46;spec:application)
                                                                         ty)</span>)</span>)</span>
                                                      context)</span>)</span>)</span>
                                          <span id='f0c1523'>(let* ((&#35;:it55983 nil))
                                            <span id='f0c1522'>(return-from trivia&#46;level1&#46;impl::whole
                                              <span id='f0c1521'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1836'>(block trivia&#46;level1&#46;impl::clause
                  <span id='f0c1835'>(let* ((&#35;:it55960 &#35;:what155987))
                    <span id='f0c1834'>(if <span id='f0c1833'>(funcall &#39;ccl::std-instance-class-cell-typep
                                 &#35;:it55960
                                 <span id='f0c1831'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039FE34F&#62;))</span>)</span>
                        <span id='f0c1830'>(ccl::&#37;decls-body
                         <span id='f0c1829'>(let* ((contents
                                 <span id='f0c1730'>(funcall &#39;ccl::slot-id-value
                                          &#35;:it55960
                                          <span id='f0c1729'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020039FCDAF&#62;))</span>)</span>))
                           <span id='f0c1828'>(return-from trivia&#46;level1&#46;impl::whole
                             <span id='f0c1827'>(let* ()
                               <span id='f0c1826'>(block trivia&#46;level1&#46;impl::whole
                                 (progn <span id='f0c1825'>(let* ((&#35;:it55984 nil))
                                          <span id='f0c1824'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c1823'>(multiple-value-bind (arg context)
                                                <span id='f0c1738'>(funcall &#39;arguments-have-same-type
                                                         <span id='f0c1735'>(ccl::typed-form &#39;list contents)</span>
                                                         <span id='f0c1737'>(ccl::typed-form &#39;typing-context context)</span>)</span>
                                              <span id='f0c1822'>(let* ((&#35;:x56230 arg))
                                                <span id='f0c1821'>(let* ((&#35;:g56231 &#35;:x56230))
                                                  <span id='f0c1820'>(if <span id='f0c1766'>(funcall &#39;ccl:structure-typep
                                                               &#35;:g56231
                                                               <span id='f0c1764'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                      <span id='f0c1763'>(progn nil
                                                             <span id='f0c1762'>(values <span id='f0c1761'>(funcall &#39;make-type-info
                                                                              <span id='f0c1749'>&#39;:size</span>
                                                                              <span id='f0c1747'>(ccl::mul2 <span id='f0c1741'>(funcall 11 contents)</span>
                                                                               <span id='f0c1746'>(ccl::typed-form &#39;(or fixnum null)
                                                                                <span id='f0c1745'>(ccl::struct-ref <span id='f0c1744'>(ccl::typed-form
                                                                                                  &#39;type-info arg)</span>
                                                                                                 1)</span>)</span>)</span>
                                                                              <span id='f0c1748'>&#39;:type</span>
                                                                              <span id='f0c1760'>(funcall &#39;alu&#46;spec:array-type
                                                                                       <span id='f0c1750'>&#39;:length</span>
                                                                                       <span id='f0c1759'>(ccl::typed-form &#39;fixnum
                                                                                        <span id='f0c1758'>(funcall 11 contents)</span>)</span>
                                                                                       <span id='f0c1751'>&#39;:type</span>
                                                                                       <span id='f0c1756'>(ccl::typed-form
                                                                                        &#39;(or alu&#46;spec:reference-type
                                                                                             alu&#46;spec:application)
                                                                                        <span id='f0c1755'>(ccl::struct-ref <span id='f0c1753'>(ccl::typed-form
                                                                                                          &#39;type-info
                                                                                                          arg)</span>
                                                                                                         2)</span>)</span>)</span>)</span>
                                                                     context)</span>)</span>
                                                      <span id='f0c1819'>(if <span id='f0c1818'>(funcall &#39;ccl:structure-typep
                                                                   &#35;:g56231
                                                                   <span id='f0c1816'>&#39;&#35;&#60;class-cell for depends-on &#35;x302001E2445D&#62;</span>)</span>
                                                          <span id='f0c1770'>(progn nil <span id='f0c1769'>(values arg context)</span>)</span>
                                                          <span id='f0c1815'>(if <span id='f0c1814'>(not &#39;:ne
                                                                   <span id='f0c1813'>(if <span id='f0c1811'>(eq &#35;:g56231 &#39;:refine-array)</span>
                                                                       <span id='f0c1812'>&#39;(:refine-array)</span>
                                                                       nil)</span>)</span>
                                                              <span id='f0c1809'>(progn nil <span id='f0c1808'>(values arg context)</span>)</span>
                                                              <span id='f0c1805'>(if <span id='f0c1793'>(funcall &#39;ccl:structure-typep
                                                                           &#35;:g56231
                                                                           <span id='f0c1792'>&#39;&#35;&#60;class-cell for same-as &#35;x302001E2417D&#62;</span>)</span>
                                                                  <span id='f0c1804'>(progn nil
                                                                         <span id='f0c1803'>(values <span id='f0c1802'>(funcall &#39;make-depends-on
                                                                                          <span id='f0c1795'>&#39;:value</span>
                                                                                          <span id='f0c1801'>(cons <span id='f0c1800'>(ccl::typed-form
                                                                                                 &#39;keyword
                                                                                                 <span id='f0c1799'>(ccl::struct-ref <span id='f0c1798'>(ccl::typed-form
                                                                                                                   &#39;same-as
                                                                                                                   arg)</span>
                                                                                                                  1)</span>)</span>
                                                                                                nil)</span>)</span>
                                                                                 context)</span>)</span>
                                                                  <span id='f0c1790'>(if <span id='f0c1775'>(not &#39;:ne
                                                                           <span id='f0c1774'>(if <span id='f0c1773'>(eq &#35;:g56231 &#39;:refine-integer)</span>
                                                                               <span id='f0c1771'>&#39;(:refine-integer)</span>
                                                                               nil)</span>)</span>
                                                                      <span id='f0c1789'>(progn nil <span id='f0c1788'>(values <span id='f0c1787'>&#39;:refine-integer</span> context)</span>)</span>
                                                                      <span id='f0c1785'>(if <span id='f0c1777'>(progn &#35;:g56231 t)</span>
                                                                          <span id='f0c1784'>(progn nil
                                                                                 <span id='f0c1783'>(values (funcall &#39;error
                                                                                                  <span id='f0c1781'>&#39;type-error</span>
                                                                                                  <span id='f0c1780'>&#39;:datum</span>
                                                                                                  &#35;:x56230
                                                                                                  <span id='f0c1782'>&#39;:expected-type</span>
                                                                                                  <span id='f0c1778'>&#39;typing-result</span>))</span>)</span>
                                                                          nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>
                                        <span id='f0c1733'>(let* ((&#35;:it55985 nil))
                                          <span id='f0c1732'>(return-from trivia&#46;level1&#46;impl::whole
                                            <span id='f0c1731'>(return-from trivia&#46;level1&#46;impl::clause nil)</span>)</span>)</span>))</span>)</span>)</span>)</span>)</span>
                        nil)</span>)</span>)</span>
                <span id='f0c1291'>(let* ((&#35;:otherwise55946 &#35;:what155987))
                  <span id='f0c1290'>(return-from trivia&#46;level1&#46;impl::whole
                    <span id='f0c1289'>(let* ()
                      <span id='f0c1288'>(block trivia&#46;level1&#46;impl::whole
                        <span id='f0c1287'>(let* ((&#35;:it55986 nil))
                          <span id='f0c1286'>(return-from trivia&#46;level1&#46;impl::whole
                            <span id='f0c1285'>(values (funcall &#39;error
                                             <span id='f0c1281'>&#39;trivia&#46;level2:match-error</span>
                                             <span id='f0c1282'>&#39;:pattern</span>
                                             <span id='f0c1280'>&#39;(((number &#95;) (values :refine-integer context))
                                               ((alu&#46;spec:reference :name name)
                                                (let ((lookup (closure:lookup closure name)))
                                                  (values (cond (lookup lookup)
                                                                ((term-op:void-reference&#63; term)
                                                                 (make-type-info
                                                                   :size
                                                                   0
                                                                   :type
                                                                   (alu&#46;spec:make-type-reference :name :void)))
                                                                (t (make-same-as :value name)))
                                                          context)))
                                               ((alu&#46;spec:record :name name)
                                                (let* ((lookup (storage:lookup-type name)))
                                                  (if lookup
                                                      (values (make-type-info
                                                                :size
                                                                (size:storage lookup)
                                                                :type
                                                                (alu&#46;spec:make-type-reference :name name))
                                                              context)
                                                      (log:error term
                                                                 &#39;(:type :not-defined)
                                                                 &#34;the record type &#126;A: is not defined&#34;
                                                                 name))))
                                               ((alu&#46;spec:record-lookup :record rec :field field)
                                                (let* ((rec
                                                        (etypecase-of alu&#46;spec:term-normal-form
                                                                      rec
                                                                      (number
                                                                       (log:error term
                                                                                  &#39;(:type)
                                                                                  &#34;can&#39;t index into a numerical literal: &#126;A&#34;
                                                                                  rec))
                                                                      (alu&#46;spec:reference (alu&#46;spec:name rec))))
                                                       (lookup (closure:lookup closure rec)))
                                                  (cond ((and lookup
                                                              (typep (type-info-type lookup) &#39;alu&#46;spec:reference-type))
                                                         (let* ((field-name (alu&#46;spec:name (type-info-type lookup)))
                                                                (lookup (storage:lookup-type field-name)))
                                                           (typecase-of alu&#46;spec:type-storage
                                                                        lookup
                                                                        (alu&#46;spec:primitive
                                                                         (log:error term
                                                                                    :type
                                                                                    &#34;&#126;A is a primitive type not a record type&#34;
                                                                                    field-name))
                                                                        (otherwise
                                                                         (error &#34;type &#126;A does not exist&#34; field-name))
                                                                        (alu&#46;spec:type-declaration
                                                                         (etypecase-of alu&#46;spec:type-format
                                                                                       (alu&#46;spec:decl lookup)
                                                                                       (alu&#46;spec:sum-decl
                                                                                        (log:error term
                                                                                                   :type
                                                                                                   &#34;Trying to index into the sum type &#126;A&#34;
                                                                                                   field-name))
                                                                                       (alu&#46;spec:record-decl
                                                                                        (let ((field-type
                                                                                               (sycamore:tree-map-find
                                                                                                 (alu&#46;spec:contents (alu&#46;spec:decl lookup))
                                                                                                 field)))
                                                                                          (if field-type
                                                                                              (values (make-type-info
                                                                                                        :type
                                                                                                        field-type
                                                                                                        :size
                                                                                                        (size:reference field-type))
                                                                                                      context)
                                                                                              (log:error term
                                                                                                         :type
                                                                                                         &#34;the field &#126;A does not exist in record type: &#126;A&#34;
                                                                                                         field-name
                                                                                                         (alu&#46;spec:name lookup))))))))))
                                                        (lookup
                                                         (log:error term
                                                                    :type
                                                                    &#34;Record types currently cannot be applied&#34;))
                                                        (t (values (make-depends-on :value (list rec)) context)))))
                                               ((alu&#46;spec:application :name (alu&#46;spec:reference :name func) :arguments
                                                 args)
                                                (match-of (or alu&#46;spec:function-type null)
                                                          (storage:lookup-function func)
                                                          ((alu&#46;spec:circuit :arguments circ-args :return-type ret)
                                                           (let ((types (mapcar (function alu&#46;spec:typ) circ-args)))
                                                             (values (make-type-info
                                                                       :type
                                                                       ret
                                                                       :size
                                                                       (size:reference ret))
                                                                     (mvfold (lambda (context pair)
                                                                               (unify (car pair) (cdr pair) context))
                                                                             (mapcar (function cons) args types)
                                                                             context))))
                                                          ((alu&#46;spec:primitive :name name)
                                                           (flet ((handle-all-int-case nil
                                                                    (arguments-have-same-type
                                                                      args
                                                                      context
                                                                      (function find-integer-type-from-args))))
                                                             (typecase-of known-primitve-functions
                                                                          name
                                                                          ((or (eql :*) (eql :+)) (handle-all-int-case))
                                                                          ((eql :&#61;) (handle-all-int-case))
                                                                          ((eql :exp) (handle-all-int-case))
                                                                          (otherwise
                                                                           (log:error term
                                                                                      :type
                                                                                      &#34;unknown primitive &#126;A&#46; Don&#39;t know how to type it&#46;&#34;
                                                                                      name)))))
                                                          (null (log:error term
                                                                           :type
                                                                           &#34;Function &#126;A: is not defined&#34;
                                                                           func))))
                                               ((alu&#46;spec:application :name func)
                                                (log:error term
                                                           :type
                                                           &#34;Can not apply &#126;A&#46; Expecting a reference to a function not a number&#34;
                                                           func))
                                               ((alu&#46;spec:type-coerce :typ typ)
                                                (values (make-type-info :size (size:reference typ) :type typ) context))
                                               ((alu&#46;spec:type-check :value value :typ typ)
                                                (values (make-type-info :size (size:reference typ) :type typ)
                                                        (unify value typ context)))
                                               ((alu&#46;spec:array-lookup :arr arr)
                                                (let* ((lookup
                                                        (etypecase-of alu&#46;spec:term-normal-form
                                                                      arr
                                                                      (number
                                                                       (log:error term
                                                                                  :type
                                                                                  &#34;Array lookup on the number &#126;A&#34;
                                                                                  arr))
                                                                      (alu&#46;spec:reference
                                                                       (closure:lookup closure (alu&#46;spec:name arr)))))
                                                       (value-type
                                                        (cond ((and lookup
                                                                    (type-op:array-reference&#63; (type-info-type lookup)))
                                                               (let ((type
                                                                      (alu&#46;spec:array-type-content
                                                                        (type-info-type lookup))))
                                                                 (make-type-info
                                                                   :type
                                                                   type
                                                                   :size
                                                                   (size:reference type))))
                                                              (lookup
                                                               (log:error term
                                                                          :type
                                                                          &#34;Type &#126;A is not of type Array&#34;
                                                                          (type-info-type lookup)))
                                                              (t nil))))
                                                  (values (if lookup
                                                              value-type
                                                              (make-depends-on :value (list (alu&#46;spec:name arr))))
                                                          context)))
                                               ((alu&#46;spec:array-set :arr arr :value value)
                                                (let* ((lookup-val (normal-form-to-type-info value context))
                                                       (lookup-arr
                                                        (normal-form-to-type-info-not-number-err term arr context))
                                                       (context
                                                        (dispatch-case
                                                          ((lookup-arr lookup-type) (lookup-val lookup-type))
                                                          ((hole type-info)
                                                           (log:error term
                                                                      :type
                                                                      &#34;No Type Inference for the type of the array yet&#33;&#34;))
                                                          ((hole hole)
                                                           (log:error term
                                                                      :type
                                                                      &#34;No Type Inference for the type of the array yet&#33;&#34;))
                                                          ((type-info type-info)
                                                           (if (type-equality
                                                                 (alu&#46;spec:array-type-content
                                                                   (type-info-type lookup-arr))
                                                                 (type-info-type lookup-val))
                                                               context
                                                               (log:error term
                                                                          :type
                                                                          &#34;Array &#126;A does not have element type of &#126;A&#34;
                                                                          arr
                                                                          lookup-val)))
                                                          ((type-info hole)
                                                           (unify value
                                                                  (alu&#46;spec:array-type-content
                                                                    (type-info-type lookup-arr))
                                                                  context)))))
                                                  (values (make-type-info
                                                            :size
                                                            0
                                                            :type
                                                            (alu&#46;spec:make-type-reference :name :void))
                                                          context)))
                                               ((alu&#46;spec:array-allocate :size s :typ ty)
                                                (values (make-type-info
                                                          :size
                                                          (* s (size:reference ty))
                                                          :type
                                                          (alu&#46;spec:array-type :length s :type ty))
                                                        context))
                                               ((alu&#46;spec:from-data :contents contents)
                                                (multiple-value-bind (arg context)
                                                    (arguments-have-same-type contents context)
                                                  (etypecase-of typing-result
                                                                arg
                                                                (type-info
                                                                 (values (make-type-info
                                                                           :size
                                                                           (* (length contents) (type-info-size arg))
                                                                           :type
                                                                           (alu&#46;spec:array-type :length
                                                                                                (length contents)
                                                                                                :type
                                                                                                (type-info-type arg)))
                                                                         context))
                                                                (depends-on (values arg context))
                                                                ((eql :refine-array) (values arg context))
                                                                (same-as
                                                                 (values (make-depends-on
                                                                           :value
                                                                           (list (same-as-value arg)))
                                                                         context))
                                                                ((eql :refine-integer)
                                                                 (values :refine-integer context))))))</span>
                                             <span id='f0c1279'>&#39;:values</span>
                                             <span id='f0c1284'>(cons &#35;:otherwise55946 nil)</span>))</span>)</span>)</span>)</span>)</span>)</span>)</span>))</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>333</span> 
<span class='line'>334</span> 
<span class='line'>335</span> (-&#62; arguments-have-same-type
<span class='line'>336</span>     (list typing-context &#38;optional function)
<span class='line'>337</span>     (values typing-result typing-context))
<span id='f0s219'><span class='line'>338</span> (defun arguments-have-same-type (args context &#38;optional
<span class='line'>339</span>                                                 (refine-f <span id='f0s220'>&#35;&#39;find-most-refined-value</span>))
<span class='line'>340</span>   &#34;This function handles the case when the arguments have all the same
<span class='line'>341</span> type&#46; This occurs often in primitives&#46; This function is passed the
<span class='line'>342</span> argument list&#44; the context&#44; and a refine function that lets us specify
<span class='line'>343</span> any constraints on the specification&#34;
<span class='line'>344</span>   <span id='f0s221'>(let* ((constraints
<span class='line'>345</span>            <span id='f0s222'>(funcall refine-f args context)</span>)
<span class='line'>346</span>          (argument-keywords
<span class='line'>347</span>            <span id='f0s223'>(references-from-list args)</span>))
<span class='line'>348</span>     <span id='f0s224'>(consistent-type-check args context)</span>
<span class='line'>349</span>     <span id='f0s225'>(etypecase-of lookup-type constraints
<span class='line'>350</span>       (hole
<span class='line'>351</span>        <span id='f0s226'>(values <span id='f0s227'>(if argument-keywords
<span class='line'>352</span>                    <span id='f0s228'>(make-same-as :value <span id='f0s229'>(car argument-keywords)</span>)</span>
<span class='line'>353</span>                    :refine-integer)</span>
<span class='line'>354</span>                <span id='f0s230'>(all-mutual args context)</span>)</span>)
<span class='line'>355</span>       (type-info
<span class='line'>356</span>        <span id='f0s231'>(values constraints
<span class='line'>357</span>                <span id='f0s232'>(mvfold <span id='f0s233'>(lambda (context term)
<span class='line'>358</span>                          <span id='f0s234'>(unify term (type-info-type constraints)
<span class='line'>359</span>                                 context)</span>)</span>
<span class='line'>360</span>                        args
<span class='line'>361</span>                        context)</span>)</span>))</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t219')><span class='toggle' id='pf0t219'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(219)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t219'><code><span id='f0c314'> (lambda (args context &#38;optional (refine-f <span id='f0c245'>(function find-most-refined-value)</span> &#35;:compiler-var))
   <span id='f0c313'>(let* ((constraints <span id='f0c309'>(funcall refine-f args context)</span>)
          (argument-keywords <span id='f0c312'>(funcall &#39;references-from-list <span id='f0c311'>(ccl::typed-form &#39;list args)</span>)</span>))
     (progn <span id='f0c250'>(funcall &#39;consistent-type-check <span id='f0c249'>(ccl::typed-form &#39;list args)</span> <span id='f0c247'>(ccl::typed-form &#39;typing-context context)</span>)</span>
            <span id='f0c306'>(let* ((&#35;:x56248 constraints))
              <span id='f0c305'>(let* ((&#35;:g56249 &#35;:x56248))
                <span id='f0c304'>(if <span id='f0c303'>(let* ((&#35;:g56251 &#35;:g56249)) <span id='f0c302'>(or <span id='f0c299'>(not &#35;:g56251)</span> <span id='f0c301'>(funcall &#39;keywordp &#35;:g56251)</span>)</span>)</span>
                    <span id='f0c298'>(progn nil
                           <span id='f0c297'>(values <span id='f0c291'>(if argument-keywords
                                       <span id='f0c289'>(funcall &#39;make-same-as <span id='f0c288'>&#39;:value</span> <span id='f0c287'>(car argument-keywords)</span>)</span>
                                       <span id='f0c290'>&#39;:refine-integer</span>)</span>
                                   <span id='f0c296'>(funcall &#39;all-mutual
                                            <span id='f0c295'>(ccl::typed-form &#39;list args)</span>
                                            <span id='f0c293'>(ccl::typed-form &#39;typing-context context)</span>)</span>)</span>)</span>
                    <span id='f0c284'>(if <span id='f0c273'>(funcall &#39;ccl:structure-typep &#35;:g56249 <span id='f0c271'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                        <span id='f0c270'>(progn nil
                               <span id='f0c269'>(values constraints
                                       <span id='f0c267'>(funcall &#39;reduce
                                                <span id='f0c263'>(function <span id='f0c262'>(lambda (context term)
                                                            <span id='f0c261'>(funcall &#39;unify
                                                                     <span id='f0c260'>(ccl::typed-form &#39;(or number alu&#46;spec:reference)
                                                                      term)</span>
                                                                     <span id='f0c258'>(ccl::typed-form
                                                                      &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                                      <span id='f0c257'>(ccl::struct-ref <span id='f0c256'>(ccl::typed-form &#39;type-info
                                                                                        constraints)</span>
                                                                                       2)</span>)</span>
                                                                     <span id='f0c253'>(ccl::typed-form &#39;typing-context context)</span>)</span>)</span>)</span>
                                                args
                                                <span id='f0c264'>&#39;:from-end</span>
                                                nil
                                                <span id='f0c266'>&#39;:initial-value</span>
                                                context)</span>)</span>)</span>
                        <span id='f0c283'>(if <span id='f0c282'>(progn &#35;:g56249 t)</span>
                            <span id='f0c280'>(progn nil
                                   <span id='f0c279'>(values (funcall &#39;error <span id='f0c274'>&#39;type-error</span> <span id='f0c278'>&#39;:datum</span> &#35;:x56248 <span id='f0c275'>&#39;:expected-type</span> <span id='f0c276'>&#39;lookup-type</span>))</span>)</span>
                            nil)</span>)</span>)</span>)</span>)</span>))</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>362</span> 
<span class='line'>363</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>364</span> &#59;&#59; Hole Information Filling
<span class='line'>365</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>366</span> 
<span class='line'>367</span> (-&#62; all-mutual (list typing-context) typing-context)
<span id='f0s235'><span class='line'>368</span> (defun all-mutual (normal-forms context)
<span class='line'>369</span>   &#34;Updates the context to note that all the values entail each other&#34;
<span class='line'>370</span>   <span id='f0s236'>(let ((argument-keywords <span id='f0s237'>(references-from-list normal-forms)</span>))
<span class='line'>371</span>     <span id='f0s238'>(values
<span class='line'>372</span>      <span id='f0s239'>(util:copy-instance
<span class='line'>373</span>       context
<span class='line'>374</span>       :hole-info  <span id='f0s240'>(mutual-holes normal-forms <span id='f0s241'>(hole-info context)</span>)</span>
<span class='line'>375</span>       :dependency <span id='f0s242'>(dependency:determine-each-other <span id='f0s243'>(dependency context)</span>
<span class='line'>376</span>                                                    argument-keywords)</span>)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t235')><span class='toggle' id='pf0t235'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(235)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t235'><code><span id='f0c788'> (lambda (normal-forms context)
   <span id='f0c787'>(let* ((argument-keywords <span id='f0c769'>(funcall &#39;references-from-list <span id='f0c768'>(ccl::typed-form &#39;list normal-forms)</span>)</span>))
     <span id='f0c786'>(values <span id='f0c785'>(funcall &#39;util:copy-instance
                      (ccl::typed-form &#39;standard-object context)
                      <span id='f0c770'>&#39;:hole-info</span>
                      <span id='f0c784'>(funcall &#39;mutual-holes
                               <span id='f0c783'>(ccl::typed-form &#39;list normal-forms)</span>
                               <span id='f0c781'>(ccl::typed-form &#39;closure:typ <span id='f0c780'>(funcall &#39;hole-info context)</span>)</span>)</span>
                      <span id='f0c778'>&#39;:dependency</span>
                      <span id='f0c776'>(funcall &#39;dependency:determine-each-other
                               <span id='f0c775'>(ccl::typed-form &#39;dependency:typ <span id='f0c774'>(funcall &#39;dependency context)</span>)</span>
                               <span id='f0c772'>(ccl::typed-form &#39;list argument-keywords)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>377</span> 
<span class='line'>378</span> (-&#62; mutual-holes (list closure:typ) closure:typ)
<span id='f0s244'><span class='line'>379</span> (defun mutual-holes (normal-forms hole-map)
<span class='line'>380</span>   &#34;The normal form values all entail each other&#44; and thus we&#34;
<span class='line'>381</span>   <span id='f0s245'>(mvfold <span id='f0s246'>(lambda (hole-closure normal)
<span class='line'>382</span>             <span id='f0s247'>(etypecase-of ir:term-normal-form normal
<span class='line'>383</span>               (number hole-closure)
<span class='line'>384</span>               (ir:reference
<span class='line'>385</span>                <span id='f0s248'>(let ((hole <span id='f0s249'>(closure:lookup hole-closure <span id='f0s250'>(ir:name normal)</span>)</span>)
<span class='line'>386</span>                      (removed <span id='f0s251'>(remove-if <span id='f0s252'>(lambda (x) <span id='f0s253'>(eql x normal)</span>)</span> normal-forms)</span>))
<span class='line'>387</span>                  <span id='f0s254'>(closure:insert hole-closure
<span class='line'>388</span>                                  <span id='f0s255'>(ir:name normal)</span>
<span class='line'>389</span>                                  <span id='f0s256'>(mvfold <span id='f0s257'>&#35;&#39;add-hole-formula
</span><span class='line'>390</span>                                          removed
<span class='line'>391</span>                                          <span id='f0s258'>(if hole
<span class='line'>392</span>                                              hole
<span class='line'>393</span>                                              <span id='f0s259'>(make-hole-information)</span>)</span>)</span>)</span>)</span>))</span>)</span>
<span class='line'>394</span>           normal-forms
<span class='line'>395</span>           hole-map)</span>)</span>
</code></div>
<a href=javascript:swap('f0t244')><span class='toggle' id='pf0t244'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(244)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t244'><code><span id='f0c766'> (lambda (normal-forms hole-map)
   <span id='f0c765'>(funcall &#39;reduce
            <span id='f0c760'>(function <span id='f0c759'>(lambda (hole-closure normal)
                        <span id='f0c758'>(let* ((&#35;:x56273 normal))
                          <span id='f0c757'>(let* ((&#35;:g56274 &#35;:x56273))
                            <span id='f0c756'>(if <span id='f0c755'>(funcall &#39;numberp &#35;:g56274)</span>
                                <span id='f0c709'>(progn nil hole-closure)</span>
                                <span id='f0c753'>(if <span id='f0c742'>(funcall &#39;ccl::std-instance-class-cell-typep
                                             &#35;:g56274
                                             <span id='f0c740'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003B2DC4F&#62;))</span>)</span>
                                    <span id='f0c739'>(progn nil
                                           <span id='f0c738'>(let ((hole
                                                  <span id='f0c730'>(funcall &#39;closure:lookup
                                                           <span id='f0c726'>(ccl::typed-form &#39;closure:typ hole-closure)</span>
                                                           <span id='f0c729'>(ccl::typed-form &#39;keyword <span id='f0c728'>(funcall &#39;alu&#46;spec:name normal)</span>)</span>)</span>)
                                                 (removed
                                                  <span id='f0c737'>(funcall &#39;remove-if
                                                           <span id='f0c735'>(function <span id='f0c734'>(lambda (x) <span id='f0c733'>(funcall 10 x normal)</span>)</span>)</span>
                                                           normal-forms)</span>))
                                             <span id='f0c724'>(funcall &#39;closure:insert
                                                      <span id='f0c720'>(ccl::typed-form &#39;closure:typ hole-closure)</span>
                                                      <span id='f0c723'>(ccl::typed-form &#39;keyword <span id='f0c722'>(funcall &#39;alu&#46;spec:name normal)</span>)</span>
                                                      <span id='f0c718'>(funcall &#39;reduce
                                                               <span id='f0c712'>(function add-hole-formula)</span>
                                                               removed
                                                               <span id='f0c710'>&#39;:from-end</span>
                                                               nil
                                                               <span id='f0c711'>&#39;:initial-value</span>
                                                               <span id='f0c717'>(if hole hole <span id='f0c714'>(funcall &#39;make-hole-information)</span>)</span>)</span>)</span>)</span>)</span>
                                    <span id='f0c752'>(if <span id='f0c751'>(progn &#35;:g56274 t)</span>
                                        <span id='f0c749'>(progn nil
                                               <span id='f0c748'>(values (funcall &#39;error
                                                                <span id='f0c745'>&#39;type-error</span>
                                                                <span id='f0c743'>&#39;:datum</span>
                                                                &#35;:x56273
                                                                <span id='f0c746'>&#39;:expected-type</span>
                                                                <span id='f0c744'>&#39;alu&#46;spec:term-normal-form</span>))</span>)</span>
                                        nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>
            normal-forms
            <span id='f0c761'>&#39;:from-end</span>
            nil
            <span id='f0c762'>&#39;:initial-value</span>
            hole-map)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>396</span> 
<span class='line'>397</span> 
<span id='f0s260'><span class='line'>398</span> (defun make-starting-hole (keywords typing-context)
<span class='line'>399</span>   <span id='f0s261'>(util:copy-instance typing-context
<span class='line'>400</span>                       :holes <span id='f0s262'>(append keywords <span id='f0s263'>(holes typing-context)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t260')><span class='toggle' id='pf0t260'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(260)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t260'><code><span id='f0c2015'> (lambda (keywords typing-context)
   <span id='f0c2014'>(funcall &#39;util:copy-instance
            <span id='f0c2008'>(ccl::typed-form &#39;standard-object typing-context)</span>
            <span id='f0c2013'>&#39;:holes</span>
            <span id='f0c2012'>(funcall &#39;ccl::append-2 keywords <span id='f0c2010'>(funcall &#39;holes typing-context)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>401</span> 
<span class='line'>402</span> (-&#62; dump-solved (typing-context) typing-context)
<span id='f0s264'><span class='line'>403</span> (defun dump-solved (context)
<span class='line'>404</span>   <span id='f0s265'>(values
<span class='line'>405</span>    <span id='f0s266'>(util:copy-instance context
<span class='line'>406</span>                        :dependency <span id='f0s267'>(dependency:dump-solved
<span class='line'>407</span>                                     <span id='f0s268'>(dependency context)</span>)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t264')><span class='toggle' id='pf0t264'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(264)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t264'><code><span id='f0c947'> (lambda (context)
   <span id='f0c946'>(values <span id='f0c945'>(funcall &#39;util:copy-instance
                    <span id='f0c944'>(ccl::typed-form &#39;standard-object context)</span>
                    <span id='f0c938'>&#39;:dependency</span>
                    <span id='f0c942'>(funcall &#39;dependency:dump-solved <span id='f0c941'>(ccl::typed-form &#39;dependency:typ <span id='f0c940'>(funcall &#39;dependency context)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>408</span> 
<span class='line'>409</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>410</span> &#59;&#59; Normal Form&#47;Reference&#47;Keywords Lookups
<span class='line'>411</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>412</span> 
<span class='line'>413</span> (-&#62; normal-form-to-type-info-not-number-err (ir:term-type-manipulation
<span class='line'>414</span>                                              ir:term-normal-form
<span class='line'>415</span>                                              typing-context)
<span class='line'>416</span>     lookup-type)
<span id='f0s269'><span class='line'>417</span> (defun normal-form-to-type-info-not-number-err (term arg context)
<span class='line'>418</span>   <span id='f0s270'>(etypecase-of ir:term-normal-form arg
<span class='line'>419</span>     (number       <span id='f0s271'>(log:error term :type <span id='f0s272'>&#34;Value is a number when not expected&#34;</span>)</span>)
<span class='line'>420</span>     (ir:reference <span id='f0s273'>(find-type-info arg <span id='f0s274'>(ir:name arg)</span> context)</span>))</span>)</span>
</code></div>
<a href=javascript:swap('f0t269')><span class='toggle' id='pf0t269'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(269)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t269'><code><span id='f0c690'> (lambda (term arg context)
   <span id='f0c689'>(let* ((&#35;:x56305 arg))
     <span id='f0c688'>(let* ((&#35;:g56306 &#35;:x56305))
       <span id='f0c687'>(if <span id='f0c658'>(funcall &#39;numberp &#35;:g56306)</span>
           <span id='f0c686'>(progn nil <span id='f0c685'>(funcall &#39;log:error term <span id='f0c683'>&#39;:type</span> <span id='f0c682'>&#39;&#34;Value is a number when not expected&#34;</span>)</span>)</span>
           <span id='f0c681'>(if <span id='f0c670'>(funcall &#39;ccl::std-instance-class-cell-typep
                        &#35;:g56306
                        <span id='f0c669'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003B8292F&#62;))</span>)</span>
               <span id='f0c667'>(progn nil
                      <span id='f0c666'>(funcall &#39;find-type-info
                               <span id='f0c660'>(ccl::typed-form &#39;alu&#46;spec:reference arg)</span>
                               <span id='f0c665'>(ccl::typed-form &#39;keyword <span id='f0c664'>(funcall &#39;alu&#46;spec:name arg)</span>)</span>
                               <span id='f0c662'>(ccl::typed-form &#39;typing-context context)</span>)</span>)</span>
               <span id='f0c680'>(if <span id='f0c679'>(progn &#35;:g56306 t)</span>
                   <span id='f0c677'>(progn nil
                          <span id='f0c676'>(values (funcall &#39;error
                                           <span id='f0c673'>&#39;type-error</span>
                                           <span id='f0c672'>&#39;:datum</span>
                                           &#35;:x56305
                                           <span id='f0c674'>&#39;:expected-type</span>
                                           <span id='f0c675'>&#39;alu&#46;spec:term-normal-form</span>))</span>)</span>
                   nil)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>421</span> 
<span class='line'>422</span> (-&#62; normal-form-to-type-info (ir:term-normal-form typing-context) lookup-type)
<span id='f0s275'><span class='line'>423</span> (defun normal-form-to-type-info (arg context)
<span class='line'>424</span>   <span id='f0s276'>(etypecase-of ir:term-normal-form arg
<span class='line'>425</span>     (number       <span id='f0s277'>(assure hole :int)</span>)
<span class='line'>426</span>     (ir:reference <span id='f0s278'>(find-type-info arg <span id='f0s279'>(ir:name arg)</span> context)</span>))</span>)</span>
</code></div>
<a href=javascript:swap('f0t275')><span class='toggle' id='pf0t275'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(275)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t275'><code><span id='f0c43'> (lambda (arg context)
   <span id='f0c42'>(let* ((&#35;:x56319 arg))
     <span id='f0c41'>(let* ((&#35;:g56320 &#35;:x56319))
       <span id='f0c40'>(if <span id='f0c39'>(funcall &#39;numberp &#35;:g56320)</span>
           <span id='f0c37'>(progn nil
                  <span id='f0c36'>(ccl::typed-form &#39;(or null keyword)
                   <span id='f0c35'>(let* ()
                     <span id='f0c34'>(if <span id='f0c28'>(let* ((&#35;:g56323 &#39;:int)) <span id='f0c27'>(or <span id='f0c24'>(not &#35;:g56323)</span> <span id='f0c26'>(funcall &#39;keywordp &#35;:g56323)</span>)</span>)</span>
                         <span id='f0c33'>&#39;:int</span>
                         <span id='f0c32'>(ccl::typed-form &#39;(or null keyword) <span id='f0c31'>(funcall &#39;serapeum::&#37;require-type <span id='f0c29'>&#39;:int</span> <span id='f0c30'>&#39;hole</span>)</span>)</span>)</span>)</span>)</span>)</span>
           <span id='f0c22'>(if <span id='f0c2'>(funcall &#39;ccl::std-instance-class-cell-typep
                        &#35;:g56320
                        <span id='f0c1'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003BD20FF&#62;))</span>)</span>
               <span id='f0c21'>(progn nil
                      <span id='f0c20'>(funcall &#39;find-type-info
                               <span id='f0c16'>(ccl::typed-form &#39;alu&#46;spec:reference arg)</span>
                               <span id='f0c19'>(ccl::typed-form &#39;keyword <span id='f0c18'>(funcall &#39;alu&#46;spec:name arg)</span>)</span>
                               <span id='f0c14'>(ccl::typed-form &#39;typing-context context)</span>)</span>)</span>
               <span id='f0c12'>(if <span id='f0c11'>(progn &#35;:g56320 t)</span>
                   <span id='f0c9'>(progn nil
                          <span id='f0c8'>(values (funcall &#39;error
                                           <span id='f0c3'>&#39;type-error</span>
                                           <span id='f0c5'>&#39;:datum</span>
                                           &#35;:x56319
                                           <span id='f0c6'>&#39;:expected-type</span>
                                           <span id='f0c7'>&#39;alu&#46;spec:term-normal-form</span>))</span>)</span>
                   nil)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>427</span> 
<span class='line'>428</span> (-&#62; find-type-info (ir:reference keyword typing-context) lookup-type)
<span id='f0s280'><span class='line'>429</span> (defun find-type-info (ref name context)
<span class='line'>430</span>   &#34;Grabs the typing value from the given keyword&#46; If this lookup fails&#44;
<span class='line'>431</span> we try to get the unrefined type&#46;&#34;
<span class='line'>432</span>   <span id='f0s281'>(let ((looked <span id='f0s282'>(closure:lookup <span id='f0s283'>(typing-closure context)</span> name)</span>))
<span class='line'>433</span>     <span id='f0s284'>(cond (looked looked)
<span class='line'>434</span>           (<span id='f0s285'>(member name <span id='f0s286'>(holes context)</span>)</span>
<span class='line'>435</span>            <span id='f0s287'>(let ((value <span id='f0s288'>(closure:lookup <span id='f0s289'>(hole-info context)</span> name)</span>))
<span class='line'>436</span>              <span id='f0s290'>(and value <span id='f0s291'>(hole-information-unrefined value)</span>)</span>)</span>)
<span class='line'>437</span>           (t
<span class='line'>438</span>            <span id='f0s292'>(log:error ref :type
<span class='line'>439</span>                       <span id='f0s293'>&#34;Internal error: Value &#126;A is not a known hole in &#126;A&#34;</span>
<span class='line'>440</span>                       name context)</span>))</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t280')><span class='toggle' id='pf0t280'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(280)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t280'><code><span id='f0c350'> (lambda (ref name context)
   <span id='f0c349'>(let* ((looked
           <span id='f0c348'>(funcall &#39;closure:lookup
                    <span id='f0c345'>(ccl::typed-form &#39;closure:typ <span id='f0c344'>(funcall &#39;typing-closure context)</span>)</span>
                    <span id='f0c347'>(ccl::typed-form &#39;keyword name)</span>)</span>))
     <span id='f0c342'>(if looked
         looked
         <span id='f0c339'>(if <span id='f0c338'>(funcall &#39;ccl::memeql name <span id='f0c337'>(funcall &#39;holes context)</span>)</span>
             <span id='f0c328'>(let* ((value
                     <span id='f0c327'>(funcall &#39;closure:lookup
                              <span id='f0c324'>(ccl::typed-form &#39;closure:typ <span id='f0c323'>(funcall &#39;hole-info context)</span>)</span>
                              <span id='f0c326'>(ccl::typed-form &#39;keyword name)</span>)</span>))
               <span id='f0c321'>(if value
                   <span id='f0c319'>(ccl::typed-form &#39;(or null keyword) <span id='f0c318'>(ccl::struct-ref <span id='f0c316'>(ccl::typed-form &#39;hole-information value)</span> 1)</span>)</span>
                   nil)</span>)</span>
             <span id='f0c334'>(funcall &#39;log:error ref <span id='f0c330'>&#39;:type</span> <span id='f0c331'>&#39;&#34;Internal error: Value &#126;A is not a known hole in &#126;A&#34;</span> name context)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>441</span> 
<span class='line'>442</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>443</span> &#59;&#59; Refining over a list of types
<span class='line'>444</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>445</span> 
<span class='line'>446</span> (-&#62; find-integer-type-from-args (list typing-context) lookup-type)
<span id='f0s294'><span class='line'>447</span> (defun find-integer-type-from-args (args context)
<span class='line'>448</span>   &#34;Finds the most refined integer type in the given argument list&#46; If
<span class='line'>449</span> the values are contradictory or if the most refined value is not an
<span class='line'>450</span> integer then it will error&#46;&#34;
<span class='line'>451</span>   <span id='f0s295'>(let* ((most-refined-value <span id='f0s296'>(find-most-refined-value args context)</span>)
<span class='line'>452</span>          (integer-constraint
<span class='line'>453</span>            <span id='f0s297'>(etypecase-of lookup-type most-refined-value
<span class='line'>454</span>              (hole
<span class='line'>455</span>               <span id='f0s298'>(etypecase-of hole most-refined-value
<span class='line'>456</span>                 (null <span id='f0s299'>(assure hole :int)</span>)
<span class='line'>457</span>                 (keyword <span id='f0s300'>(if <span id='f0s301'>(or <span id='f0s302'>(eql most-refined-value :int)</span>
<span class='line'>458</span>                                  <span id='f0s303'>(eql most-refined-value :bool)</span>)</span>
<span class='line'>459</span>                              most-refined-value
<span class='line'>460</span>                              <span id='f0s304'>(log:error <span id='f0s305'>(car <span id='f0s306'>(references-from-list args)</span>)</span>
<span class='line'>461</span>                                         :type
<span class='line'>462</span>                                         <span id='f0s307'>&#34;the given type &#126;A is not an integer type&#34;</span>
<span class='line'>463</span>                                         most-refined-value)</span>)</span>))</span>)
<span class='line'>464</span>              (type-info
<span class='line'>465</span>               <span id='f0s308'>(if <span id='f0s309'>(type-op:int-reference&#63;
<span class='line'>466</span>                    (type-info-type most-refined-value))</span>
<span class='line'>467</span>                   most-refined-value
<span class='line'>468</span>                   <span id='f0s310'>(log:error most-refined-value :type
<span class='line'>469</span>                          <span id='f0s311'>(type-info-type most-refined-value)</span>)</span>)</span>))</span>))
<span class='line'>470</span>     integer-constraint)</span>)</span>
</code></div>
<a href=javascript:swap('f0t294')><span class='toggle' id='pf0t294'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(294)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t294'><code><span id='f0c212'> (lambda (args context)
   <span id='f0c211'>(let* ((most-refined-value
           <span id='f0c121'>(funcall &#39;find-most-refined-value <span id='f0c118'>(ccl::typed-form &#39;list args)</span> <span id='f0c120'>(ccl::typed-form &#39;typing-context context)</span>)</span>)
          (integer-constraint
           <span id='f0c209'>(let* ((&#35;:x56345 most-refined-value))
             <span id='f0c208'>(let* ((&#35;:g56346 &#35;:x56345))
               <span id='f0c207'>(if <span id='f0c206'>(let* ((&#35;:g56348 &#35;:g56346)) <span id='f0c205'>(or <span id='f0c204'>(not &#35;:g56348)</span> <span id='f0c203'>(funcall &#39;keywordp &#35;:g56348)</span>)</span>)</span>
                   <span id='f0c201'>(progn nil
                          <span id='f0c200'>(let* ((&#35;:x56349 most-refined-value))
                            <span id='f0c199'>(let* ((&#35;:g56350 &#35;:x56349))
                              <span id='f0c198'>(if <span id='f0c153'>(not &#35;:g56350)</span>
                                  <span id='f0c197'>(progn nil
                                         <span id='f0c196'>(ccl::typed-form &#39;(or null keyword)
                                          <span id='f0c195'>(let* ()
                                            <span id='f0c194'>(if <span id='f0c193'>(let* ((&#35;:g56353 &#39;:int))
                                                  <span id='f0c192'>(or <span id='f0c189'>(not &#35;:g56353)</span> <span id='f0c191'>(funcall &#39;keywordp &#35;:g56353)</span>)</span>)</span>
                                                <span id='f0c183'>&#39;:int</span>
                                                <span id='f0c187'>(ccl::typed-form &#39;(or null keyword)
                                                 <span id='f0c186'>(funcall &#39;serapeum::&#37;require-type <span id='f0c184'>&#39;:int</span> <span id='f0c185'>&#39;hole</span>)</span>)</span>)</span>)</span>)</span>)</span>
                                  <span id='f0c182'>(if <span id='f0c155'>(funcall &#39;keywordp &#35;:g56350)</span>
                                      <span id='f0c181'>(progn nil
                                             <span id='f0c180'>(if <span id='f0c179'>(or <span id='f0c176'>(eq most-refined-value &#39;:int)</span> <span id='f0c178'>(eq most-refined-value &#39;:bool)</span>)</span>
                                                 most-refined-value
                                                 <span id='f0c174'>(funcall &#39;log:error
                                                          <span id='f0c173'>(ccl::&#37;car <span id='f0c172'>(funcall &#39;references-from-list
                                                                              <span id='f0c171'>(ccl::typed-form &#39;list args)</span>)</span>)</span>
                                                          <span id='f0c169'>&#39;:type</span>
                                                          <span id='f0c168'>&#39;&#34;the given type &#126;A is not an integer type&#34;</span>
                                                          most-refined-value)</span>)</span>)</span>
                                      <span id='f0c165'>(if <span id='f0c164'>(progn &#35;:g56350 t)</span>
                                          <span id='f0c162'>(progn nil
                                                 <span id='f0c161'>(values (funcall &#39;error
                                                                  <span id='f0c159'>&#39;type-error</span>
                                                                  <span id='f0c156'>&#39;:datum</span>
                                                                  &#35;:x56349
                                                                  <span id='f0c158'>&#39;:expected-type</span>
                                                                  <span id='f0c160'>&#39;hole</span>))</span>)</span>
                                          nil)</span>)</span>)</span>)</span>)</span>)</span>
                   <span id='f0c152'>(if <span id='f0c151'>(funcall &#39;ccl:structure-typep &#35;:g56346 <span id='f0c150'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                       <span id='f0c148'>(progn nil
                              <span id='f0c147'>(if <span id='f0c146'>(funcall &#39;type-op:int-reference&#63;
                                           <span id='f0c145'>(ccl::typed-form &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                            <span id='f0c144'>(ccl::struct-ref <span id='f0c143'>(ccl::typed-form &#39;type-info most-refined-value)</span> 2)</span>)</span>)</span>
                                  most-refined-value
                                  <span id='f0c139'>(funcall &#39;log:error
                                           most-refined-value
                                           <span id='f0c138'>&#39;:type</span>
                                           <span id='f0c137'>(ccl::typed-form &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                            <span id='f0c136'>(ccl::struct-ref <span id='f0c135'>(ccl::typed-form &#39;type-info most-refined-value)</span> 2)</span>)</span>)</span>)</span>)</span>
                       <span id='f0c131'>(if <span id='f0c123'>(progn &#35;:g56346 t)</span>
                           <span id='f0c130'>(progn nil
                                  <span id='f0c129'>(values (funcall &#39;error <span id='f0c126'>&#39;type-error</span> <span id='f0c124'>&#39;:datum</span> &#35;:x56345 <span id='f0c127'>&#39;:expected-type</span> <span id='f0c128'>&#39;lookup-type</span>))</span>)</span>
                           nil)</span>)</span>)</span>)</span>)</span>))
     integer-constraint)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>471</span> 
<span class='line'>472</span> (-&#62; references-from-list (list) list)
<span id='f0s312'><span class='line'>473</span> (defun references-from-list (normal-forms)
<span class='line'>474</span>   &#34;Turns a list of normal forms into the list of their keywords&#34;
<span class='line'>475</span>   <span id='f0s313'>(filter-map <span id='f0s314'>(lambda (x)
<span class='line'>476</span>                 <span id='f0s315'>(etypecase-of ir:term-normal-form x
<span class='line'>477</span>                   (number nil)
<span class='line'>478</span>                   (ir:reference <span id='f0s316'>(ir:name x)</span>))</span>)</span>
<span class='line'>479</span>               normal-forms)</span>)</span>
</code></div>
<a href=javascript:swap('f0t312')><span class='toggle' id='pf0t312'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(312)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t312'><code><span id='f0c116'> (lambda (normal-forms)
   <span id='f0c115'>(let* ((&#35;:f56364
           <span id='f0c83'>(funcall &#39;alexandria:ensure-function
                    <span id='f0c82'>(function <span id='f0c81'>(lambda (x)
                                <span id='f0c80'>(let* ((&#35;:x56366 x))
                                  <span id='f0c79'>(let* ((&#35;:g56367 &#35;:x56366))
                                    <span id='f0c78'>(if <span id='f0c59'>(funcall &#39;numberp &#35;:g56367)</span>
                                        <span id='f0c77'>(progn nil nil)</span>
                                        <span id='f0c76'>(if <span id='f0c75'>(funcall &#39;ccl::std-instance-class-cell-typep
                                                     &#35;:g56367
                                                     <span id='f0c73'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x302003C8985F&#62;))</span>)</span>
                                            <span id='f0c72'>(progn nil <span id='f0c71'>(funcall &#39;alu&#46;spec:name x)</span>)</span>
                                            <span id='f0c69'>(if <span id='f0c61'>(progn &#35;:g56367 t)</span>
                                                <span id='f0c68'>(progn nil
                                                       <span id='f0c67'>(values (funcall &#39;error
                                                                        <span id='f0c66'>&#39;type-error</span>
                                                                        <span id='f0c64'>&#39;:datum</span>
                                                                        &#35;:x56366
                                                                        <span id='f0c63'>&#39;:expected-type</span>
                                                                        <span id='f0c62'>&#39;alu&#46;spec:term-normal-form</span>))</span>)</span>
                                                nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>))
     <span id='f0c114'>(block nil
       <span id='f0c113'>(let ((&#35;:g56363 nil) (&#35;:loop-list-56371 normal-forms))
         <span id='f0c111'>(let* ((&#35;:result56365 nil))
           <span id='f0c110'>(let* ((&#35;:loop-list-head-56372 <span id='f0c109'>(cons nil nil)</span>) (&#35;:loop-list-tail-56373 &#35;:loop-list-head-56372))
             <span id='f0c108'>(tagbody (ansi-loop::next-loop nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C862DD&#62; t t)
                      <span id='f0c91'>(if <span id='f0c90'>(endp &#35;:loop-list-56371)</span> (go ansi-loop::end-loop) nil)</span>
                      <span id='f0c104'>(setq &#35;:g56363 <span id='f0c103'>(ccl::&#37;car &#35;:loop-list-56371)</span>)</span>
                      <span id='f0c107'>(setq &#35;:loop-list-56371 <span id='f0c106'>(ccl::&#37;cdr &#35;:loop-list-56371)</span>)</span>
                      <span id='f0c94'>(setq &#35;:result56365 <span id='f0c93'>(funcall &#35;:f56364 &#35;:g56363)</span>)</span>
                      <span id='f0c101'>(if &#35;:result56365
                          <span id='f0c100'>(rplacd &#35;:loop-list-tail-56373 <span id='f0c99'>(setq &#35;:loop-list-tail-56373 <span id='f0c98'>(cons &#35;:result56365 nil)</span>)</span>)</span>
                          nil)</span>
                      <span id='f0c85'>(go ansi-loop::next-loop)</span>
                      (ansi-loop::end-loop nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C862DD&#62; t nil)
                      <span id='f0c88'>(return-from nil <span id='f0c87'>(cdr &#35;:loop-list-head-56372)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>480</span> 
<span class='line'>481</span> (-&#62; find-most-refined-value (list typing-context) lookup-type)
<span id='f0s317'><span class='line'>482</span> (defun find-most-refined-value (args context)
<span class='line'>483</span>   <span id='f0s318'>(mvfold <span id='f0s319'>(lambda (val most-refined-so-far)
<span class='line'>484</span>             <span id='f0s320'>(dispatch-case ((val                 lookup-type)
<span class='line'>485</span>                             (most-refined-so-far lookup-type))
<span class='line'>486</span>               ((type-info hole)      val)
<span class='line'>487</span>               ((type-info type-info) most-refined-so-far) &#59; these should agree
<span class='line'>488</span>               ((hole      type-info) most-refined-so-far)
<span class='line'>489</span>               ((hole      keyword)   most-refined-so-far)
<span class='line'>490</span>               ((hole      null)      val))</span>)</span>
<span class='line'>491</span>           <span id='f0s321'>(mapcar <span id='f0s322'>(lambda (arg) <span id='f0s323'>(normal-form-to-type-info arg context)</span>)</span> args)</span>
<span class='line'>492</span>           <span id='f0s324'>(assure hole nil)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t317')><span class='toggle' id='pf0t317'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(317)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t317'><code><span id='f0c937'> (lambda (args context)
   <span id='f0c936'>(funcall &#39;reduce
            <span id='f0c920'>(function <span id='f0c919'>(lambda (val most-refined-so-far)
                        <span id='f0c918'>(let ((&#35;:arg0 val) (&#35;:arg1 most-refined-so-far))
                          <span id='f0c917'>(let ((&#35;:arg056396 &#35;:arg0) (&#35;:arg156397 &#35;:arg1))
                            <span id='f0c916'>(block &#35;:block56390
                              <span id='f0c915'>(tagbody <span id='f0c906'>(let* ((&#35;:expr56398 &#35;:arg056396))
                                         <span id='f0c905'>(let* ((&#35;:g56399 &#35;:expr56398))
                                           <span id='f0c904'>(if <span id='f0c856'>(funcall &#39;ccl:structure-typep
                                                        &#35;:g56399
                                                        <span id='f0c854'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                               <span id='f0c853'>(progn nil
                                                      <span id='f0c852'>(let* ((&#35;:expr56400 &#35;:arg156397))
                                                        <span id='f0c851'>(let* ((&#35;:g56401 &#35;:expr56400))
                                                          <span id='f0c850'>(if <span id='f0c847'>(let* ((&#35;:g56403 &#35;:g56401))
                                                                <span id='f0c846'>(or <span id='f0c843'>(not &#35;:g56403)</span> <span id='f0c845'>(funcall &#39;keywordp &#35;:g56403)</span>)</span>)</span>
                                                              <span id='f0c849'>(progn nil <span id='f0c848'>(go &#35;:tag56391)</span>)</span>
                                                              <span id='f0c842'>(if <span id='f0c841'>(funcall &#39;ccl:structure-typep
                                                                           &#35;:g56401
                                                                           <span id='f0c840'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                  <span id='f0c838'>(progn nil <span id='f0c837'>(go &#35;:tag56392)</span>)</span>
                                                                  <span id='f0c836'>(if <span id='f0c835'>(progn &#35;:g56401 t)</span>
                                                                      <span id='f0c833'>(progn nil
                                                                             <span id='f0c832'>(values (funcall &#39;error
                                                                                              <span id='f0c829'>&#39;dispatch-case-error</span>
                                                                                              <span id='f0c828'>&#39;:expected-type</span>
                                                                                              <span id='f0c826'>&#39;lookup-type</span>
                                                                                              <span id='f0c831'>&#39;:datum</span>
                                                                                              &#35;:expr56400
                                                                                              <span id='f0c825'>&#39;:matched-types</span>
                                                                                              <span id='f0c830'>&#39;(lookup-type)</span>))</span>)</span>
                                                                      nil)</span>)</span>)</span>)</span>)</span>)</span>
                                               <span id='f0c903'>(if <span id='f0c902'>(let* ((&#35;:g56405 &#35;:g56399))
                                                     <span id='f0c901'>(or <span id='f0c900'>(not &#35;:g56405)</span> <span id='f0c899'>(funcall &#39;keywordp &#35;:g56405)</span>)</span>)</span>
                                                   <span id='f0c897'>(progn nil
                                                          <span id='f0c896'>(let* ((&#35;:expr56406 &#35;:arg156397))
                                                            <span id='f0c895'>(let* ((&#35;:g56407 &#35;:expr56406))
                                                              <span id='f0c894'>(if <span id='f0c870'>(funcall &#39;ccl:structure-typep
                                                                           &#35;:g56407
                                                                           <span id='f0c868'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                  <span id='f0c872'>(progn nil <span id='f0c871'>(go &#35;:tag56393)</span>)</span>
                                                                  <span id='f0c893'>(if <span id='f0c874'>(funcall &#39;keywordp &#35;:g56407)</span>
                                                                      <span id='f0c876'>(progn nil <span id='f0c875'>(go &#35;:tag56394)</span>)</span>
                                                                      <span id='f0c892'>(if <span id='f0c891'>(not &#35;:g56407)</span>
                                                                          <span id='f0c878'>(progn nil <span id='f0c877'>(go &#35;:tag56395)</span>)</span>
                                                                          <span id='f0c890'>(if <span id='f0c889'>(progn &#35;:g56407 t)</span>
                                                                              <span id='f0c887'>(progn nil
                                                                                     <span id='f0c886'>(values (funcall &#39;error
                                                                                                      <span id='f0c885'>&#39;dispatch-case-error</span>
                                                                                                      <span id='f0c883'>&#39;:expected-type</span>
                                                                                                      <span id='f0c882'>&#39;lookup-type</span>
                                                                                                      <span id='f0c881'>&#39;:datum</span>
                                                                                                      &#35;:expr56406
                                                                                                      <span id='f0c880'>&#39;:matched-types</span>
                                                                                                      <span id='f0c879'>&#39;(lookup-type)</span>))</span>)</span>
                                                                              nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>
                                                   <span id='f0c867'>(if <span id='f0c858'>(progn &#35;:g56399 t)</span>
                                                       <span id='f0c866'>(progn nil
                                                              <span id='f0c865'>(values (funcall &#39;error
                                                                               <span id='f0c859'>&#39;dispatch-case-error</span>
                                                                               <span id='f0c860'>&#39;:expected-type</span>
                                                                               <span id='f0c861'>&#39;lookup-type</span>
                                                                               <span id='f0c863'>&#39;:datum</span>
                                                                               &#35;:expr56398
                                                                               <span id='f0c864'>&#39;:matched-types</span>
                                                                               nil))</span>)</span>
                                                       nil)</span>)</span>)</span>)</span>)</span>
                                       (&#35;:tag56391 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003CFF77D&#62; t nil)
                                       <span id='f0c910'>(return-from &#35;:block56390 val)</span>
                                       (&#35;:tag56392 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003CFF77D&#62; t nil)
                                       <span id='f0c914'>(return-from &#35;:block56390 most-refined-so-far)</span>
                                       (&#35;:tag56393 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003CFF77D&#62; t nil)
                                       <span id='f0c908'>(return-from &#35;:block56390 most-refined-so-far)</span>
                                       (&#35;:tag56394 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003CFF77D&#62; t nil)
                                       <span id='f0c824'>(return-from &#35;:block56390 most-refined-so-far)</span>
                                       (&#35;:tag56395 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003CFF77D&#62; t nil)
                                       <span id='f0c912'>(return-from &#35;:block56390 val)</span>)</span>)</span>)</span>)</span>)</span>)</span>
            <span id='f0c822'>(let* ((&#35;:g56386 <span id='f0c821'>(cons nil nil)</span>)
                   (&#35;:g56387 &#35;:g56386)
                   (&#35;:g56389
                    <span id='f0c820'>(function <span id='f0c819'>(lambda (arg)
                                <span id='f0c818'>(funcall &#39;normal-form-to-type-info
                                         <span id='f0c815'>(ccl::typed-form &#39;(or number alu&#46;spec:reference) arg)</span>
                                         <span id='f0c817'>(ccl::typed-form &#39;typing-context context)</span>)</span>)</span>)</span>))
              <span id='f0c812'>(let* ((&#35;:g56408 args))
                (progn <span id='f0c811'>(tagbody <span id='f0c808'>(go &#35;:g56410)</span>
                                (&#35;:g56409 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003CE928D&#62; t t)
                                <span id='f0c807'>(tagbody <span id='f0c806'>(let* ((&#35;:g56388 <span id='f0c798'>(car &#35;:g56408)</span>))
                                           <span id='f0c805'>(tagbody <span id='f0c804'>(setq &#35;:g56386
                                                          <span id='f0c803'>(ccl::&#37;cdr (ccl::&#37;rplacd &#35;:g56386
                                                                                   <span id='f0c802'>(cons <span id='f0c801'>(funcall &#35;:g56389 &#35;:g56388)</span>
                                                                                         nil)</span>))</span>)</span>)</span>)</span>)</span>
                                <span id='f0c796'>(setq &#35;:g56408 <span id='f0c795'>(ccl::&#37;cdr <span id='f0c794'>(ccl::typed-form &#39;list &#35;:g56408)</span>)</span>)</span>
                                (&#35;:g56410 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003CE928D&#62; t nil)
                                <span id='f0c810'>(if <span id='f0c809'>(not &#39;:ne &#35;:g56408)</span> (go &#35;:g56409) nil)</span>)</span>
                       <span id='f0c791'>(let* () <span id='f0c790'>(ccl::&#37;cdr &#35;:g56387)</span>)</span>))</span>)</span>
            <span id='f0c935'>&#39;:from-end</span>
            nil
            <span id='f0c921'>&#39;:initial-value</span>
            <span id='f0c934'>(ccl::typed-form &#39;(or null keyword)
             <span id='f0c933'>(let* ()
               <span id='f0c932'>(if <span id='f0c927'>(let* ((&#35;:g56413 nil)) <span id='f0c926'>(or <span id='f0c925'>(not &#35;:g56413)</span> <span id='f0c924'>(funcall &#39;keywordp &#35;:g56413)</span>)</span>)</span>
                   nil
                   <span id='f0c931'>(ccl::typed-form &#39;(or null keyword) <span id='f0c930'>(funcall &#39;serapeum::&#37;require-type nil <span id='f0c928'>&#39;hole</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>493</span> 
<span class='line'>494</span> (-&#62; consistent-type-check (list typing-context) (or t null))
<span id='f0s325'><span class='line'>495</span> (defun consistent-type-check (args context)
<span class='line'>496</span>   &#59;&#59; we just bind this term to get better error messages
<span class='line'>497</span>   <span id='f0s326'>(labels (<span id='f0s327'>(get-error-term ()
<span class='line'>498</span>              <span id='f0s328'>(car <span id='f0s329'>(references-from-list args)</span>)</span>)</span>
<span class='line'>499</span>            <span id='f0s330'>(keyword-case (type keyword)
<span class='line'>500</span>              <span id='f0s331'>(etypecase-of known-primitve-types keyword
<span class='line'>501</span>                ((or (eql :int) (eql :bool))
<span class='line'>502</span>                 <span id='f0s332'>(if <span id='f0s333'>(type-op:int-reference&#63; (type-info-type type))</span>
<span class='line'>503</span>                     type
<span class='line'>504</span>                     <span id='f0s334'>(log:error <span id='f0s335'>(get-error-term)</span> <span id='f0s336'>&#39;(:type :unification)</span>
<span class='line'>505</span>                                <span id='f0s337'>&#34;Type &#126;A is not consistent with Integer&#34;</span>
<span class='line'>506</span>                                <span id='f0s338'>(type-info-type type)</span>)</span>)</span>)
<span class='line'>507</span>                ((eql :array)
<span class='line'>508</span>                 <span id='f0s339'>(if <span id='f0s340'>(type-op:array-reference&#63; (type-info-type type))</span>
<span class='line'>509</span>                     type
<span class='line'>510</span>                     <span id='f0s341'>(log:error <span id='f0s342'>(get-error-term)</span> <span id='f0s343'>&#39;(:type :unification)</span>
<span class='line'>511</span>                                <span id='f0s344'>&#34;Type &#126;A is not consistent with Integer&#34;</span>
<span class='line'>512</span>                                <span id='f0s345'>(type-info-type type)</span>)</span>)</span>)
<span class='line'>513</span>                ((eql :void)
<span class='line'>514</span>                 <span id='f0s346'>(log:error <span id='f0s347'>(get-error-term)</span> <span id='f0s348'>&#39;(:type :unification)</span>
<span class='line'>515</span>                            <span id='f0s349'>&#34;The value void should not be used as an argument&#34;</span>)</span>))</span>)</span>)
<span class='line'>516</span>     <span id='f0s350'>(mvfold <span id='f0s351'>(lambda (current-most-known-type val)
<span class='line'>517</span>               <span id='f0s352'>(dispatch-case ((val                     lookup-type)
<span class='line'>518</span>                               (current-most-known-type lookup-type))
<span class='line'>519</span>                 ((*         null)      val)
<span class='line'>520</span>                 ((null      *)         current-most-known-type)
<span class='line'>521</span>                 ((type-info keyword)   <span id='f0s353'>(keyword-case val current-most-known-type)</span>)
<span class='line'>522</span>                 ((keyword   type-info) <span id='f0s354'>(keyword-case current-most-known-type val)</span>)
<span class='line'>523</span>                 ((keyword   keyword)
<span class='line'>524</span>                  <span id='f0s355'>(if <span id='f0s356'>(eql val current-most-known-type)</span>
<span class='line'>525</span>                      val
<span class='line'>526</span>                      <span id='f0s357'>(log:error <span id='f0s358'>(get-error-term)</span> <span id='f0s359'>&#39;(:type :unification)</span>
<span class='line'>527</span>                                 <span id='f0s360'>&#34;Values &#126;A and &#126;A are not consistent&#34;</span>
<span class='line'>528</span>                                 val current-most-known-type)</span>)</span>)
<span class='line'>529</span>                 ((type-info type-info)
<span class='line'>530</span>                  <span id='f0s361'>(if <span id='f0s362'>(type-equality (type-info-type val)
<span class='line'>531</span>                                     (type-info-type
<span class='line'>532</span>                                      current-most-known-type))</span>
<span class='line'>533</span>                      current-most-known-type
<span class='line'>534</span>                      <span id='f0s363'>(log:error <span id='f0s364'>(get-error-term)</span> <span id='f0s365'>&#39;(:type :unification)</span>
<span class='line'>535</span>                                 <span id='f0s366'>&#34;Values &#126;A and &#126;A are not consistent&#34;</span>
<span class='line'>536</span>                                 val current-most-known-type)</span>)</span>))</span>)</span>
<span class='line'>537</span>             <span id='f0s367'>(mapcar <span id='f0s368'>(lambda (arg) <span id='f0s369'>(normal-form-to-type-info arg context)</span>)</span> args)</span>
<span class='line'>538</span>             <span id='f0s370'>(assure hole nil)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t325')><span class='toggle' id='pf0t325'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(325)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t325'><code><span id='f0c656'> (lambda (args context)
   <span id='f0c655'>(labels ((&#35;:get-error-term &#35;1&#61;<span id='f0c442'>(lambda nil <span id='f0c441'>(ccl::&#37;car <span id='f0c440'>(funcall &#39;references-from-list <span id='f0c439'>(ccl::typed-form &#39;list args)</span>)</span>)</span>)</span>)
            (&#35;:keyword-case &#35;2&#61;<span id='f0c437'>(lambda (type keyword)
                                 <span id='f0c436'>(let* ((&#35;:x56429 keyword))
                                   <span id='f0c435'>(let* ((&#35;:g56430 &#35;:x56429))
                                     <span id='f0c434'>(if <span id='f0c415'>(not &#39;:ne
                                              <span id='f0c414'>(block nil
                                                <span id='f0c413'>(let* ((&#35;:g56435 &#35;:g56430) (&#35;:g56436 <span id='f0c412'>&#39;(:int :bool)</span>))
                                                  <span id='f0c411'>(tagbody <span id='f0c406'>(go &#35;:g56438)</span>
                                                           (&#35;:g56437 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C22E7D&#62;
                                                            t t)
                                                           <span id='f0c403'>(tagbody <span id='f0c402'>(if <span id='f0c399'>(eq <span id='f0c398'>(car &#35;:g56436)</span> &#35;:g56435)</span>
                                                                        <span id='f0c401'>(return-from nil &#35;:g56436)</span>
                                                                        nil)</span>)</span>
                                                           <span id='f0c410'>(setq &#35;:g56436 <span id='f0c409'>(ccl::&#37;cdr <span id='f0c408'>(ccl::typed-form &#39;list &#35;:g56436)</span>)</span>)</span>
                                                           (&#35;:g56438 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C22E7D&#62;
                                                            t nil)
                                                           <span id='f0c405'>(if <span id='f0c404'>(not &#39;:ne &#35;:g56436)</span> (go &#35;:g56437) nil)</span>)</span>)</span>)</span>)</span>
                                         <span id='f0c433'>(progn nil
                                                <span id='f0c432'>(if <span id='f0c421'>(funcall &#39;type-op:int-reference&#63;
                                                             <span id='f0c420'>(ccl::typed-form
                                                              &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                              <span id='f0c419'>(ccl::struct-ref <span id='f0c417'>(ccl::typed-form &#39;type-info type)</span> 2)</span>)</span>)</span>
                                                    type
                                                    <span id='f0c431'>(funcall &#39;log:error
                                                             <span id='f0c429'>(funcall &#35;1&#35;)</span>
                                                             <span id='f0c430'>&#39;(:type :unification)</span>
                                                             <span id='f0c428'>&#39;&#34;Type &#126;A is not consistent with Integer&#34;</span>
                                                             <span id='f0c427'>(ccl::typed-form
                                                              &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                              <span id='f0c426'>(ccl::struct-ref <span id='f0c424'>(ccl::typed-form &#39;type-info type)</span> 2)</span>)</span>)</span>)</span>)</span>
                                         <span id='f0c395'>(if <span id='f0c394'>(not &#39;:ne <span id='f0c393'>(if <span id='f0c391'>(eq &#35;:g56430 &#39;:array)</span> <span id='f0c392'>&#39;(:array)</span> nil)</span>)</span>
                                             <span id='f0c389'>(progn nil
                                                    <span id='f0c388'>(if <span id='f0c377'>(funcall &#39;type-op:array-reference&#63;
                                                                 <span id='f0c376'>(ccl::typed-form
                                                                  &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                                  <span id='f0c375'>(ccl::struct-ref <span id='f0c374'>(ccl::typed-form &#39;type-info type)</span>
                                                                                   2)</span>)</span>)</span>
                                                        type
                                                        <span id='f0c387'>(funcall &#39;log:error
                                                                 <span id='f0c385'>(funcall &#35;1&#35;)</span>
                                                                 <span id='f0c379'>&#39;(:type :unification)</span>
                                                                 <span id='f0c386'>&#39;&#34;Type &#126;A is not consistent with Integer&#34;</span>
                                                                 <span id='f0c384'>(ccl::typed-form
                                                                  &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                                  <span id='f0c383'>(ccl::struct-ref <span id='f0c381'>(ccl::typed-form &#39;type-info type)</span>
                                                                                   2)</span>)</span>)</span>)</span>)</span>
                                             <span id='f0c371'>(if <span id='f0c370'>(not &#39;:ne <span id='f0c369'>(if <span id='f0c368'>(eq &#35;:g56430 &#39;:void)</span> <span id='f0c366'>&#39;(:void)</span> nil)</span>)</span>
                                                 <span id='f0c365'>(progn nil
                                                        <span id='f0c364'>(funcall &#39;log:error
                                                                 <span id='f0c362'>(funcall &#35;1&#35;)</span>
                                                                 <span id='f0c361'>&#39;(:type :unification)</span>
                                                                 <span id='f0c363'>&#39;&#34;The value void should not be used as an argument&#34;</span>)</span>)</span>
                                                 <span id='f0c360'>(if <span id='f0c359'>(progn &#35;:g56430 t)</span>
                                                     <span id='f0c357'>(progn nil
                                                            <span id='f0c356'>(values (funcall &#39;error
                                                                             <span id='f0c354'>&#39;type-error</span>
                                                                             <span id='f0c355'>&#39;:datum</span>
                                                                             &#35;:x56429
                                                                             <span id='f0c352'>&#39;:expected-type</span>
                                                                             <span id='f0c351'>&#39;known-primitve-types</span>))</span>)</span>
                                                     nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>))
     <span id='f0c654'>(funcall &#39;reduce
              <span id='f0c652'>(function <span id='f0c651'>(lambda (current-most-known-type val)
                          <span id='f0c650'>(let ((&#35;:arg0 val) (&#35;:arg1 current-most-known-type))
                            <span id='f0c649'>(let ((&#35;:arg056450 &#35;:arg0) (&#35;:arg156451 &#35;:arg1))
                              <span id='f0c648'>(block &#35;:block56443
                                <span id='f0c647'>(tagbody <span id='f0c606'>(let* ((&#35;:expr56452 &#35;:arg056450))
                                           <span id='f0c605'>(let* ((&#35;:g56453 &#35;:expr56452))
                                             <span id='f0c604'>(if <span id='f0c603'>(not &#35;:g56453)</span>
                                                 <span id='f0c524'>(progn nil
                                                        <span id='f0c523'>(let* ((&#35;:expr56454 &#35;:arg156451))
                                                          <span id='f0c522'>(let* ((&#35;:g56455 &#35;:expr56454))
                                                            <span id='f0c521'>(if <span id='f0c497'>(not &#35;:g56455)</span>
                                                                <span id='f0c496'>(progn nil <span id='f0c495'>(go &#35;:tag56444)</span>)</span>
                                                                <span id='f0c520'>(if <span id='f0c517'>(let* ((&#35;:g56457 &#35;:g56455))
                                                                      <span id='f0c516'>(or <span id='f0c512'>(funcall &#39;ccl:structure-typep
                                                                                   &#35;:g56457
                                                                                   <span id='f0c511'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                          <span id='f0c513'>(not &#35;:g56457)</span>
                                                                          <span id='f0c515'>(funcall &#39;keywordp &#35;:g56457)</span>)</span>)</span>
                                                                    <span id='f0c519'>(progn nil <span id='f0c518'>(go &#35;:tag56445)</span>)</span>
                                                                    <span id='f0c509'>(if <span id='f0c499'>(progn &#35;:g56455 t)</span>
                                                                        <span id='f0c508'>(progn nil
                                                                               <span id='f0c507'>(values (funcall &#39;error
                                                                                                <span id='f0c500'>&#39;dispatch-case-error</span>
                                                                                                <span id='f0c502'>&#39;:expected-type</span>
                                                                                                <span id='f0c503'>&#39;lookup-type</span>
                                                                                                <span id='f0c504'>&#39;:datum</span>
                                                                                                &#35;:expr56454
                                                                                                <span id='f0c506'>&#39;:matched-types</span>
                                                                                                <span id='f0c505'>&#39;(lookup-type)</span>))</span>)</span>
                                                                        nil)</span>)</span>)</span>)</span>)</span>)</span>
                                                 <span id='f0c602'>(if <span id='f0c601'>(funcall &#39;ccl:structure-typep
                                                              &#35;:g56453
                                                              <span id='f0c600'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                     <span id='f0c554'>(progn nil
                                                            <span id='f0c553'>(let* ((&#35;:expr56458 &#35;:arg156451))
                                                              <span id='f0c552'>(let* ((&#35;:g56459 &#35;:expr56458))
                                                                <span id='f0c551'>(if <span id='f0c526'>(funcall &#39;keywordp &#35;:g56459)</span>
                                                                    <span id='f0c528'>(progn nil <span id='f0c527'>(go &#35;:tag56446)</span>)</span>
                                                                    <span id='f0c550'>(if <span id='f0c531'>(funcall &#39;ccl:structure-typep
                                                                                 &#35;:g56459
                                                                                 <span id='f0c530'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                        <span id='f0c549'>(progn nil <span id='f0c548'>(go &#35;:tag56449)</span>)</span>
                                                                        <span id='f0c547'>(if <span id='f0c532'>(not &#35;:g56459)</span>
                                                                            <span id='f0c534'>(progn nil <span id='f0c533'>(go &#35;:tag56444)</span>)</span>
                                                                            <span id='f0c546'>(if <span id='f0c536'>(progn &#35;:g56459 t)</span>
                                                                                <span id='f0c545'>(progn nil
                                                                                       <span id='f0c544'>(values (funcall &#39;error
                                                                                                        <span id='f0c538'>&#39;dispatch-case-error</span>
                                                                                                        <span id='f0c539'>&#39;:expected-type</span>
                                                                                                        <span id='f0c537'>&#39;lookup-type</span>
                                                                                                        <span id='f0c541'>&#39;:datum</span>
                                                                                                        &#35;:expr56458
                                                                                                        <span id='f0c540'>&#39;:matched-types</span>
                                                                                                        <span id='f0c543'>&#39;(lookup-type)</span>))</span>)</span>
                                                                                nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>
                                                     <span id='f0c598'>(if <span id='f0c586'>(funcall &#39;keywordp &#35;:g56453)</span>
                                                         <span id='f0c584'>(progn nil
                                                                <span id='f0c583'>(let* ((&#35;:expr56460 &#35;:arg156451))
                                                                  <span id='f0c582'>(let* ((&#35;:g56461 &#35;:expr56460))
                                                                    <span id='f0c581'>(if <span id='f0c580'>(funcall &#39;ccl:structure-typep
                                                                                 &#35;:g56461
                                                                                 <span id='f0c578'>&#39;&#35;&#60;class-cell for type-info &#35;x302001E23B4D&#62;</span>)</span>
                                                                        <span id='f0c556'>(progn nil <span id='f0c555'>(go &#35;:tag56447)</span>)</span>
                                                                        <span id='f0c577'>(if <span id='f0c574'>(funcall &#39;keywordp &#35;:g56461)</span>
                                                                            <span id='f0c576'>(progn nil <span id='f0c575'>(go &#35;:tag56448)</span>)</span>
                                                                            <span id='f0c572'>(if <span id='f0c559'>(not &#35;:g56461)</span>
                                                                                <span id='f0c558'>(progn nil <span id='f0c557'>(go &#35;:tag56444)</span>)</span>
                                                                                <span id='f0c571'>(if <span id='f0c561'>(progn &#35;:g56461 t)</span>
                                                                                    <span id='f0c570'>(progn nil
                                                                                           <span id='f0c569'>(values (funcall &#39;error
                                                                                                            <span id='f0c562'>&#39;dispatch-case-error</span>
                                                                                                            <span id='f0c568'>&#39;:expected-type</span>
                                                                                                            <span id='f0c567'>&#39;lookup-type</span>
                                                                                                            <span id='f0c564'>&#39;:datum</span>
                                                                                                            &#35;:expr56460
                                                                                                            <span id='f0c563'>&#39;:matched-types</span>
                                                                                                            <span id='f0c565'>&#39;(lookup-type)</span>))</span>)</span>
                                                                                    nil)</span>)</span>)</span>)</span>)</span>)</span>)</span>
                                                         <span id='f0c597'>(if <span id='f0c596'>(progn &#35;:g56453 t)</span>
                                                             <span id='f0c594'>(progn nil
                                                                    <span id='f0c593'>(values (funcall &#39;error
                                                                                     <span id='f0c590'>&#39;dispatch-case-error</span>
                                                                                     <span id='f0c587'>&#39;:expected-type</span>
                                                                                     <span id='f0c591'>&#39;lookup-type</span>
                                                                                     <span id='f0c589'>&#39;:datum</span>
                                                                                     &#35;:expr56452
                                                                                     <span id='f0c592'>&#39;:matched-types</span>
                                                                                     nil))</span>)</span>
                                                             nil)</span>)</span>)</span>)</span>)</span>)</span>
                                         (&#35;:tag56444 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C4E97D&#62; t nil)
                                         <span id='f0c630'>(return-from &#35;:block56443 val)</span>
                                         (&#35;:tag56445 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C4E97D&#62; t nil)
                                         <span id='f0c608'>(return-from &#35;:block56443 current-most-known-type)</span>
                                         (&#35;:tag56446 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C4E97D&#62; t nil)
                                         <span id='f0c634'>(return-from &#35;:block56443 <span id='f0c633'>(funcall &#35;2&#35; val current-most-known-type)</span>)</span>
                                         (&#35;:tag56447 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C4E97D&#62; t nil)
                                         <span id='f0c494'>(return-from &#35;:block56443 <span id='f0c493'>(funcall &#35;2&#35; current-most-known-type val)</span>)</span>
                                         (&#35;:tag56448 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C4E97D&#62; t nil)
                                         <span id='f0c646'>(return-from &#35;:block56443
                                           <span id='f0c645'>(if <span id='f0c644'>(funcall 10 val current-most-known-type)</span>
                                               val
                                               <span id='f0c641'>(funcall &#39;log:error
                                                        <span id='f0c640'>(funcall &#35;1&#35;)</span>
                                                        <span id='f0c638'>&#39;(:type :unification)</span>
                                                        <span id='f0c637'>&#39;&#34;Values &#126;A and &#126;A are not consistent&#34;</span>
                                                        val
                                                        current-most-known-type)</span>)</span>)</span>
                                         (&#35;:tag56449 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C4E97D&#62; t nil)
                                         <span id='f0c628'>(return-from &#35;:block56443
                                           <span id='f0c627'>(if <span id='f0c625'>(funcall &#39;type-equality
                                                        <span id='f0c624'>(ccl::typed-form
                                                         &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                         <span id='f0c623'>(ccl::struct-ref <span id='f0c621'>(ccl::typed-form &#39;type-info val)</span> 2)</span>)</span>
                                                        <span id='f0c619'>(ccl::typed-form
                                                         &#39;(or alu&#46;spec:reference-type alu&#46;spec:application)
                                                         <span id='f0c618'>(ccl::struct-ref <span id='f0c616'>(ccl::typed-form &#39;type-info
                                                                           current-most-known-type)</span>
                                                                          2)</span>)</span>)</span>
                                               current-most-known-type
                                               <span id='f0c614'>(funcall &#39;log:error
                                                        <span id='f0c609'>(funcall &#35;1&#35;)</span>
                                                        <span id='f0c613'>&#39;(:type :unification)</span>
                                                        <span id='f0c611'>&#39;&#34;Values &#126;A and &#126;A are not consistent&#34;</span>
                                                        val
                                                        current-most-known-type)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>
              <span id='f0c490'>(let* ((&#35;:g56439 <span id='f0c489'>(cons nil nil)</span>)
                     (&#35;:g56440 &#35;:g56439)
                     (&#35;:g56442
                      <span id='f0c487'>(function <span id='f0c486'>(lambda (arg)
                                  <span id='f0c485'>(funcall &#39;normal-form-to-type-info
                                           <span id='f0c484'>(ccl::typed-form &#39;(or number alu&#46;spec:reference) arg)</span>
                                           <span id='f0c482'>(ccl::typed-form &#39;typing-context context)</span>)</span>)</span>)</span>))
                <span id='f0c480'>(let* ((&#35;:g56462 args))
                  (progn <span id='f0c478'>(tagbody <span id='f0c475'>(go &#35;:g56464)</span>
                                  (&#35;:g56463 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C6739D&#62; t t)
                                  <span id='f0c470'>(tagbody <span id='f0c469'>(let* ((&#35;:g56441 <span id='f0c461'>(car &#35;:g56462)</span>))
                                             <span id='f0c468'>(tagbody <span id='f0c467'>(setq &#35;:g56439
                                                            <span id='f0c466'>(ccl::&#37;cdr (ccl::&#37;rplacd &#35;:g56439
                                                                                     <span id='f0c464'>(cons <span id='f0c463'>(funcall &#35;:g56442 &#35;:g56441)</span>
                                                                                           nil)</span>))</span>)</span>)</span>)</span>)</span>
                                  <span id='f0c474'>(setq &#35;:g56462 <span id='f0c473'>(ccl::&#37;cdr <span id='f0c472'>(ccl::typed-form &#39;list &#35;:g56462)</span>)</span>)</span>
                                  (&#35;:g56464 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x302003C6739D&#62; t nil)
                                  <span id='f0c477'>(if <span id='f0c476'>(not &#39;:ne &#35;:g56462)</span> (go &#35;:g56463) nil)</span>)</span>
                         <span id='f0c459'>(let* () <span id='f0c458'>(ccl::&#37;cdr &#35;:g56440)</span>)</span>))</span>)</span>
              <span id='f0c653'>&#39;:from-end</span>
              nil
              <span id='f0c443'>&#39;:initial-value</span>
              <span id='f0c456'>(ccl::typed-form &#39;(or null keyword)
               <span id='f0c455'>(let* ()
                 <span id='f0c454'>(if <span id='f0c449'>(let* ((&#35;:g56467 nil)) <span id='f0c448'>(or <span id='f0c447'>(not &#35;:g56467)</span> <span id='f0c446'>(funcall &#39;keywordp &#35;:g56467)</span>)</span>)</span>
                     nil
                     <span id='f0c453'>(ccl::typed-form &#39;(or null keyword) <span id='f0c452'>(funcall &#39;serapeum::&#37;require-type nil <span id='f0c451'>&#39;hole</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
</body></html>