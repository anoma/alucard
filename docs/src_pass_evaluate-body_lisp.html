<html><head><style type='text/css'>
*.st1 { background-color: #ffaaaa }
*.st3 { background-color: #aaffaa }
*.st2 { background-color: #44dd44 }
*.stsource { background-color: #eeeeee; }
*.key { margin: 20px; width: 88ex }
*.source { width: 120ex; background-color: #eeeeee; padding-left: 5px;
             /* border-style: solid none none none; border-width: 1px;
             border-color: #dddddd */
             white-space: pre; }

*.acode { border-left: 1px dashed #c0c0c0;
         margin-top: 1ex;
         margin-left: 6ex;
         margin-bottom: 2ex;
         white-space: pre;
         display: none; }

*.line { color: #666666; float: left; width: 6ex; text-align: right; margin-right: 1ex; }

*.toggle { font-size: small; }

table.summary tr.head-row { background-color: #aaaaff }
table.summary tr td.text-cell { text-align: left }
table.summary tr td.main-head { text-align: center }
table.summary tr td { text-align: right }
table.summary tr.even { background-color: #eeeeff }
table.summary tr.subheading { background-color: #aaaaff}
table.summary tr.subheading td { text-align: left; font-weight: bold; padding-left: 5ex; }

</style>

<script type='text/javascript'>
function swap (id) {
  var acode = document.getElementById('a' + id);
  var prompt = document.getElementById('p' + id);
  if (acode.style.display == 'block') {
      acode.style.display = 'none';
      prompt.innerHTML = 'Show expansion';
  } else {
    acode.style.display = 'block';
    prompt.innerHTML = 'Hide expansion';
  }
}
</script>
<script src='src_pass_evaluate-body_lisp.js'></script>
</head><body onload='init_file()'><h3><a id='backlink' href="index.html">Coverage report:</a> home:Documents;Work;Repo;alu;src;pass;evaluate-body.lisp.newest <br />
</h3>
<table class='summary'><table class='summary'><tr class='head-row'><td class='main-head' colspan='5'>Expressions</td><td class='main-head' colspan='1'>Branches</td><td class='main-head' colspan='3'>Code Forms</td><td class='main-head' colspan='7'>Functions</td></tr><tr class='head-row'><td width='60px'>Total</td><td width='60px'>Entered</td><td width='60px'>% entered</td><td width='60px'>Fully covered</td><td width='60px'>% fully covered</td><td width='60px'>total unreached</td><td width='60px'>Total</td><td width='60px'>Covered</td><td width='60px'>% covered</td><td width='60px'>Total</td><td width='60px'>Fully covered</td><td width='60px'>% fully covered</td><td width='60px'>Partly covered</td><td width='60px'>% partly covered</td><td width='60px'>Not entered</td><td width='60px'>% not entered</td></tr><tr class='odd'><td id='srcTotal'></td><td id='srcEntered'></td><td id='srcEnteredPct'></td><td id='srcCovered'></td><td id='srcCoveredPct'></td><td id='branchUnreached'></td><td id='acodeTotal'></td><td id='acodeCovered'></td><td id='acodeCoveredPct'></td><td id='fnTotal'></td><td id='fnCovered'></td><td id='fnCoveredPct'></td><td id='fnPartly'></td><td id='fnPartlyPct'></td><td id='fnUnentered'></td><td id='fnUnenteredPct'></td></table></table><div class='key'><b>Key</b><br />
<div class='st2'>Fully covered - every single instruction executed</div><div class='st3'>Partly covered - entered but some subforms not executed</div><div class='st1'>Never entered - not a single instruction executed</div><div class='stsource'>Uninstrumented - a form whose coverage was not measured</div></div><p></p>
<div class='source'><code><span class='line'>1</span> (in-package :alu&#46;pass&#46;evaluate-body)
<span class='line'>2</span> 
<span class='line'>3</span> (-&#62; evaluate-and-cache-body (ir:circuit) list)
<span id='f0s0'><span class='line'>4</span> (defun evaluate-and-cache-body (circuit)
<span class='line'>5</span>   &#34;This function evals the given circuit body and returns the cached
<span class='line'>6</span> arguments&#34;
<span class='line'>7</span>   <span id='f0s1'>(values
<span class='line'>8</span>    <span id='f0s2'>(if <span id='f0s3'>(properly-chachedp circuit)</span>
<span class='line'>9</span>        <span id='f0s4'>(ir:exec circuit)</span>
<span class='line'>10</span>        <span id='f0s5'>(let ((exec-body <span id='f0s6'>(evaluate-circuit-body <span id='f0s7'>(ir:body circuit)</span>)</span>))
<span class='line'>11</span>          <span id='f0s8'>(setf (ir:exec circuit) exec-body)</span>
<span class='line'>12</span>          exec-body)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t0')><span class='toggle' id='pf0t0'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(0)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t0'><code><span id='f0c31'> (lambda (circuit)
   <span id='f0c30'>(values <span id='f0c29'>(if <span id='f0c16'>(funcall &#39;properly-chachedp <span id='f0c15'>(ccl::typed-form &#39;alu&#46;spec:circuit circuit)</span>)</span>
               <span id='f0c28'>(funcall &#39;alu&#46;spec:exec circuit)</span>
               <span id='f0c26'>(let* ((exec-body
                       <span id='f0c25'>(funcall &#39;evaluate-circuit-body <span id='f0c24'>(ccl::typed-form &#39;list <span id='f0c23'>(funcall &#39;alu&#46;spec:body circuit)</span>)</span>)</span>))
                 (progn <span id='f0c21'>(let* ((&#35;:g56637 circuit)) <span id='f0c20'>(funcall &#39;&#35;:&#124;(setf EXEC)&#124; exec-body &#35;:g56637)</span>)</span> exec-body))</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>13</span> 
<span class='line'>14</span> (-&#62; evaluate-circuit-body (list) list)
<span id='f0s9'><span class='line'>15</span> (defun evaluate-circuit-body (frozen-term)
<span class='line'>16</span>   &#59;&#59; need a cons to start with&#44; so make a cons
<span class='line'>17</span>   <span id='f0s10'>(let ((new-body <span id='f0s11'>(list nil)</span>))
<span class='line'>18</span>     <span id='f0s12'>(emit:with-circuit-body new-body
<span class='line'>19</span>       &#59;&#59; we have actual frozen code&#44; we must eval&#33;
<span class='line'>20</span>       <span id='f0s13'>(eval frozen-term)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t9')><span class='toggle' id='pf0t9'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(9)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t9'><code><span id='f0c12'> (lambda (frozen-term)
   <span id='f0c11'>(let* ((new-body <span id='f0c0'>(cons nil nil)</span>))
     <span id='f0c10'>(progn <span id='f0c5'>(let* ((emit::*circuit-body* new-body)) <span id='f0c3'>(funcall &#39;eval frozen-term)</span>)</span>
            <span id='f0c9'>(setq new-body <span id='f0c8'>(funcall &#39;remove-if <span id='f0c6'>(function not)</span> new-body)</span>)</span>
            new-body)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>21</span> 
<span class='line'>22</span> (-&#62; properly-chachedp (ir:circuit) boolean)
<span id='f0s14'><span class='line'>23</span> (defun properly-chachedp (circuit)
<span class='line'>24</span>   &#34;checks if the circuit&#39;s execution body is properly cached&#34;
<span class='line'>25</span>   (declare (ignore circuit))
<span class='line'>26</span>   &#59;&#59; Currently we have no good tracking&#44; so just return that it is not
<span class='line'>27</span>   &#59;&#59; cached&#33;
<span class='line'>28</span>   nil)</span>
</code></div>
<a href=javascript:swap('f0t14')><span class='toggle' id='pf0t14'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(14)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t14'><code><span id='f0c13'> (lambda (circuit) nil)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>29</span> 
</code></div>
</body></html>