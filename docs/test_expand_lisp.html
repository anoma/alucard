<html><head><style type='text/css'>
*.st1 { background-color: #ffaaaa }
*.st3 { background-color: #aaffaa }
*.st2 { background-color: #44dd44 }
*.stsource { background-color: #eeeeee; }
*.key { margin: 20px; width: 88ex }
*.source { width: 120ex; background-color: #eeeeee; padding-left: 5px;
             /* border-style: solid none none none; border-width: 1px;
             border-color: #dddddd */
             white-space: pre; }

*.acode { border-left: 1px dashed #c0c0c0;
         margin-top: 1ex;
         margin-left: 6ex;
         margin-bottom: 2ex;
         white-space: pre;
         display: none; }

*.line { color: #666666; float: left; width: 6ex; text-align: right; margin-right: 1ex; }

*.toggle { font-size: small; }

table.summary tr.head-row { background-color: #aaaaff }
table.summary tr td.text-cell { text-align: left }
table.summary tr td.main-head { text-align: center }
table.summary tr td { text-align: right }
table.summary tr.even { background-color: #eeeeff }
table.summary tr.subheading { background-color: #aaaaff}
table.summary tr.subheading td { text-align: left; font-weight: bold; padding-left: 5ex; }

</style>

<script type='text/javascript'>
function swap (id) {
  var acode = document.getElementById('a' + id);
  var prompt = document.getElementById('p' + id);
  if (acode.style.display == 'block') {
      acode.style.display = 'none';
      prompt.innerHTML = 'Show expansion';
  } else {
    acode.style.display = 'block';
    prompt.innerHTML = 'Hide expansion';
  }
}
</script>
<script src='test_expand_lisp.js'></script>
</head><body onload='init_file()'><h3><a id='backlink' href="index.html">Coverage report:</a> home:Documents;Work;Repo;alu;test;expand.lisp.newest <br />
</h3>
<table class='summary'><table class='summary'><tr class='head-row'><td class='main-head' colspan='5'>Expressions</td><td class='main-head' colspan='1'>Branches</td><td class='main-head' colspan='3'>Code Forms</td><td class='main-head' colspan='7'>Functions</td></tr><tr class='head-row'><td width='60px'>Total</td><td width='60px'>Entered</td><td width='60px'>% entered</td><td width='60px'>Fully covered</td><td width='60px'>% fully covered</td><td width='60px'>total unreached</td><td width='60px'>Total</td><td width='60px'>Covered</td><td width='60px'>% covered</td><td width='60px'>Total</td><td width='60px'>Fully covered</td><td width='60px'>% fully covered</td><td width='60px'>Partly covered</td><td width='60px'>% partly covered</td><td width='60px'>Not entered</td><td width='60px'>% not entered</td></tr><tr class='odd'><td id='srcTotal'></td><td id='srcEntered'></td><td id='srcEnteredPct'></td><td id='srcCovered'></td><td id='srcCoveredPct'></td><td id='branchUnreached'></td><td id='acodeTotal'></td><td id='acodeCovered'></td><td id='acodeCoveredPct'></td><td id='fnTotal'></td><td id='fnCovered'></td><td id='fnCoveredPct'></td><td id='fnPartly'></td><td id='fnPartlyPct'></td><td id='fnUnentered'></td><td id='fnUnenteredPct'></td></table></table><div class='key'><b>Key</b><br />
<div class='st2'>Fully covered - every single instruction executed</div><div class='st3'>Partly covered - entered but some subforms not executed</div><div class='st1'>Never entered - not a single instruction executed</div><div class='stsource'>Uninstrumented - a form whose coverage was not measured</div></div><p></p>
<div class='source'><code><span class='line'>1</span> (in-package :alu-test)
<span class='line'>2</span> 
<span class='line'>3</span> (def-suite alucard&#46;expand
<span class='line'>4</span>   :description &#34;Test the expanded argument functionality&#34;)
<span class='line'>5</span> 
<span class='line'>6</span> (in-suite alucard&#46;expand)
<span class='line'>7</span> 
<span class='line'>8</span> &#59;&#59; We sadly can&#39;t let over lambda&#44; as the test gets ran later &#9785;
<span class='line'>9</span> (test expansion-of-flat-arguments-work
<span class='line'>10</span>   (let ((expanded-storage
<span class='line'>11</span>           (expand:full-arguments-from-storage :arg-test-exp))
<span class='line'>12</span>         (arguments
<span class='line'>13</span>           (ir:arguments (storage:lookup-function :arg-test-exp))))
<span class='line'>14</span> 
<span class='line'>15</span>     &#59;&#59; Tests begin here
<span class='line'>16</span>     (is (eq (car arguments) (car expanded-storage))
<span class='line'>17</span>         &#34;Bytes is a primitive type and should not be changed&#34;)
<span class='line'>18</span>     (is (eq (cadr arguments) (cadr expanded-storage))
<span class='line'>19</span>         &#34;int is a primtiive type and should not be changed&#34;)
<span class='line'>20</span>     (is (not (eq (caddr arguments) (caddr expanded-storage)))
<span class='line'>21</span>         &#34;utx is not a primitve type and should be expanded properly&#34;)
<span class='line'>22</span>     (is (typep (caddr expanded-storage) &#39;expand:expand)
<span class='line'>23</span>         (format nil &#34;UTX should turn into an expand type&#34;))
<span class='line'>24</span>     (is (alexandria:starts-with-subseq
<span class='line'>25</span>          &#34;UTX&#34;
<span class='line'>26</span>          (symbol-name (expand:original (caddr expanded-storage))))
<span class='line'>27</span>         &#34;we preserve the name of the utx&#34;)
<span class='line'>28</span>     (is (&#61; 3 (length (expand:expanded (caddr expanded-storage))))
<span class='line'>29</span>         &#34;The arguments should be expanded to 3 argument wide&#34;)))
<span class='line'>30</span> 
<span class='line'>31</span> (test expansion-of-output
<span class='line'>32</span>   (let ((expanded-nested
<span class='line'>33</span>           &#96;((:plane &#46; &#44;(expand:full-type-reference*
<span class='line'>34</span>                         (ir:make-type-reference :name :point)))
<span class='line'>35</span>             (:time  &#46; &#44;(expand:full-type-reference*
<span class='line'>36</span>                         (ir:make-type-reference :name :point)))))
<span class='line'>37</span>         (nested-lookup
<span class='line'>38</span>           (expand:full-type-reference* (ir:make-type-reference :name :nested)))
<span class='line'>39</span>         (arg-test-output-expansion
<span class='line'>40</span>           (expand:full-return-values :arg-foo)))
<span class='line'>41</span> 
<span class='line'>42</span>     &#59;&#59; Tests begin here
<span class='line'>43</span>     (is (equalp expanded-nested nested-lookup)
<span class='line'>44</span>         &#34;Expansion of nested should expand twice&#34;)
<span class='line'>45</span>     (is (equalp nested-lookup arg-test-output-expansion)
<span class='line'>46</span>         &#34;Expanding the output should have the same effect&#34;)))
</code></div>
</body></html>