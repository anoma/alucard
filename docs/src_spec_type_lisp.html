<html><head><style type='text/css'>
*.st1 { background-color: #ffaaaa }
*.st3 { background-color: #aaffaa }
*.st2 { background-color: #44dd44 }
*.stsource { background-color: #eeeeee; }
*.key { margin: 20px; width: 88ex }
*.source { width: 120ex; background-color: #eeeeee; padding-left: 5px;
             /* border-style: solid none none none; border-width: 1px;
             border-color: #dddddd */
             white-space: pre; }

*.acode { border-left: 1px dashed #c0c0c0;
         margin-top: 1ex;
         margin-left: 6ex;
         margin-bottom: 2ex;
         white-space: pre;
         display: none; }

*.line { color: #666666; float: left; width: 6ex; text-align: right; margin-right: 1ex; }

*.toggle { font-size: small; }

table.summary tr.head-row { background-color: #aaaaff }
table.summary tr td.text-cell { text-align: left }
table.summary tr td.main-head { text-align: center }
table.summary tr td { text-align: right }
table.summary tr.even { background-color: #eeeeff }
table.summary tr.subheading { background-color: #aaaaff}
table.summary tr.subheading td { text-align: left; font-weight: bold; padding-left: 5ex; }

</style>

<script type='text/javascript'>
function swap (id) {
  var acode = document.getElementById('a' + id);
  var prompt = document.getElementById('p' + id);
  if (acode.style.display == 'block') {
      acode.style.display = 'none';
      prompt.innerHTML = 'Show expansion';
  } else {
    acode.style.display = 'block';
    prompt.innerHTML = 'Hide expansion';
  }
}
</script>
<script src='src_spec_type_lisp.js'></script>
</head><body onload='init_file()'><h3><a id='backlink' href="index.html">Coverage report:</a> home:Documents;Work;Repo;alu;src;spec;type.lisp.newest <br />
</h3>
<table class='summary'><table class='summary'><tr class='head-row'><td class='main-head' colspan='5'>Expressions</td><td class='main-head' colspan='1'>Branches</td><td class='main-head' colspan='3'>Code Forms</td><td class='main-head' colspan='7'>Functions</td></tr><tr class='head-row'><td width='60px'>Total</td><td width='60px'>Entered</td><td width='60px'>% entered</td><td width='60px'>Fully covered</td><td width='60px'>% fully covered</td><td width='60px'>total unreached</td><td width='60px'>Total</td><td width='60px'>Covered</td><td width='60px'>% covered</td><td width='60px'>Total</td><td width='60px'>Fully covered</td><td width='60px'>% fully covered</td><td width='60px'>Partly covered</td><td width='60px'>% partly covered</td><td width='60px'>Not entered</td><td width='60px'>% not entered</td></tr><tr class='odd'><td id='srcTotal'></td><td id='srcEntered'></td><td id='srcEnteredPct'></td><td id='srcCovered'></td><td id='srcCoveredPct'></td><td id='branchUnreached'></td><td id='acodeTotal'></td><td id='acodeCovered'></td><td id='acodeCoveredPct'></td><td id='fnTotal'></td><td id='fnCovered'></td><td id='fnCoveredPct'></td><td id='fnPartly'></td><td id='fnPartlyPct'></td><td id='fnUnentered'></td><td id='fnUnenteredPct'></td></table></table><div class='key'><b>Key</b><br />
<div class='st2'>Fully covered - every single instruction executed</div><div class='st3'>Partly covered - entered but some subforms not executed</div><div class='st1'>Never entered - not a single instruction executed</div><div class='stsource'>Uninstrumented - a form whose coverage was not measured</div></div><p></p>
<div class='source'><code><span class='line'>1</span> (in-package :alu&#46;spec)
<span class='line'>2</span> 
<span id='f0s0'><span class='line'>3</span> (deftype type-reference ()
<span class='line'>4</span>   &#34;When we refer to the type in the language it will be through the type
<span class='line'>5</span> reference&#46; If we are apply a type&#44; then &#34;
<span class='line'>6</span>   <span id='f0s1'>&#96;(or reference-type
<span class='line'>7</span>        &#59;&#59; can be found in alu&#47;term&#46;lisp
<span class='line'>8</span>        application)</span>)</span>
</code></div>
<a href=javascript:swap('f0t0')><span class='toggle' id='pf0t0'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(0)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t0'><code><span id='f0c110'> (lambda (&#35;:whole52644 &#35;:environment52645)
   <span id='f0c109'>(let* ((&#35;:args52646 <span id='f0c107'>(funcall &#39;ccl::prepare-to-destructure <span id='f0c104'>(cdr &#35;:whole52644)</span> nil 0 0)</span>))
     <span id='f0c108'>&#39;(or reference-type application)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>9</span> 
<span class='line'>10</span> &#59;&#59; dispatch-case has issue with sub checking so we inline type-reference below
<span id='f0s2'><span class='line'>11</span> (deftype type-reference-full ()
<span class='line'>12</span>   &#34;This handles the case of references to types and what they may be
<span class='line'>13</span> applied upon&#34;
<span class='line'>14</span>   <span id='f0s3'>&#96;(or reference-type application number)</span>)</span>
</code></div>
<a href=javascript:swap('f0t2')><span class='toggle' id='pf0t2'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(2)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t2'><code><span id='f0c12'> (lambda (&#35;:whole52662 &#35;:environment52663)
   <span id='f0c11'>(let* ((&#35;:args52664 <span id='f0c9'>(funcall &#39;ccl::prepare-to-destructure <span id='f0c7'>(cdr &#35;:whole52662)</span> nil 0 0)</span>))
     <span id='f0c10'>&#39;(or reference-type application number)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>15</span> 
<span class='line'>16</span> (defclass reference-type ()
<span class='line'>17</span>   ((name :initarg  :name
<span class='line'>18</span>          :type     keyword
<span class='line'>19</span>          :accessor name
<span class='line'>20</span>          :documentation &#34;Type reference&#34;))
<span class='line'>21</span>   (:documentation &#34;Represents a variable in the Alucard language&#34;))
<span class='line'>22</span> 
<span class='line'>23</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>24</span> &#59;&#59; Array Functioanlity
<span class='line'>25</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>26</span> 
<span class='line'>27</span> (-&#62; array-type (&#38;key (:length fixnum) (:type type-reference)) application)
<span id='f0s4'><span class='line'>28</span> (defun array-type (&#38;key length type)
<span class='line'>29</span>   <span id='f0s5'>(values
<span class='line'>30</span>    <span id='f0s6'>(make-application :function  <span id='f0s7'>(make-type-reference :name :array)</span>
<span class='line'>31</span>                      :arguments <span id='f0s8'>(list length type)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t4')><span class='toggle' id='pf0t4'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(4)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t4'><code><span id='f0c125'> (lambda (&#38;key ((:length length) nil &#35;:compiler-var) ((:type type) nil &#35;:compiler-var))
   <span id='f0c124'>(values <span id='f0c123'>(funcall &#39;make-application
                    <span id='f0c119'>&#39;:function</span>
                    <span id='f0c118'>(funcall &#39;make-type-reference <span id='f0c117'>&#39;:name</span> <span id='f0c116'>&#39;:array</span>)</span>
                    <span id='f0c115'>&#39;:arguments</span>
                    <span id='f0c122'>(list length type)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>32</span> 
<span class='line'>33</span> 
<span class='line'>34</span> (-&#62; array-type-len (application) fixnum)
<span id='f0s9'><span class='line'>35</span> (defun array-type-len (arr)
<span class='line'>36</span>   <span id='f0s10'>(car <span id='f0s11'>(arguments arr)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t9')><span class='toggle' id='pf0t9'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(9)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t9'><code><span id='f0c114'> (lambda (arr) <span id='f0c113'>(car <span id='f0c112'>(funcall &#39;arguments arr)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>37</span> 
<span class='line'>38</span> (-&#62; array-type-content (application) type-reference)
<span id='f0s12'><span class='line'>39</span> (defun array-type-content (arr)
<span class='line'>40</span>   <span id='f0s13'>(cadr <span id='f0s14'>(arguments arr)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t12')><span class='toggle' id='pf0t12'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(12)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t12'><code><span id='f0c4'> (lambda (arr) <span id='f0c3'>(car <span id='f0c2'>(cdr <span id='f0c1'>(funcall &#39;arguments arr)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>41</span> 
<span class='line'>42</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>43</span> &#59;&#59;                     Extra Functionality On Types                           &#59;&#59;
<span class='line'>44</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>45</span> 
<span id='f0s15'><span class='line'>46</span> (defun to-type-reference-format (term)
<span class='line'>47</span>   &#34;Given an application or a symbol&#44; transform it to the correct type
<span class='line'>48</span> storage format&#46; So for example
<span class='line'>49</span> 
<span class='line'>50</span> 1&#46; int      -&#62; (make-type-reference :name :int)
<span class='line'>51</span> 2&#46; (int 64) -&#62; (make-application :name (make-type-reference :name :int)
<span class='line'>52</span>                                  :arguments (list 64))&#34;
<span class='line'>53</span>   &#59;&#59; can either be a list number or atom
<span class='line'>54</span>   <span id='f0s16'>(cond (<span id='f0s17'>(listp term)</span>
<span class='line'>55</span>          <span id='f0s18'>(let ((type-ref <span id='f0s19'>(mapcar <span id='f0s20'>&#35;&#39;to-type-reference-format </span>term)</span>))
<span class='line'>56</span>            <span id='f0s21'>(make-application :function <span id='f0s22'>(car type-ref)</span> :arguments <span id='f0s23'>(cdr type-ref)</span>)</span>)</span>)
<span class='line'>57</span>         (<span id='f0s24'>(numberp term)</span>
<span class='line'>58</span>          term)
<span class='line'>59</span>         (t
<span class='line'>60</span>          <span id='f0s25'>(make-type-reference :name <span id='f0s26'>(alu&#46;utils:symbol-to-keyword term)</span>)</span>))</span>)</span>
</code></div>
<a href=javascript:swap('f0t15')><span class='toggle' id='pf0t15'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(15)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t15'><code><span id='f0c102'> (lambda (term)
   <span id='f0c101'>(if <span id='f0c56'>(eq (ccl::lisptag term) 3)</span>
       <span id='f0c92'>(let* ((type-ref
               <span id='f0c84'>(let* ((&#35;:g52730 <span id='f0c57'>(cons nil nil)</span>) (&#35;:g52731 &#35;:g52730) (&#35;:g52733 <span id='f0c58'>(function to-type-reference-format)</span>))
                 <span id='f0c83'>(let* ((&#35;:g52734 term))
                   (progn <span id='f0c81'>(tagbody <span id='f0c80'>(go &#35;:g52736)</span>
                                   (&#35;:g52735 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x30200377E9CD&#62; t t)
                                   <span id='f0c73'>(tagbody <span id='f0c72'>(let* ((&#35;:g52732 <span id='f0c71'>(car &#35;:g52734)</span>))
                                              <span id='f0c69'>(tagbody <span id='f0c68'>(setq &#35;:g52730
                                                             <span id='f0c67'>(ccl::&#37;cdr (ccl::&#37;rplacd &#35;:g52730
                                                                                      <span id='f0c65'>(cons <span id='f0c64'>(funcall &#35;:g52733 &#35;:g52732)</span>
                                                                                            nil)</span>))</span>)</span>)</span>)</span>)</span>
                                   <span id='f0c79'>(setq &#35;:g52734 <span id='f0c78'>(ccl::&#37;cdr <span id='f0c77'>(ccl::typed-form &#39;list &#35;:g52734)</span>)</span>)</span>
                                   (&#35;:g52736 nil (0) &#35;&#60;var &#35;:&#124;tagbody-catch-tag&#124; &#35;x30200377E9CD&#62; t nil)
                                   <span id='f0c75'>(if <span id='f0c74'>(not &#39;:ne &#35;:g52734)</span> (go &#35;:g52735) nil)</span>)</span>
                          <span id='f0c62'>(let* () <span id='f0c61'>(ccl::&#37;cdr &#35;:g52731)</span>)</span>))</span>)</span>))
         <span id='f0c91'>(funcall &#39;make-application <span id='f0c90'>&#39;:function</span> <span id='f0c87'>(car type-ref)</span> <span id='f0c85'>&#39;:arguments</span> <span id='f0c89'>(cdr type-ref)</span>)</span>)</span>
       <span id='f0c100'>(if <span id='f0c99'>(funcall &#39;numberp term)</span> term <span id='f0c96'>(funcall &#39;make-type-reference <span id='f0c93'>&#39;:name</span> <span id='f0c95'>(funcall &#39;util:symbol-to-keyword term)</span>)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>61</span> 
<span class='line'>62</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>63</span> &#59;&#59;                       Type Declaration Functions                           &#59;&#59;
<span class='line'>64</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>65</span> 
<span class='line'>66</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>67</span> &#59;&#59; Reference Functionality
<span class='line'>68</span> &#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;&#59;
<span class='line'>69</span> 
<span id='f0s27'><span class='line'>70</span> (defmethod print-object ((obj reference-type) stream)
<span class='line'>71</span>   <span id='f0s28'>(print-unreadable-object (obj stream :type t)
<span class='line'>72</span>     <span id='f0s29'>(format stream <span id='f0s30'>&#34;&#126;A&#34;</span> <span id='f0s31'>(name obj)</span>)</span>)</span>)</span>
</code></div>
<a href=javascript:swap('f0t27')><span class='toggle' id='pf0t27'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(27)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t27'><code><span id='f0c54'> (lambda (&#35;:next-method-context obj stream)
   <span id='f0c53'>(flet ()
     <span id='f0c52'>(let* ((&#35;:g52748
             <span id='f0c47'>(function <span id='f0c46'>(lambda nil
                         <span id='f0c45'>(let ((stream stream) (ccl::object <span id='f0c44'>(funcall &#39;name obj)</span>))
                           <span id='f0c42'>(if <span id='f0c30'>(or <span id='f0c29'>(not stream)</span>
                                   <span id='f0c28'>(let* ((&#35;:g52749 stream) (&#35;:g52750 <span id='f0c14'>(ccl::typecode &#35;:g52749)</span>))
                                     <span id='f0c27'>(if <span id='f0c26'>(ccl::&#37;i&#60;&#62; &#39;:eq &#35;:g52750 166)</span>
                                         <span id='f0c22'>(ccl::&#37;i&#60;&#62; &#39;:eq
                                          <span id='f0c21'>(ccl::typed-form &#39;(unsigned-byte 8)
                                           <span id='f0c20'>(ccl::&#37;ilogand2 255
                                                           <span id='f0c19'>(ccl::typed-form &#39;fixnum
                                                            <span id='f0c18'>(ccl::&#37;iasr 8
                                                                        <span id='f0c17'>(ccl::typed-form &#39;fixnum
                                                                         <span id='f0c16'>(ccl::&#37;svref &#35;:g52749 4)</span>)</span>)</span>)</span>)</span>)</span>
                                          201)</span>
                                         <span id='f0c24'>(ccl::&#37;i&#60;&#62; &#39;:eq &#35;:g52750 201)</span>)</span>)</span>)</span>
                               <span id='f0c34'>(funcall &#39;ccl::format-to-string stream <span id='f0c33'>&#39;&#34;&#126;A&#34;</span> ccl::object)</span>
                               <span id='f0c41'>(progn <span id='f0c40'>(funcall &#39;princ ccl::object <span id='f0c38'>(if <span id='f0c37'>(ccl:neq &#39;:ne stream t)</span> stream nil)</span>)</span> nil)</span>)</span>)</span>)</span>)</span>))
       <span id='f0c51'>(funcall &#39;ccl::&#37;print-unreadable-object obj stream t nil &#35;:g52748)</span>)</span>)</span>)</span>
</code></div><hr/>
<div class='source'><code><span class='line'>73</span> 
<span id='f0s32'><span class='line'>74</span> (defun make-type-reference (&#38;key name)
<span class='line'>75</span>   <span id='f0s33'>(make-instance &#39;reference-type :name name)</span>)</span>
</code></div>
<a href=javascript:swap('f0t32')><span class='toggle' id='pf0t32'>Show expansion</span></a>
&nbsp;&nbsp;&nbsp;<a href=javascript:show_tags(32)><span class='toggle'>Show tags</span></a>
<div class='acode' id='af0t32'><code><span id='f0c133'> (lambda (&#38;key ((:name name) nil &#35;:compiler-var))
   <span id='f0c132'>(let* ()
     <span id='f0c131'>(funcall <span id='f0c129'>(ccl::&#37;svref <span id='f0c128'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020037D116F&#62;))</span> 3)</span>
              <span id='f0c127'>&#39;(&#35;:load-time-eval (funcall &#35;&#60;Anonymous Function &#35;x3020037D116F&#62;))</span>
              <span id='f0c126'>&#39;:name</span>
              name)</span>)</span>)</span>
</code></div><hr/>
</body></html>